<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' https:; img-src 'self' https: data:; font-src 'self' https://fonts.gstatic.com; connect-src 'self' https://api.anthropic.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdn.tailwindcss.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://unpkg.com https://cdn.tailwindcss.com https://cdnjs.cloudflare.com;">
    <meta name="description" content="CheevO! Decision Intelligence Platform — AI-driven besluitvormingsanalyse voor organisaties">
    <meta name="robots" content="noindex, nofollow">
    <title>CheevO! — Decision Intelligence Platform</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/jspdf@2.5.2/dist/jspdf.umd.min.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #0A0A0F 0%, #12121A 100%);
            color: rgba(255, 255, 255, 0.87);
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
            padding-top: 60px;
        }

        html, body, #root {
            height: 100%;
            width: 100%;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 700;
        }

        /* ==================== TOP NAVIGATION ==================== */

        .top-nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: rgba(10, 10, 15, 0.85);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255,255,255,0.06);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 clamp(12px, 3vw, 24px);
        }

        .nav-left {
            display: flex;
            align-items: center;
            gap: clamp(8px, 2vw, 16px);
            flex: 0 0 auto;
        }

        .nav-center {
            flex: 1;
            text-align: center;
            font-size: clamp(12px, 1.5vw, 16px);
            font-weight: 600;
            color: rgba(255,255,255,0.85);
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: clamp(8px, 2vw, 16px);
            flex: 0 0 auto;
        }

        .logo-text {
            font-size: 18px;
            font-weight: 700;
            background: linear-gradient(135deg, #06D6A0 0%, #00F5D4 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-family: 'Space Grotesk', sans-serif;
        }

        .logo-img {
            height: 48px;
            width: auto;
            filter: invert(1) brightness(2);
            display: flex;
            align-items: center;
        }

        .logo-img-large {
            height: 90px;
            width: auto;
            filter: invert(1) brightness(2);
            margin: 0 auto 24px;
        }

        /* ==================== PROGRESS STEPPER ==================== */

        .progress-stepper {
            position: fixed;
            top: 60px;
            left: 0;
            right: 0;
            height: 70px;
            background: rgba(10, 10, 15, 0.7);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255,255,255,0.06);
            z-index: 99;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: clamp(12px, 3vw, 40px);
            padding: 0 clamp(12px, 3vw, 24px);
            animation: slideDown 0.4s ease-out;
        }

        .stepper-step {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0.6;
        }

        .stepper-step.active {
            opacity: 1;
        }

        .stepper-step.completed {
            opacity: 0.8;
            cursor: pointer;
        }

        .stepper-circle {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 2px solid rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            background: transparent;
            flex-shrink: 0;
        }

        .stepper-step.active .stepper-circle {
            border-color: #06D6A0;
            background: rgba(6, 214, 160, 0.2);
            box-shadow: 0 0 20px rgba(6, 214, 160, 0.4);
        }

        .stepper-step.completed .stepper-circle {
            background: rgba(16, 185, 129, 0.2);
            border-color: #10B981;
            color: #10B981;
        }

        .stepper-label {
            font-size: 13px;
            font-weight: 600;
            white-space: nowrap;
        }

        body.with-stepper {
            padding-top: 130px;
        }

        /* ==================== ANIMATIONS ==================== */

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideInFromRight {
            from {
                opacity: 0;
                transform: translateX(40px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideOutToLeft {
            from {
                opacity: 1;
                transform: translateX(0);
            }
            to {
                opacity: 0;
                transform: translateX(-40px);
            }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes livePulse {
            0% { box-shadow: 0 0 0 0 rgba(6, 214, 160, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(6, 214, 160, 0); }
            100% { box-shadow: 0 0 0 0 rgba(6, 214, 160, 0); }
        }

        @keyframes shimmer {
            0% { background-position: -200px 0; }
            100% { background-position: 200px 0; }
        }

        @keyframes countUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes typing {
            from { width: 0 }
            to { width: 100% }
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes glow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.3); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Accessibility: Respect prefers-reduced-motion */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Accessibility: Focus-visible for keyboard users */
        *:focus-visible {
            outline: 2px solid #06D6A0;
            outline-offset: 2px;
        }

        /* Skip to content link */
        .skip-link {
            position: absolute;
            top: -100%;
            left: 16px;
            z-index: 9999;
            background: #06D6A0;
            color: #0A0A0F;
            padding: 8px 16px;
            border-radius: 0 0 8px 8px;
            font-weight: 600;
            font-size: 14px;
            text-decoration: none;
            transition: top 0.2s ease;
        }
        .skip-link:focus {
            top: 0;
        }

        /* Print styles for PDF-like printing */
        @media print {
            body { background: white !important; color: #1a1a1a !important; padding: 20px !important; }
            .top-nav, .progress-stepper, .btn-primary, .action-buttons, .skip-link { display: none !important; }
            .glass-card, .metric-card, .decision-timeline { background: white !important; border: 1px solid #ddd !important; color: #1a1a1a !important; }
            .metric-card-value, .gauge-value, .gradient-text { -webkit-text-fill-color: #06D6A0 !important; color: #06D6A0 !important; }
            .text-muted, .text-body { color: #444 !important; }
        }

        @keyframes bounce {
            0%, 80%, 100% {
                opacity: 0.3;
                transform: scale(0.8);
            }
            40% {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ==================== SCREEN TRANSITIONS ==================== */

        .screen-container {
            position: relative;
            width: 100%;
            min-height: calc(100vh - 60px);
        }

        .screen-enter {
            animation: slideInFromRight 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        .screen-exit {
            animation: slideOutToLeft 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            position: absolute;
            pointer-events: none;
        }

        /* ==================== UTILITY CLASSES ==================== */

        .fade-in {
            animation: fadeIn 0.8s ease-out;
        }

        .fade-in-up {
            animation: fadeInUp 0.8s ease-out;
        }

        .pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        .live-pulse {
            animation: livePulse 2s infinite;
        }

        .spinner {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 2px solid rgba(6, 214, 160, 0.3);
            border-top-color: #06D6A0;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        /* ==================== GLASSMORPHISM CARDS ==================== */

        .glass-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-radius: 20px;
            padding: clamp(12px, 3vw, 16px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .glass-card:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(6, 214, 160, 0.2);
            box-shadow: 0 8px 32px rgba(6, 214, 160, 0.1);
        }

        .glass-card.agent-card {
            border-left: 4px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .glass-card.agent-card.active {
            border-left-color: #06D6A0;
            background: rgba(6, 214, 160, 0.05);
            box-shadow: 0 0 20px rgba(6, 214, 160, 0.15);
        }

        .glass-card.agent-card.completed {
            border-left-color: #10B981;
            background: rgba(16, 185, 129, 0.03);
        }

        /* Agent color variants */
        .glass-card.agent-framing { border-left-color: #8B5CF6; }
        .glass-card.agent-framing.active { background: rgba(139, 92, 246, 0.05); box-shadow: 0 0 20px rgba(139, 92, 246, 0.15); }

        .glass-card.agent-data { border-left-color: #3B82F6; }
        .glass-card.agent-data.active { background: rgba(59, 130, 246, 0.05); box-shadow: 0 0 20px rgba(59, 130, 246, 0.15); }

        .glass-card.agent-options { border-left-color: #06D6A0; }
        .glass-card.agent-options.active { background: rgba(6, 214, 160, 0.05); box-shadow: 0 0 20px rgba(6, 214, 160, 0.15); }

        .glass-card.agent-risk { border-left-color: #F59E0B; }
        .glass-card.agent-risk.active { background: rgba(245, 158, 11, 0.05); box-shadow: 0 0 20px rgba(245, 158, 11, 0.15); }

        .glass-card.agent-recommendation { border-left-color: #EC4899; }
        .glass-card.agent-recommendation.active { background: rgba(236, 72, 153, 0.05); box-shadow: 0 0 20px rgba(236, 72, 153, 0.15); }

        /* ==================== BUTTONS ==================== */

        .btn-primary {
            background: linear-gradient(135deg, #06D6A0 0%, #00F5D4 100%);
            color: #0A0A0F;
            border: none;
            border-radius: 12px;
            padding: 12px 28px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        .btn-primary:hover::before {
            left: 100%;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(6, 214, 160, 0.3);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* ==================== INPUTS ==================== */

        .input-field {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.87);
            border-radius: 12px;
            padding: 14px 18px;
            font-size: 14px;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
        }

        .input-field::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .input-field:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(6, 214, 160, 0.5);
            box-shadow: 0 0 0 3px rgba(6, 214, 160, 0.15);
        }

        .input-field[aria-invalid="true"] {
            border-color: #EF4444;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.15);
        }

        /* ==================== TYPOGRAPHY ==================== */

        .gradient-text {
            background: linear-gradient(135deg, #06D6A0 0%, #00F5D4 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero-title {
            font-size: clamp(40px, 8vw, 64px);
            font-weight: 700;
            line-height: 1.1;
            letter-spacing: -0.02em;
        }

        .section-title {
            font-size: clamp(24px, 5vw, 32px);
            font-weight: 700;
            line-height: 1.2;
        }

        .subsection-title {
            font-size: clamp(18px, 3vw, 20px);
            font-weight: 600;
            line-height: 1.4;
        }

        .label {
            font-size: 12px;
            font-weight: 600;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            color: rgba(6, 214, 160, 0.8);
        }

        .text-muted {
            color: rgba(255, 255, 255, 0.8);
        }

        .text-body {
            color: rgba(255, 255, 255, 0.82);
            font-size: 16px;
            line-height: 1.6;
        }

        /* ==================== GAUGES & METRICS ==================== */

        .metric-circle {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(6, 214, 160, 0.2) 0%, rgba(6, 214, 160, 0.05) 100%);
            border: 1px solid rgba(6, 214, 160, 0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            box-shadow: 0 8px 32px rgba(6, 214, 160, 0.1);
            transition: all 0.3s ease;
        }

        .metric-circle:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 48px rgba(6, 214, 160, 0.2);
        }

        .metric-value {
            font-size: 28px;
            font-weight: 700;
            color: #06D6A0;
        }

        .metric-label {
            font-size: 11px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.5);
            margin-top: 8px;
            text-transform: uppercase;
        }

        /* ==================== GAUGE SVG ==================== */

        .gauge-container {
            position: relative;
            width: 160px;
            height: 160px;
            margin: 0 auto;
        }

        .gauge-svg {
            transform: rotate(-90deg);
        }

        .gauge-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .gauge-value {
            font-size: 48px;
            font-weight: 700;
            background: linear-gradient(135deg, #06D6A0 0%, #00F5D4 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .gauge-label {
            font-size: 12px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.6);
            margin-top: 4px;
            text-transform: uppercase;
        }

        /* ==================== HEALTH SCORE BREAKDOWN ==================== */

        .health-breakdown {
            margin-top: 24px;
            padding: clamp(12px, 2vw, 16px);
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;
        }

        .breakdown-title {
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 12px;
        }

        .breakdown-item {
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 13px;
        }

        .breakdown-item:last-child {
            margin-bottom: 0;
        }

        .breakdown-label {
            flex: 1;
            color: rgba(255, 255, 255, 0.7);
        }

        .breakdown-bar-container {
            flex: 2;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
            margin: 0 12px;
        }

        .breakdown-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #06D6A0 0%, #00F5D4 100%);
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        .breakdown-score {
            color: #06D6A0;
            font-weight: 600;
            text-align: right;
            min-width: 50px;
        }

        /* ==================== AGENT DEBATE VISUALIZATION ==================== */

        .consensus-section {
            margin: 24px 0;
            padding: clamp(12px, 2vw, 16px);
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;
        }

        .consensus-title {
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 12px;
        }

        .consensus-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 8px 0;
            font-size: 13px;
            color: rgba(255, 255, 255, 0.7);
            line-height: 1.5;
        }

        .consensus-agree {
            border-left: 3px solid #10B981;
            padding-left: 12px;
            color: #10B981;
        }

        .consensus-disagree {
            border-left: 3px solid #F59E0B;
            padding-left: 12px;
            color: #F59E0B;
        }

        /* ==================== AGENT PIPELINE ==================== */

        .agent-status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            font-weight: 600;
            padding: 4px 0;
        }

        .status-waiting {
            color: rgba(255, 255, 255, 0.75);
        }

        .status-thinking {
            color: #00D9FF;
        }

        .status-done {
            color: #10B981;
        }

        .agent-icon {
            width: 48px;
            height: 48px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 18px;
            background: rgba(6, 214, 160, 0.15);
            flex-shrink: 0;
            position: relative;
        }
        .agent-icon svg { width: 22px; height: 22px; }
        .agent-icon.done { border: 1.5px solid rgba(6,214,160,0.4); }
        .agent-icon.done::after {
            content: ''; position: absolute; top: -3px; right: -3px;
            width: 12px; height: 12px; border-radius: 50%;
            background: #06D6A0; border: 2px solid #0A0A0F;
        }

        .agent-icon.framing { background: linear-gradient(135deg, rgba(139,92,246,0.2) 0%, rgba(139,92,246,0.05) 100%); color: #A78BFA; }
        .agent-icon.data { background: linear-gradient(135deg, rgba(59,130,246,0.2) 0%, rgba(59,130,246,0.05) 100%); color: #60A5FA; }
        .agent-icon.options { background: linear-gradient(135deg, rgba(6,214,160,0.2) 0%, rgba(6,214,160,0.05) 100%); color: #06D6A0; }
        .agent-icon.risk { background: linear-gradient(135deg, rgba(245,158,11,0.2) 0%, rgba(245,158,11,0.05) 100%); color: #FBBF24; }
        .agent-icon.recommendation { background: linear-gradient(135deg, rgba(236,72,153,0.2) 0%, rgba(236,72,153,0.05) 100%); color: #F472B6; }

        /* ==================== MONTE CARLO ==================== */

        .monte-carlo-bar {
            margin-bottom: 20px;
        }

        .monte-carlo-label {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            color: rgba(255, 255, 255, 0.8);
        }

        .monte-carlo-container {
            position: relative;
            height: 32px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            overflow: hidden;
        }

        .monte-carlo-background {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: rgba(255, 255, 255, 0.03);
            opacity: 0.5;
            border-radius: 8px;
        }

        .monte-carlo-fill {
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 12px;
            color: white;
            transition: width 0.6s ease;
        }

        .bar-green {
            background: linear-gradient(90deg, #10B981 0%, #06D6A0 100%);
        }

        .bar-amber {
            background: linear-gradient(90deg, #F59E0B 0%, #FBBF24 100%);
        }

        .bar-red {
            background: linear-gradient(90deg, #EF4444 0%, #F87171 100%);
        }

        .monte-carlo-percentage {
            font-size: 12px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.85);
            margin-top: 6px;
            text-align: right;
        }

        .monte-carlo-ci {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.75);
            margin-top: 4px;
            text-align: right;
        }

        /* ==================== COMMAND CENTER DASHBOARD ==================== */

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: clamp(12px, 3vw, 16px);
            margin-bottom: 24px;
        }

        .metric-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-radius: 16px;
            padding: clamp(16px, 3vw, 20px);
            text-align: center;
        }

        .metric-card-value {
            font-size: clamp(24px, 5vw, 32px);
            font-weight: 700;
            background: linear-gradient(135deg, #06D6A0 0%, #00F5D4 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }

        .metric-card-label {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            color: rgba(255, 255, 255, 0.5);
        }

        .decision-timeline {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-radius: 16px;
            padding: clamp(16px, 3vw, 20px);
            margin-bottom: 24px;
        }

        .timeline-item {
            display: flex;
            gap: 16px;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
        }

        .timeline-item:last-child {
            border-bottom: none;
        }

        .timeline-date {
            font-size: 12px;
            font-weight: 600;
            color: rgba(6, 214, 160, 0.8);
            min-width: 80px;
        }

        .timeline-desc {
            flex: 1;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
        }

        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: clamp(8px, 2vw, 12px);
        }

        /* ==================== MODAL ==================== */

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn 0.2s ease;
            role: dialog;
        }

        .modal-content {
            background: linear-gradient(135deg, rgba(10, 10, 15, 0.95) 0%, rgba(18, 18, 26, 0.95) 100%);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            max-width: min(90vw, 800px);
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            padding: clamp(16px, 4vw, 32px);
            position: relative;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: scaleIn 0.3s ease;
        }

        .modal-close {
            position: absolute;
            top: clamp(16px, 2vw, 24px);
            right: clamp(16px, 2vw, 24px);
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            width: 40px;
            height: 40px;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.2s ease;
            color: rgba(255, 255, 255, 0.7);
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #06D6A0;
        }

        .modal-close:focus {
            outline: 2px solid #06D6A0;
            outline-offset: 2px;
        }

        .modal-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
        }

        .modal-title {
            font-size: clamp(18px, 3vw, 24px);
            font-weight: 700;
            flex: 1;
        }

        .modal-metadata {
            display: flex;
            gap: 12px;
            font-size: 12px;
            flex-wrap: wrap;
        }

        .modal-badge {
            padding: 4px 12px;
            border-radius: 6px;
            font-weight: 600;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            white-space: nowrap;
        }

        .modal-badge.live {
            background: rgba(6, 214, 160, 0.15);
            border-color: rgba(6, 214, 160, 0.3);
            color: #06D6A0;
        }

        .modal-badge.demo {
            background: rgba(245, 158, 11, 0.15);
            border-color: rgba(245, 158, 11, 0.3);
            color: #F59E0B;
        }

        .modal-body {
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.7;
            font-size: 14px;
        }

        .modal-body h1, .modal-body h2, .modal-body h3, .modal-body h4, .modal-body h5, .modal-body h6 {
            color: rgba(255, 255, 255, 0.95);
            margin: 16px 0 12px 0;
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 700;
        }

        .modal-body h2 {
            font-size: 18px;
            margin-top: 20px;
        }

        .modal-body h3 {
            font-size: 16px;
        }

        .modal-body p {
            margin: 8px 0;
        }

        .modal-body ul, .modal-body ol {
            margin: 12px 0;
            margin-left: 20px;
        }

        .modal-body li {
            margin: 6px 0;
        }

        .modal-body strong {
            color: #06D6A0;
            font-weight: 600;
        }

        .modal-body em {
            color: rgba(255, 255, 255, 0.7);
            font-style: italic;
        }

        .modal-body code {
            background: rgba(255, 255, 255, 0.05);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Monaco', monospace;
            color: #00F5D4;
            font-size: 0.9em;
        }

        .modal-body br {
            display: block;
            content: "";
            margin: 0.5em 0;
        }

        .benchmark-badge {
            display: inline-block;
            background: rgba(6, 214, 160, 0.1);
            border: 1px solid rgba(6, 214, 160, 0.2);
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 11px;
            color: #06D6A0;
            font-weight: 600;
            margin-top: 8px;
            cursor: help;
            transition: all 0.2s ease;
        }

        .benchmark-badge:hover {
            background: rgba(6, 214, 160, 0.15);
            border-color: rgba(6, 214, 160, 0.3);
        }

        .copy-feedback {
            display: inline-block;
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid rgba(16, 185, 129, 0.4);
            padding: 8px 16px;
            border-radius: 8px;
            color: #10B981;
            font-size: 13px;
            font-weight: 600;
            animation: fadeIn 0.3s ease;
        }

        /* ==================== INSIGHT CARDS ==================== */

        @keyframes insightSlideIn {
            from { opacity: 0; transform: translateX(-12px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes pulseWarning {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }

        .insight-card {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.06);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            animation: insightSlideIn 0.5s ease forwards;
            opacity: 0;
            position: relative;
            overflow: hidden;
        }

        .insight-card::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            border-radius: 3px 0 0 3px;
        }

        .insight-card.critical::before { background: #EF4444; }
        .insight-card.warning::before { background: #FBBF24; }
        .insight-card.good::before { background: #06D6A0; }

        .insight-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .insight-emoji {
            font-size: 18px;
            flex-shrink: 0;
        }

        .insight-metric {
            font-size: 20px;
            font-weight: 700;
            color: rgba(255,255,255,0.95);
        }

        .insight-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: rgba(255,255,255,0.4);
            font-weight: 600;
        }

        .insight-text {
            font-size: 13px;
            color: rgba(255,255,255,0.7);
            line-height: 1.5;
        }

        .insight-impact {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            margin-top: 8px;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
        }

        .insight-impact.negative {
            background: rgba(239,68,68,0.1);
            color: #F87171;
            border: 1px solid rgba(239,68,68,0.2);
        }

        .insight-impact.positive {
            background: rgba(6,214,160,0.1);
            color: #06D6A0;
            border: 1px solid rgba(6,214,160,0.2);
        }

        .insight-impact.neutral {
            background: rgba(251,191,36,0.1);
            color: #FBBF24;
            border: 1px solid rgba(251,191,36,0.2);
        }

        .scan-narrative {
            background: linear-gradient(135deg, rgba(6,214,160,0.05) 0%, rgba(96,165,250,0.05) 100%);
            border: 1px solid rgba(6,214,160,0.15);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            position: relative;
        }

        .scan-narrative-icon {
            position: absolute;
            top: -12px;
            left: 24px;
            background: linear-gradient(135deg, #06D6A0, #60A5FA);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            box-shadow: 0 4px 12px rgba(6,214,160,0.3);
        }

        .pain-point-tag {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            background: rgba(251,113,133,0.1);
            border: 1px solid rgba(251,113,133,0.2);
            color: #FB7185;
            margin: 4px 4px 4px 0;
        }

        .scan-section-title {
            font-size: 14px;
            font-weight: 600;
            color: rgba(255,255,255,0.78);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .scan-section-title::after {
            content: '';
            flex: 1;
            height: 1px;
            background: rgba(255,255,255,0.06);
        }

        /* ==================== FOCUS STATES ==================== */

        button:focus,
        input:focus,
        .glass-card:focus,
        [role="button"]:focus {
            outline: 2px solid #06D6A0;
            outline-offset: 2px;
        }

        button:focus-visible,
        input:focus-visible,
        [role="button"]:focus-visible {
            outline: 2px solid #06D6A0;
            outline-offset: 2px;
        }

        .btn-primary:focus,
        .btn-primary:focus-visible {
            outline: 2px solid rgba(255, 255, 255, 0.6);
            outline-offset: 2px;
        }

        .input-field:focus-visible {
            outline: 2px solid #06D6A0;
            outline-offset: 2px;
        }

        /* ==================== RESPONSIVE ==================== */

        @media (max-width: 1024px) {
            .progress-stepper {
                height: 80px;
            }

            body.with-stepper {
                padding-top: 140px;
            }

            .stepper-label {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .hero-title {
                font-size: 36px;
            }

            .section-title {
                font-size: 24px;
            }

            .progress-stepper {
                gap: 20px;
                height: 80px;
            }

            .stepper-label {
                display: none;
            }

            body.with-stepper {
                padding-top: 140px;
            }

            .dashboard-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .action-buttons {
                grid-template-columns: 1fr;
            }
        }

        /* ==================== MOBILE SMALL (≤480px) ==================== */
        @media (max-width: 480px) {
            .hero-title { font-size: 28px; }
            .section-title { font-size: 20px; }
            .dashboard-grid { grid-template-columns: 1fr; }
            .modal-content { max-width: 95vw; padding: clamp(12px, 3vw, 16px); }
            .progress-stepper { gap: 12px; height: 70px; }
            .stepper-circle { width: 28px; height: 28px; font-size: 12px; }
            body.with-stepper { padding-top: 130px; }
            .agent-orb { width: 60px; height: 60px; }
        }

        @media (max-width: 360px) {
            .hero-title { font-size: 24px; }
            .section-title { font-size: 18px; }
            .modal-content { padding: 12px; }
            body { padding-top: 50px; }
        }

        @keyframes splashLogoFadeInScale {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }
        @keyframes typewriter {
            from { width: 0; opacity: 0; }
            to { width: 100%; opacity: 1; }
        }
        @keyframes splashFadeOut {
            from { opacity: 1; transform: scale(1); }
            to { opacity: 0; transform: scale(0.95); }
        }
        @keyframes particleGlow {
            0%, 100% { filter: brightness(1) drop-shadow(0 0 10px rgba(6, 214, 160, 0.3)); }
            50% { filter: brightness(1.2) drop-shadow(0 0 20px rgba(6, 214, 160, 0.6)); }
        }
        /* ==================== SPLASH SCREEN ==================== */
        .splash-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #0A0A0F;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: splashFadeOut 0.6s ease-in forwards 2.4s;
        }
        .splash-content {
            text-align: center;
        }
        .splash-logo {
            height: 120px;
            width: auto;
            filter: invert(1) brightness(2);
            margin-bottom: 32px;
            animation: splashLogoFadeInScale 0.8s ease-out;
        }
        .splash-tagline {
            font-size: 18px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.7);
            letter-spacing: 0.5px;
            overflow: hidden;
            white-space: nowrap;
            animation: typewriter 2s steps(35) 0.5s forwards;
            opacity: 0;
        }

        /* ==================== WELCOME SCREEN ==================== */
        @keyframes welcomeFadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes agentFloat { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-12px); } }
        @keyframes agentPulse { 0%, 100% { box-shadow: 0 0 20px var(--agent-glow); } 50% { box-shadow: 0 0 40px var(--agent-glow), 0 0 60px var(--agent-glow); } }
        @keyframes chatBubblePop { from { opacity: 0; transform: scale(0.5) translateY(10px); } to { opacity: 1; transform: scale(1) translateY(0); } }
        @keyframes sparkle { 0%, 100% { opacity: 0.3; transform: scale(0.8); } 50% { opacity: 1; transform: scale(1.2); } }
        @keyframes welcomeWave { 0% { transform: rotate(0deg); } 10% { transform: rotate(14deg); } 20% { transform: rotate(-8deg); } 30% { transform: rotate(14deg); } 40% { transform: rotate(-4deg); } 50% { transform: rotate(10deg); } 60%, 100% { transform: rotate(0deg); } }

        .welcome-container {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: radial-gradient(ellipse at 50% 30%, rgba(6, 214, 160, 0.06) 0%, #0A0A0F 70%);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 999; overflow: hidden;
        }
        .welcome-particles { position: absolute; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none; }
        .welcome-particle {
            position: absolute; width: 4px; height: 4px; border-radius: 50%;
            background: rgba(6, 214, 160, 0.4); animation: sparkle 3s ease-in-out infinite;
        }
        .agent-orb {
            width: 76px; height: 76px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 28px; cursor: default; position: relative; transition: all 0.3s ease;
            --agent-glow: rgba(6, 214, 160, 0.3);
            animation: agentFloat 3s ease-in-out infinite, agentPulse 4s ease-in-out infinite;
            will-change: transform, opacity;
            backface-visibility: hidden;
        }
        .agent-orb:hover { transform: scale(1.15) !important; }
        .agent-chat-bubble {
            position: absolute; bottom: calc(100% + 12px); left: 50%; transform: translateX(-50%);
            background: rgba(255,255,255,0.08); backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 8px 14px;
            font-size: 12px; white-space: nowrap; color: rgba(255,255,255,0.8);
            animation: chatBubblePop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            opacity: 0; pointer-events: none;
        }
        .agent-chat-bubble::after {
            content: ''; position: absolute; top: 100%; left: 50%; transform: translateX(-50%);
            border: 6px solid transparent; border-top-color: rgba(255,255,255,0.08);
        }
        /* ==================== CUSTOMER LOGO ==================== */
        .customer-logo-container {
            text-align: center;
            margin-bottom: 24px;
        }
        .customer-logo {
            height: 80px;
            width: auto;
            object-fit: contain;
            animation: fadeIn 0.6s ease-out;
        }
        .customer-logo-fallback {
            height: 80px;
            width: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(6, 214, 160, 0.2) 0%, rgba(6, 214, 160, 0.05) 100%);
            border: 2px solid rgba(6, 214, 160, 0.3);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 32px;
            color: #06D6A0;
            animation: fadeIn 0.6s ease-out;
        }
        .btn-primary.loading {
            opacity: 0.8;
            cursor: not-allowed;
        }
        .btn-primary.loading::after {
            content: '';
            display: inline-block;
            width: 12px;
            height: 12px;
            margin-left: 8px;
            border: 2px solid rgba(0, 0, 0, 0.3);
            border-top-color: #0A0A0F;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        </style>
</head>
<body>
<a href="#main-content" class="skip-link">Ga naar inhoud</a>
<div id="root"></div>

<script type="text/babel">
    const { useState, useRef, useEffect, useCallback, useMemo } = React;

    /* ==================== TRANSLATIONS ==================== */

    const translations = {
        nl: {
            appTitle: 'Decision Intelligence Platform',
            landingTitle: 'Hoe gezond beslist uw organisatie?',
            landingSubtitle: 'Onze 5 AI-agents analyseren uw besluitvorming in real-time. In 2 minuten ontdekt u exact waar u tijd en geld verliest — met een concreet actieplan.',
            enterEmail: 'Voer e-mailadres in',
            analyzeBtn: 'Analyseer mijn bedrijf',
            tryDemoBtn: 'Ontdek het platform →',
            scanTitle: 'Uw Besluitvormingsprofiel',
            scanSubtitle: 'Gepersonaliseerde analyse op basis van uw organisatieprofiel',
            health: 'Gezondheid',
            decisionDebt: 'Besluitvormingsschuld',
            companyName: 'Bedrijfsnaam',
            sector: 'Sector',
            employees: 'Medewerkers',
            avgDecisionTime: 'Gem. Besluitvormingstijd',
            openDecisions: 'Open Besluiten',
            meetingsPerWeek: 'Vergaderingen/week',
            painPoints: 'Pijnpunten',
            competitors: 'Concurrenten',
            engineTitle: 'Decision Engine',
            engineSubtitle: '5 gespecialiseerde agenten analyseren uw besluit',
            commandCenterTitle: 'Command Center',
            nextBtn: 'Volgende →',
            newDecisionBtn: 'Nieuwe Beslissing',
            exportBtn: 'Exporteer Rapport',
            healthBreakdown: 'Gezondheidsstelling Uitsplitsing',
            consensus: 'Agent Consensus Overzicht',
            agree: 'Eens',
            disagree: 'Oneens',
            confidenceInterval: 'Betrouwbaarheidsinterval 95%',
            step1: 'Scan',
            step2: 'Analyse',
            step3: 'Engine',
            step4: 'Command',
            live: 'AI ANALYSE',
            decisionSpeed: 'Besluitvormingssnelheid',
            dataMaturity: 'Data Volwassenheid',
            alignment: 'Afstemming',
            execution: 'Uitvoering',
            velocityMetric: 'Besluiten/week',
            debtMetric: 'Schuld',
            activeDecisions: 'Actieve Besluiten',
            healthMetric: 'Gezondheid',
            sectorBenchmark: 'Sector gem.',
            monteCarloExplain: 'Gebaseerd op sector-benchmarks en organisatieprofiel. Betrouwbaarheidsinterval: 95% CI.',
            enterDecisionQuestion: 'Voer uw beslissingsvraag in',
            customDecisionLabel: 'Aangepaste Vraag',
            invalidEmail: 'Voer een geldig e-mailadres in',
            copied: 'Gekopieerd naar klembord!',
            fullOutput: 'Volledige Output',
            confirmNewDecision: 'Alle voortgang gaat verloren. Zeker weten?'
        },
        en: {
            appTitle: 'Decision Intelligence Platform',
            landingTitle: 'How healthy are your decisions?',
            landingSubtitle: 'Our 5 AI agents analyze your decision-making in real-time. In 2 minutes, discover exactly where you lose time and money — with a concrete action plan.',
            enterEmail: 'Enter email address',
            analyzeBtn: 'Analyze My Organization',
            tryDemoBtn: 'Explore the platform →',
            scanTitle: 'Your Decision Profile',
            scanSubtitle: 'Personalized analysis based on your organization profile',
            health: 'Health',
            decisionDebt: 'Decision Debt',
            companyName: 'Company',
            sector: 'Sector',
            employees: 'Employees',
            avgDecisionTime: 'Avg. Decision Time',
            openDecisions: 'Open Decisions',
            meetingsPerWeek: 'Meetings/Week',
            painPoints: 'Pain Points',
            competitors: 'Competitors',
            engineTitle: 'Decision Engine',
            engineSubtitle: '5 specialized agents analyze your decision',
            commandCenterTitle: 'Command Center',
            nextBtn: 'Next →',
            newDecisionBtn: 'New Decision',
            exportBtn: 'Export Report',
            healthBreakdown: 'Health Score Breakdown',
            consensus: 'Agent Consensus Overview',
            agree: 'Agree',
            disagree: 'Disagree',
            confidenceInterval: '95% Confidence Interval',
            step1: 'Scan',
            step2: 'Analyse',
            step3: 'Engine',
            step4: 'Command',
            live: 'AI ANALYSIS',
            decisionSpeed: 'Decision Speed',
            dataMaturity: 'Data Maturity',
            alignment: 'Alignment',
            execution: 'Execution',
            velocityMetric: 'Decisions/week',
            debtMetric: 'Debt',
            activeDecisions: 'Active Decisions',
            healthMetric: 'Health',
            sectorBenchmark: 'Sector avg.',
            monteCarloExplain: 'Based on sector benchmarks and organizational profile. Confidence interval: 95% CI.',
            enterDecisionQuestion: 'Enter your decision question',
            customDecisionLabel: 'Custom Question',
            invalidEmail: 'Please enter a valid email address',
            copied: 'Copied to clipboard!',
            fullOutput: 'Full Output',
            confirmNewDecision: 'All progress will be lost. Are you sure?'
        }
    };

    const t = (lang) => translations[lang];

    /* ==================== INPUT SANITIZATION (Security) ==================== */

    const sanitizeInput = (input) => {
        if (typeof input !== 'string') return '';
        return input
            .replace(/[<>'"&]/g, c => ({'<':'&lt;','>':'&gt;',"'":'&#39;','"':'&quot;','&':'&amp;'}[c]))
            .trim()
            .slice(0, 500); // Max 500 chars to prevent abuse
    };

    /* ==================== RATE LIMITING (Security) ==================== */

    const rateLimiter = (() => {
        const calls = [];
        const MAX_CALLS = 10;
        const WINDOW_MS = 60000; // 1 minute
        return {
            canCall: () => {
                const now = Date.now();
                while (calls.length > 0 && calls[0] < now - WINDOW_MS) calls.shift();
                if (calls.length >= MAX_CALLS) return false;
                calls.push(now);
                return true;
            },
            remaining: () => {
                const now = Date.now();
                while (calls.length > 0 && calls[0] < now - WINDOW_MS) calls.shift();
                return MAX_CALLS - calls.length;
            }
        };
    })();

    /* ==================== SAFE HTML RENDERING ==================== */

    const markdownToSafeHtml = (text) => {
        if (!text) return '';

        let html = text
            .replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;')
            .replace(/"/g, '&quot;')
            .replace(/'/g, '&#039;');

        html = html
            .replace(/^## (.+)$/gm, '<h2>$1</h2>')
            .replace(/^### (.+)$/gm, '<h3>$1</h3>')
            .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
            .replace(/\*(.+?)\*/g, '<em>$1</em>')
            .replace(/^- (.+)$/gm, '<li>$1</li>')
            .replace(/(<li>.+<\/li>)/s, '<ul>$1</ul>')
            .replace(/\n\n/g, '</p><p>')
            .replace(/\n/g, '<br/>')
            .replace(/^(?!<[uh]|<li|<br)/gm, '<p>')
            .replace(/(?<!\/)>$/gm, (match, offset, str) => {
                if (str[offset - 1] !== '>') return '</p>';
                return match;
            });

        // Final safety: strip any remaining HTML-like tags that aren't whitelisted
        html = html.replace(/<(?!\/?(?:h[1-6]|p|br|ul|ol|li|strong|em|code)\b)[^>]*>/gi, '');

        return html;
    };

    /* ==================== CONSENSUS FROM AGENT OUTPUTS ==================== */

    const extractKeywords = (text, limit = 5) => {
        if (!text) return [];
        const words = text.toLowerCase()
            .replace(/[^a-z0-9\s]/g, '')
            .split(/\s+/)
            .filter(w => w.length > 3);

        const freq = {};
        words.forEach(w => freq[w] = (freq[w] || 0) + 1);

        return Object.entries(freq)
            .sort((a, b) => b[1] - a[1])
            .slice(0, limit)
            .map(([word]) => word);
    };

    const generateDynamicConsensus = (agentResults, lang) => {
        if (!agentResults || agentResults.length < 3) return null;

        const allText = agentResults
            .map(a => a.result?.text || '')
            .join(' ')
            .toLowerCase();

        const consensusItems = [];

        // Detect shared keywords
        const keywordCounts = {};
        agentResults.forEach(agent => {
            const text = (agent.result?.text || '').toLowerCase();
            const keywords = extractKeywords(text, 10);
            keywords.forEach(k => {
                keywordCounts[k] = (keywordCounts[k] || 0) + 1;
            });
        });

        // Find keywords mentioned by 3+ agents
        const sharedKeywords = Object.entries(keywordCounts)
            .filter(([_, count]) => count >= 3)
            .slice(0, 2)
            .map(([keyword]) => keyword);

        if (sharedKeywords.length > 0) {
            consensusItems.push({
                type: 'agree',
                text: lang === 'nl'
                    ? `Alle agenten benadrukken: ${sharedKeywords.join(', ')}`
                    : `All agents emphasize: ${sharedKeywords.join(', ')}`
            });
        }

        // Detect conflicts (Risk vs Options)
        const riskAgent = agentResults.find(a => a.name === 'Risk Agent');
        const optionsAgent = agentResults.find(a => a.name === 'Options Agent');

        if (riskAgent?.result?.text && optionsAgent?.result?.text) {
            const riskText = riskAgent.result.text.toLowerCase();
            const optionsText = optionsAgent.result.text.toLowerCase();

            if ((riskText.includes('hoog') || riskText.includes('high')) &&
                (optionsText.includes('voordeel') || optionsText.includes('advantage'))) {
                consensusItems.push({
                    type: 'disagree',
                    text: lang === 'nl'
                        ? '⚠️ Risk Agent waarschuwt; Options Agent ziet kansen'
                        : '⚠️ Risk Agent warns; Options Agent sees opportunities'
                });
            }
        }

        // Default consensus items
        if (consensusItems.length === 0) {
            consensusItems.push({
                type: 'agree',
                text: lang === 'nl'
                    ? 'Agenten zijn aligned op strategische richting'
                    : 'Agents are aligned on strategic direction'
            });
        }

        return consensusItems.length > 0 ? consensusItems : null;
    };

    /* ==================== UTILITY FUNCTIONS ==================== */

    const parseEmailDomain = (email) => {
        const fullDomain = email.split('@')[1];
        if (!fullDomain) return 'unknown.com';
        const parts = fullDomain.split('.');
        if (parts.length > 2) {
            return parts.slice(-2).join('.');
        }
        return fullDomain;
    };

    const getCompanyInitials = (name) => {
        return name.split(' ').map(w => w[0]).join('').toUpperCase().slice(0, 2);
    };

    const generateHealthBreakdown = (healthScore, companyName = '') => {
        const ratio = healthScore / 100;
        // Create seeded randomness based on company name for consistency
        const seed = companyName.split('').reduce((a, b) => {
            a = ((a << 5) - a) + b.charCodeAt(0);
            return a & a;
        }, 0);
        const pseudoRandom = Math.abs(Math.sin(seed) * 10000) % 1;

        const baseSpeed = 16;
        const baseMaturity = 14;
        const baseAlignment = 13;
        const baseExecution = 12;

        const speedMultiplier = 0.7 + pseudoRandom * 0.6;
        const maturityMultiplier = 0.8 + (pseudoRandom * 0.5 - 0.2);
        const alignmentMultiplier = 0.75 + (pseudoRandom * 0.4 - 0.1);
        const executionMultiplier = 0.9 + (pseudoRandom * 0.3);

        return {
            decisionSpeed: Math.round(baseSpeed * ratio * speedMultiplier),
            dataMaturity: Math.round(baseMaturity * ratio * maturityMultiplier),
            alignment: Math.round(baseAlignment * ratio * alignmentMultiplier),
            execution: Math.round(baseExecution * ratio * executionMultiplier)
        };
    };

    const CompanyLogo = ({ domain, size = 40 }) => {
        const [imgError, setImgError] = useState(false);
        const initials = getCompanyInitials(domain.split('.')[0]);

        return (
            <div style={{
                width: size, height: size, borderRadius: 12, background: 'rgba(6,214,160,0.1)',
                display: 'flex', alignItems: 'center', justifyContent: 'center',
                overflow: 'hidden', fontSize: size * 0.4, fontWeight: 700,
                color: 'white', flexShrink: 0
            }}>
                {!imgError ? (
                    <img
                        src={`https://logo.clearbit.com/${domain}`}
                        onError={() => setImgError(true)}
                        style={{ width: '100%', height: '100%', objectFit: 'cover' }}
                        alt={initials}
                    />
                ) : initials}
            </div>
        );
    };

    const LanguageToggle = ({ lang, setLang }) => (
        <div style={{
            display: 'flex', background: 'rgba(255,255,255,0.05)',
            borderRadius: 20, padding: 2, border: '1px solid rgba(255,255,255,0.1)'
        }}>
            {['NL', 'EN'].map(l => (
                <button
                    key={l}
                    onClick={() => setLang(l.toLowerCase())}
                    style={{
                        padding: '4px 12px', borderRadius: 18, fontSize: 11, fontWeight: 600,
                        background: lang === l.toLowerCase() ? 'rgba(6,214,160,0.2)' : 'transparent',
                        color: lang === l.toLowerCase() ? '#06D6A0' : 'rgba(255,255,255,0.5)',
                        border: lang === l.toLowerCase() ? '1px solid rgba(6,214,160,0.3)' : '1px solid transparent',
                        cursor: 'pointer', transition: 'all 0.2s', fontFamily: 'Inter, sans-serif'
                    }}
                    aria-label={`Switch to ${l === 'NL' ? 'Dutch' : 'English'}`}
                >
                    {l}
                </button>
            ))}
        </div>
    );

    const validateEmail = (email) => {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(email);
    };

    // Modern SVG icons for agents — no more emoji!
    // ─── Agent Avatars — unique character faces for The Decision Squad ───
    const AgentAvatar = ({ type, size = 56, color = '#fff' }) => {
        const s = size;
        const c = React.createElement;

        // Shared defs for all avatars
        const makeDefs = (id, col, skinLight, skinDark, hairCol) => c('defs', null,
            c('radialGradient', { id: id+'glow', cx: '50%', cy: '50%', r: '50%' },
                c('stop', { offset: '60%', stopColor: col, stopOpacity: 0 }),
                c('stop', { offset: '100%', stopColor: col, stopOpacity: 0.3 })
            ),
            c('linearGradient', { id: id+'skin', x1: 0, y1: 0, x2: 0, y2: 1 },
                c('stop', { offset: '0%', stopColor: skinLight }),
                c('stop', { offset: '100%', stopColor: skinDark })
            ),
            c('linearGradient', { id: id+'hair', x1: 0, y1: 0, x2: 1, y2: 1 },
                c('stop', { offset: '0%', stopColor: hairCol }),
                c('stop', { offset: '100%', stopColor: '#0a0a12' })
            ),
            c('radialGradient', { id: id+'cheek', cx: '50%', cy: '50%', r: '50%' },
                c('stop', { offset: '0%', stopColor: '#E8967A', stopOpacity: 0.25 }),
                c('stop', { offset: '100%', stopColor: '#E8967A', stopOpacity: 0 })
            ),
            c('linearGradient', { id: id+'lip', x1: 0, y1: 0, x2: 0, y2: 1 },
                c('stop', { offset: '0%', stopColor: '#D4726A' }),
                c('stop', { offset: '100%', stopColor: '#B85C5C' })
            ),
            c('filter', { id: id+'shadow', x: '-20%', y: '-20%', width: '140%', height: '140%' },
                c('feDropShadow', { dx: 0, dy: 1, stdDeviation: 1.5, floodColor: '#000', floodOpacity: 0.3 })
            )
        );

        // Rings around avatar
        const rings = (col) => [
            c('circle', { key: 'r1', cx: 32, cy: 32, r: 30.5, fill: 'none', stroke: col, strokeWidth: 1.5, opacity: 0.5 }),
            c('circle', { key: 'r2', cx: 32, cy: 32, r: 28, fill: 'none', stroke: col, strokeWidth: 0.6, opacity: 0.25, strokeDasharray: '2 3' })
        ];

        // Eye helper: realistic human eye with white, iris, pupil, highlight, lashes
        const eye = (cx, cy, irisCol, isLeft) => [
            // Eye white
            c('ellipse', { key: 'ew'+cx, cx, cy, rx: 4.5, ry: 2.8, fill: '#F5F0EB' }),
            // Iris
            c('circle', { key: 'ei'+cx, cx: cx + (isLeft ? 0.3 : -0.3), cy: cy - 0.2, r: 2.2, fill: irisCol }),
            // Pupil
            c('circle', { key: 'ep'+cx, cx: cx + (isLeft ? 0.3 : -0.3), cy: cy - 0.2, r: 1.1, fill: '#0a0a12' }),
            // Highlight
            c('circle', { key: 'eh'+cx, cx: cx + (isLeft ? 1 : 0.2), cy: cy - 1, r: 0.7, fill: '#fff', opacity: 0.9 }),
            c('circle', { key: 'eh2'+cx, cx: cx + (isLeft ? -0.5 : 0.5), cy: cy + 0.5, r: 0.4, fill: '#fff', opacity: 0.4 }),
            // Upper eyelid line
            c('path', { key: 'el'+cx, d: `M${cx-4.5} ${cy} Q${cx} ${cy-3.5} ${cx+4.5} ${cy}`, stroke: '#3D2B1F', strokeWidth: 0.8, fill: 'none' }),
            // Lashes (top)
            c('path', { key: 'la'+cx, d: `M${cx-3.5} ${cy-1.5} L${cx-4.2} ${cy-3}`, stroke: '#3D2B1F', strokeWidth: 0.5 }),
            c('path', { key: 'lb'+cx, d: `M${cx-1.5} ${cy-2.5} L${cx-1.8} ${cy-4}`, stroke: '#3D2B1F', strokeWidth: 0.5 }),
            c('path', { key: 'lc'+cx, d: `M${cx+0.5} ${cy-2.7} L${cx+0.5} ${cy-4.2}`, stroke: '#3D2B1F', strokeWidth: 0.5 }),
            c('path', { key: 'ld'+cx, d: `M${cx+2.5} ${cy-2.2} L${cx+3.2} ${cy-3.5}`, stroke: '#3D2B1F', strokeWidth: 0.5 })
        ];

        // Nose helper
        const nose = () => [
            c('path', { key: 'nose', d: 'M32 33 C31.5 35 30.5 37.5 29.5 38.5', stroke: '#C4956A', strokeWidth: 0.7, fill: 'none' }),
            c('path', { key: 'nosetip', d: 'M29.5 38.5 Q30.5 39.5 32 39 Q33.5 39.5 34.5 38.5', stroke: '#C4956A', strokeWidth: 0.6, fill: 'none' }),
            // Nostrils
            c('ellipse', { key: 'nl', cx: 30.5, cy: 39, rx: 1, ry: 0.5, fill: '#C4956A', opacity: 0.3 }),
            c('ellipse', { key: 'nr', cx: 33.5, cy: 39, rx: 1, ry: 0.5, fill: '#C4956A', opacity: 0.3 })
        ];

        // Lips helper
        const lips = (id) => [
            // Upper lip
            c('path', { key: 'ul', d: 'M27 42.5 Q29.5 41 32 42 Q34.5 41 37 42.5', fill: `url(#${id}lip)`, stroke: '#B85C5C', strokeWidth: 0.4 }),
            // Lower lip
            c('path', { key: 'll', d: 'M27 42.5 Q32 46 37 42.5', fill: `url(#${id}lip)`, opacity: 0.85 }),
            // Lip highlight
            c('ellipse', { key: 'lh', cx: 32, cy: 42, rx: 2, ry: 0.4, fill: '#fff', opacity: 0.15 })
        ];

        const avatars = {
            // ═══ NOVA — De Visionair: vrouw, flowing paars haar, mystieke blik ═══
            framing: c('svg', { width: s, height: s, viewBox: '0 0 64 64', fill: 'none' },
                makeDefs('nova', '#A78BFA', '#F2D5B8', '#D4A574', '#2D1B4E'),
                c('circle', { cx: 32, cy: 32, r: 31, fill: 'url(#novaglow)' }),
                ...rings('#A78BFA'),
                // Neck
                c('path', { d: 'M28 48 L28 56 Q32 58 36 56 L36 48', fill: 'url(#novaskin)' }),
                // Shoulders / collar
                c('path', { d: 'M18 58 Q22 52 28 54 L28 58 Q26 62 18 62Z', fill: '#2D1B4E' }),
                c('path', { d: 'M46 58 Q42 52 36 54 L36 58 Q38 62 46 62Z', fill: '#2D1B4E' }),
                // Hair back volume
                c('ellipse', { cx: 32, cy: 28, rx: 18, ry: 20, fill: 'url(#novahair)' }),
                // Face shape (oval, feminine)
                c('path', { d: 'M19 30 Q19 20 32 18 Q45 20 45 30 L44 40 Q42 50 32 52 Q22 50 20 40Z', fill: 'url(#novaskin)', filter: 'url(#novashadow)' }),
                // Cheek blush
                c('circle', { cx: 23, cy: 40, r: 4, fill: 'url(#novacheek)' }),
                c('circle', { cx: 41, cy: 40, r: 4, fill: 'url(#novacheek)' }),
                // Eyes
                ...eye(26, 32, '#8B6FC0', true),
                ...eye(38, 32, '#8B6FC0', false),
                // Eyebrows (arched, feminine)
                c('path', { d: 'M21.5 28.5 Q26 26 30.5 28', stroke: '#3D2B1F', strokeWidth: 0.9, fill: 'none' }),
                c('path', { d: 'M33.5 28 Q38 26 42.5 28.5', stroke: '#3D2B1F', strokeWidth: 0.9, fill: 'none' }),
                // Nose & lips
                ...nose(),
                ...lips('nova'),
                // Hair front (flowing, layered)
                c('path', { d: 'M19 26 Q16 18 24 14 Q30 12 36 13 Q44 15 46 22 Q47 28 45 30', fill: 'url(#novahair)' }),
                // Hair strands over face
                c('path', { d: 'M22 16 Q18 24 16 36 Q14 44 16 52', stroke: '#A78BFA', strokeWidth: 1.2, fill: 'none', opacity: 0.5 }),
                c('path', { d: 'M25 14 Q20 22 19 32', stroke: '#A78BFA', strokeWidth: 0.8, fill: 'none', opacity: 0.35 }),
                c('path', { d: 'M42 16 Q46 24 48 36 Q50 44 48 52', stroke: '#A78BFA', strokeWidth: 1.2, fill: 'none', opacity: 0.5 }),
                // Third-eye gem
                c('circle', { cx: 32, cy: 20, r: 2, fill: '#A78BFA', opacity: 0.8 }),
                c('circle', { cx: 32, cy: 20, r: 0.8, fill: '#fff', opacity: 0.9 }),
                // Sparkles
                c('circle', { cx: 10, cy: 14, r: 1, fill: '#A78BFA', opacity: 0.6 }),
                c('circle', { cx: 54, cy: 16, r: 0.8, fill: '#A78BFA', opacity: 0.4 })
            ),

            // ═══ BYTE — De Analyst: man, kort haar, bril, scherpe kaak ═══
            data: c('svg', { width: s, height: s, viewBox: '0 0 64 64', fill: 'none' },
                makeDefs('byte', '#60A5FA', '#E8C4A0', '#C89B72', '#1A1A2E'),
                c('circle', { cx: 32, cy: 32, r: 31, fill: 'url(#byteglow)' }),
                ...rings('#60A5FA'),
                // Neck
                c('path', { d: 'M27 48 L27 55 Q32 57 37 55 L37 48', fill: 'url(#byteskin)' }),
                // Shoulders / shirt collar
                c('path', { d: 'M15 60 Q20 52 27 54 L27 58 Q24 62 15 62Z', fill: '#1a2744' }),
                c('path', { d: 'M49 60 Q44 52 37 54 L37 58 Q40 62 49 62Z', fill: '#1a2744' }),
                c('path', { d: 'M29 54 L32 58 L35 54', fill: '#2a3a5e', stroke: '#60A5FA', strokeWidth: 0.3 }),
                // Hair back
                c('ellipse', { cx: 32, cy: 25, rx: 16, ry: 14, fill: 'url(#bytehair)' }),
                // Face (angular, masculine jaw)
                c('path', { d: 'M19 28 Q19 19 32 17 Q45 19 45 28 L44 38 Q43 48 37 50 L32 52 L27 50 Q21 48 20 38Z', fill: 'url(#byteskin)', filter: 'url(#byteshadow)' }),
                // 5 o'clock shadow
                c('path', { d: 'M23 42 Q27 44 32 45 Q37 44 41 42 L40 48 Q37 50 32 52 Q27 50 24 48Z', fill: '#1A1A2E', opacity: 0.08 }),
                // Eyes
                ...eye(26, 32, '#4A8FD4', true),
                ...eye(38, 32, '#4A8FD4', false),
                // Glasses
                c('rect', { x: 20, y: 28.5, width: 11, height: 8, rx: 2.5, fill: 'none', stroke: '#60A5FA', strokeWidth: 1 }),
                c('rect', { x: 33, y: 28.5, width: 11, height: 8, rx: 2.5, fill: 'none', stroke: '#60A5FA', strokeWidth: 1 }),
                c('line', { x1: 31, y1: 32, x2: 33, y2: 32, stroke: '#60A5FA', strokeWidth: 0.8 }),
                c('line', { x1: 20, y1: 32, x2: 17, y2: 30, stroke: '#60A5FA', strokeWidth: 0.6 }),
                c('line', { x1: 44, y1: 32, x2: 47, y2: 30, stroke: '#60A5FA', strokeWidth: 0.6 }),
                // Lens reflection
                c('path', { d: 'M22 30 L24 29', stroke: '#fff', strokeWidth: 0.4, opacity: 0.3 }),
                c('path', { d: 'M35 30 L37 29', stroke: '#fff', strokeWidth: 0.4, opacity: 0.3 }),
                // Strong eyebrows
                c('path', { d: 'M21 27 Q26 25 31 27.5', stroke: '#1A1A2E', strokeWidth: 1.2, fill: 'none' }),
                c('path', { d: 'M33 27.5 Q38 25 43 27', stroke: '#1A1A2E', strokeWidth: 1.2, fill: 'none' }),
                // Nose & mouth
                ...nose(),
                c('path', { d: 'M28 43 Q32 44.5 36 43', stroke: '#B88B6A', strokeWidth: 0.7, fill: 'none' }),
                // Hair top (neat, short)
                c('path', { d: 'M18 26 Q18 14 32 12 Q46 14 46 26 Q44 22 38 20 Q32 18 26 20 Q20 22 18 26Z', fill: 'url(#bytehair)' }),
                // Hair part line
                c('path', { d: 'M28 13 Q30 18 30 24', stroke: '#0a0a12', strokeWidth: 0.5, opacity: 0.3 }),
                // Data accents
                c('circle', { cx: 9, cy: 12, r: 1, fill: '#60A5FA', opacity: 0.5 }),
                c('circle', { cx: 55, cy: 50, r: 0.8, fill: '#60A5FA', opacity: 0.4 })
            ),

            // ═══ SPARK — De Strateeg: vrouw, dynamisch kort haar, zelfverzekerd ═══
            options: c('svg', { width: s, height: s, viewBox: '0 0 64 64', fill: 'none' },
                makeDefs('spark', '#06D6A0', '#F0CCA8', '#C89B72', '#1B3A2E'),
                c('circle', { cx: 32, cy: 32, r: 31, fill: 'url(#sparkglow)' }),
                ...rings('#06D6A0'),
                // Neck
                c('path', { d: 'M28 48 L28 55 Q32 57 36 55 L36 48', fill: 'url(#sparkskin)' }),
                // Shoulders / blazer
                c('path', { d: 'M14 60 Q20 52 28 54 L28 60 Q22 62 14 62Z', fill: '#0D2818' }),
                c('path', { d: 'M50 60 Q44 52 36 54 L36 60 Q42 62 50 62Z', fill: '#0D2818' }),
                c('line', { x1: 28, y1: 54, x2: 32, y2: 62, stroke: '#06D6A0', strokeWidth: 0.4, opacity: 0.5 }),
                c('line', { x1: 36, y1: 54, x2: 32, y2: 62, stroke: '#06D6A0', strokeWidth: 0.4, opacity: 0.5 }),
                // Hair back
                c('ellipse', { cx: 32, cy: 26, rx: 17, ry: 18, fill: 'url(#sparkhair)' }),
                // Face (heart-shaped, confident)
                c('path', { d: 'M19 29 Q19 19 32 17 Q45 19 45 29 L44 38 Q42 49 32 51 Q22 49 20 38Z', fill: 'url(#sparkskin)', filter: 'url(#sparkshadow)' }),
                // Cheek blush
                c('circle', { cx: 23, cy: 40, r: 3.5, fill: 'url(#sparkcheek)' }),
                c('circle', { cx: 41, cy: 40, r: 3.5, fill: 'url(#sparkcheek)' }),
                // Eyes (sharp, determined)
                ...eye(26, 32, '#2E8B6F', true),
                ...eye(38, 32, '#2E8B6F', false),
                // Arched brows
                c('path', { d: 'M21 27.5 Q26 25 31 27.5', stroke: '#1B3A2E', strokeWidth: 1.1, fill: 'none' }),
                c('path', { d: 'M33 27.5 Q38 25 43 27.5', stroke: '#1B3A2E', strokeWidth: 1.1, fill: 'none' }),
                // Nose & confident smile
                ...nose(),
                ...lips('spark'),
                // Hair front (textured pixie cut with side-swept bangs)
                c('path', { d: 'M17 28 Q16 16 28 12 Q34 11 40 13 Q48 16 48 28', fill: 'url(#sparkhair)' }),
                c('path', { d: 'M17 28 Q20 22 28 20 L22 28Z', fill: '#1B3A2E' }),
                c('path', { d: 'M20 24 Q24 18 30 16 L24 24Z', fill: '#1B3A2E', opacity: 0.8 }),
                // Green hair highlights
                c('path', { d: 'M22 14 Q26 18 24 26', stroke: '#06D6A0', strokeWidth: 0.8, fill: 'none', opacity: 0.4 }),
                c('path', { d: 'M38 13 Q42 16 44 24', stroke: '#06D6A0', strokeWidth: 0.6, fill: 'none', opacity: 0.3 }),
                // Earring (lightning bolt)
                c('polygon', { points: '17,40 16,43 18,42 16.5,46', fill: '#06D6A0', opacity: 0.85 }),
                // Sparkle accents
                c('circle', { cx: 8, cy: 10, r: 1.2, fill: '#06D6A0', opacity: 0.6 }),
                c('circle', { cx: 56, cy: 14, r: 0.7, fill: '#06D6A0', opacity: 0.4 })
            ),

            // ═══ SHIELD — De Bewaker: man, krachtig, baard, litteken ═══
            risk: c('svg', { width: s, height: s, viewBox: '0 0 64 64', fill: 'none' },
                makeDefs('shield', '#FBBF24', '#DEB88A', '#B8895E', '#2A1F0E'),
                c('circle', { cx: 32, cy: 32, r: 31, fill: 'url(#shieldglow)' }),
                ...rings('#FBBF24'),
                // Neck (thick)
                c('path', { d: 'M26 48 L26 55 Q32 57 38 55 L38 48', fill: 'url(#shieldskin)' }),
                // Shoulders (broad, armored look)
                c('path', { d: 'M12 60 Q18 50 26 52 L26 58 Q20 62 12 62Z', fill: '#2A1F0E' }),
                c('path', { d: 'M52 60 Q46 50 38 52 L38 58 Q44 62 52 62Z', fill: '#2A1F0E' }),
                c('path', { d: 'M26 52 L32 56 L38 52', fill: '#3D2E16', stroke: '#FBBF24', strokeWidth: 0.3, opacity: 0.6 }),
                // Hair back
                c('ellipse', { cx: 32, cy: 25, rx: 16, ry: 15, fill: 'url(#shieldhair)' }),
                // Face (square, strong jaw)
                c('path', { d: 'M18 28 Q18 18 32 16 Q46 18 46 28 L45 38 Q44 46 39 49 L32 52 L25 49 Q20 46 19 38Z', fill: 'url(#shieldskin)', filter: 'url(#shieldshadow)' }),
                // Beard (full, trimmed)
                c('path', { d: 'M22 40 Q22 38 24 36 L24 42 Q27 48 32 50 Q37 48 40 42 L40 36 Q42 38 42 40 L41 46 Q38 52 32 54 Q26 52 23 46Z', fill: '#2A1F0E', opacity: 0.6 }),
                c('path', { d: 'M24 42 Q28 46 32 48 Q36 46 40 42', fill: '#2A1F0E', opacity: 0.4 }),
                // Mustache
                c('path', { d: 'M27 41 Q30 40 32 41.5 Q34 40 37 41 Q34 43 32 43.5 Q30 43 27 41Z', fill: '#2A1F0E', opacity: 0.55 }),
                // Eyes (intense, deep-set)
                ...eye(26, 32, '#8B7340', true),
                ...eye(38, 32, '#8B7340', false),
                // Heavy brow ridge
                c('path', { d: 'M20 27 Q26 24.5 31 27', stroke: '#2A1F0E', strokeWidth: 1.5, fill: 'none' }),
                c('path', { d: 'M33 27 Q38 24.5 44 27', stroke: '#2A1F0E', strokeWidth: 1.5, fill: 'none' }),
                // Brow shadow
                c('path', { d: 'M20 28 Q26 26 31 28 L31 30 Q26 28 20 30Z', fill: '#000', opacity: 0.06 }),
                c('path', { d: 'M33 28 Q38 26 44 28 L44 30 Q38 28 33 30Z', fill: '#000', opacity: 0.06 }),
                // Nose (broader)
                c('path', { d: 'M32 33 C31.5 35 31 37 29 38.5', stroke: '#B8895E', strokeWidth: 0.8, fill: 'none' }),
                c('path', { d: 'M29 38.5 Q31 39.8 32 39.2 Q33 39.8 35 38.5', stroke: '#B8895E', strokeWidth: 0.7, fill: 'none' }),
                // Scar on left cheek
                c('path', { d: 'M42 34 L44 38 L43 42', stroke: '#C89B72', strokeWidth: 0.8, opacity: 0.5 }),
                // Hair (buzz cut / very short)
                c('path', { d: 'M18 27 Q18 13 32 11 Q46 13 46 27 Q44 22 38 19 Q32 17 26 19 Q20 22 18 27Z', fill: 'url(#shieldhair)' }),
                // Gold accents
                c('circle', { cx: 8, cy: 14, r: 1, fill: '#FBBF24', opacity: 0.6 }),
                c('circle', { cx: 56, cy: 48, r: 0.8, fill: '#FBBF24', opacity: 0.4 })
            ),

            // ═══ SAGE — De Adviseur: vrouw, elegant, wijs, warmte ═══
            recommendation: c('svg', { width: s, height: s, viewBox: '0 0 64 64', fill: 'none' },
                makeDefs('sage', '#EC4899', '#F2D5B8', '#D4A574', '#2E1525'),
                c('circle', { cx: 32, cy: 32, r: 31, fill: 'url(#sageglow)' }),
                ...rings('#EC4899'),
                // Neck (elegant)
                c('path', { d: 'M28 48 L28 55 Q32 57 36 55 L36 48', fill: 'url(#sageskin)' }),
                // Shoulders / elegant dress
                c('path', { d: 'M16 60 Q22 52 28 54 L28 60 Q24 62 16 62Z', fill: '#2E1525' }),
                c('path', { d: 'M48 60 Q42 52 36 54 L36 60 Q40 62 48 62Z', fill: '#2E1525' }),
                // Necklace
                c('path', { d: 'M26 54 Q28 56 32 57 Q36 56 38 54', stroke: '#EC4899', strokeWidth: 0.6, fill: 'none', opacity: 0.6 }),
                c('circle', { cx: 32, cy: 57, r: 1.2, fill: '#EC4899', opacity: 0.5 }),
                // Hair back (long, dark with magenta tints)
                c('ellipse', { cx: 32, cy: 26, rx: 18, ry: 22, fill: 'url(#sagehair)' }),
                // Face (soft oval, elegant)
                c('path', { d: 'M19 30 Q19 20 32 18 Q45 20 45 30 L44 40 Q42 50 32 52 Q22 50 20 40Z', fill: 'url(#sageskin)', filter: 'url(#sageshadow)' }),
                // Cheek blush (warm)
                c('circle', { cx: 23, cy: 40, r: 4, fill: 'url(#sagecheek)' }),
                c('circle', { cx: 41, cy: 40, r: 4, fill: 'url(#sagecheek)' }),
                // Eyes (warm, wise, slightly larger)
                ...eye(26, 32, '#9B5A8C', true),
                ...eye(38, 32, '#9B5A8C', false),
                // Elegant arched brows
                c('path', { d: 'M21 28 Q26 25.5 31 27.5', stroke: '#2E1525', strokeWidth: 0.9, fill: 'none' }),
                c('path', { d: 'M33 27.5 Q38 25.5 43 28', stroke: '#2E1525', strokeWidth: 0.9, fill: 'none' }),
                // Nose & soft smile
                ...nose(),
                ...lips('sage'),
                // Hair front (elegant updo with side bangs)
                c('path', { d: 'M18 28 Q17 16 26 12 Q32 10 38 12 Q47 16 46 28', fill: 'url(#sagehair)' }),
                // Updo bun
                c('ellipse', { cx: 32, cy: 12, rx: 8, ry: 6, fill: '#2E1525' }),
                c('path', { d: 'M24 12 Q28 6 32 8 Q36 6 40 12', fill: '#2E1525' }),
                // Hair accessory (pin with gem)
                c('circle', { cx: 38, cy: 10, r: 1.5, fill: '#EC4899', opacity: 0.8 }),
                c('circle', { cx: 38, cy: 10, r: 0.6, fill: '#fff', opacity: 0.9 }),
                // Side hair strands
                c('path', { d: 'M18 28 Q16 36 14 46', stroke: '#2E1525', strokeWidth: 2.5, fill: 'none' }),
                c('path', { d: 'M46 28 Q48 36 50 46', stroke: '#2E1525', strokeWidth: 2.5, fill: 'none' }),
                c('path', { d: 'M15 38 Q14 42 15 48', stroke: '#EC4899', strokeWidth: 0.6, fill: 'none', opacity: 0.3 }),
                c('path', { d: 'M49 38 Q50 42 49 48', stroke: '#EC4899', strokeWidth: 0.6, fill: 'none', opacity: 0.3 }),
                // Earrings (dangling crystals)
                c('line', { x1: 18, y1: 38, x2: 17, y2: 42, stroke: '#EC4899', strokeWidth: 0.5, opacity: 0.6 }),
                c('circle', { cx: 17, cy: 43, r: 1.2, fill: '#EC4899', opacity: 0.6 }),
                c('line', { x1: 46, y1: 38, x2: 47, y2: 42, stroke: '#EC4899', strokeWidth: 0.5, opacity: 0.6 }),
                c('circle', { cx: 47, cy: 43, r: 1.2, fill: '#EC4899', opacity: 0.6 }),
                // Aura sparkles
                c('circle', { cx: 8, cy: 18, r: 1, fill: '#EC4899', opacity: 0.5 }),
                c('circle', { cx: 56, cy: 14, r: 0.7, fill: '#EC4899', opacity: 0.4 }),
                c('circle', { cx: 54, cy: 52, r: 0.9, fill: '#EC4899', opacity: 0.3 })
            )
        };
        return avatars[type] || avatars.framing;
    };

    const AgentSvgIcon = ({ type, size = 22, color = 'currentColor' }) => {
        const icons = {
            framing: React.createElement('svg', { width: size, height: size, viewBox: '0 0 24 24', fill: 'none', stroke: color, strokeWidth: 1.8, strokeLinecap: 'round', strokeLinejoin: 'round' },
                React.createElement('path', { d: 'M12 2L2 7l10 5 10-5-10-5z' }),
                React.createElement('path', { d: 'M2 17l10 5 10-5' }),
                React.createElement('path', { d: 'M2 12l10 5 10-5' })
            ),
            data: React.createElement('svg', { width: size, height: size, viewBox: '0 0 24 24', fill: 'none', stroke: color, strokeWidth: 1.8, strokeLinecap: 'round', strokeLinejoin: 'round' },
                React.createElement('path', { d: 'M21 12V7H5a2 2 0 0 1 0-4h14v4' }),
                React.createElement('path', { d: 'M3 5v14a2 2 0 0 0 2 2h16v-5' }),
                React.createElement('path', { d: 'M18 12a2 2 0 0 0 0 4h4v-4h-4z' })
            ),
            options: React.createElement('svg', { width: size, height: size, viewBox: '0 0 24 24', fill: 'none', stroke: color, strokeWidth: 1.8, strokeLinecap: 'round', strokeLinejoin: 'round' },
                React.createElement('line', { x1: '12', y1: '2', x2: '12', y2: '6' }),
                React.createElement('line', { x1: '12', y1: '18', x2: '12', y2: '22' }),
                React.createElement('line', { x1: '4.93', y1: '4.93', x2: '7.76', y2: '7.76' }),
                React.createElement('line', { x1: '16.24', y1: '16.24', x2: '19.07', y2: '19.07' }),
                React.createElement('line', { x1: '2', y1: '12', x2: '6', y2: '12' }),
                React.createElement('line', { x1: '18', y1: '12', x2: '22', y2: '12' }),
                React.createElement('circle', { cx: '12', cy: '12', r: '4' })
            ),
            risk: React.createElement('svg', { width: size, height: size, viewBox: '0 0 24 24', fill: 'none', stroke: color, strokeWidth: 1.8, strokeLinecap: 'round', strokeLinejoin: 'round' },
                React.createElement('path', { d: 'M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z' }),
                React.createElement('path', { d: 'M12 8v4' }),
                React.createElement('path', { d: 'M12 16h.01' })
            ),
            recommendation: React.createElement('svg', { width: size, height: size, viewBox: '0 0 24 24', fill: 'none', stroke: color, strokeWidth: 1.8, strokeLinecap: 'round', strokeLinejoin: 'round' },
                React.createElement('polygon', { points: '12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2' })
            )
        };
        return icons[type] || icons.framing;
    };

    const generateDemoResponses = (agentName, companyData, lang) => {
        const company = typeof companyData === 'string' ? companyData : companyData.company;
        const sector = typeof companyData === 'object' ? companyData.sector : 'Technologie';
        const painPoints = typeof companyData === 'object' && companyData.painPoints ? companyData.painPoints : [];

        // Get sector-specific context
        let sectorContext = '';
        let sectorBenchmark = '';
        let sectorMetrics = '';

        if (sector.includes('Retail') || sector.includes('Voeding')) {
            sectorContext = lang === 'nl' ? 'retail en voedingsindustrie' : 'retail and food industry';
            sectorBenchmark = lang === 'nl' ? 'Gemiddelde besluitvormingstijd in retail: 10-14 weken' : 'Average decision time in retail: 10-14 weeks';
            sectorMetrics = lang === 'nl' ? 'Supply chain volatiliteit: 15-20% maandelijks' : 'Supply chain volatility: 15-20% monthly';
        } else if (sector.includes('Healthcare')) {
            sectorContext = lang === 'nl' ? 'gezondheidszorg en onderzoek' : 'healthcare and research';
            sectorBenchmark = lang === 'nl' ? 'Gemiddelde besluitvormingstijd in healthcare: 12-16 weken' : 'Average decision time in healthcare: 12-16 weeks';
            sectorMetrics = lang === 'nl' ? 'Patiënt impact timeline: kritiek' : 'Patient impact timeline: critical';
        } else if (sector.includes('Technology') || sector.includes('Internet')) {
            sectorContext = lang === 'nl' ? 'technologie en cloud' : 'technology and cloud';
            sectorBenchmark = lang === 'nl' ? 'Gemiddelde besluitvormingstijd in tech: 5-8 weken' : 'Average decision time in tech: 5-8 weeks';
            sectorMetrics = lang === 'nl' ? 'Innovatie cycle: snelle iteratie vereist' : 'Innovation cycle: rapid iteration required';
        } else if (sector.includes('Project Management') || sector.includes('Consultancy')) {
            sectorContext = lang === 'nl' ? 'projectmanagement en consultancy' : 'project management and consultancy';
            sectorBenchmark = lang === 'nl' ? 'Gemiddelde besluitvormingstijd in consultancy: 4-6 weken' : 'Average decision time in consultancy: 4-6 weeks';
            sectorMetrics = lang === 'nl' ? 'Client satisfaction afhangt van snelheid' : 'Client satisfaction depends on speed';
        } else {
            sectorContext = lang === 'nl' ? 'digitale transformatie' : 'digital transformation';
            sectorBenchmark = lang === 'nl' ? 'Gemiddelde besluitvormingstijd: 8-10 weken' : 'Average decision time: 8-10 weeks';
            sectorMetrics = lang === 'nl' ? 'Decision velocity: kritieke competitieve voordeel' : 'Decision velocity: critical competitive advantage';
        }

        const demoData = {
            'Framing Agent': {
                nl: `## Kernvraag Herformulering voor ${company}\n\nDe onderliggende beslissingsvraag luidt: _"Hoe optimaliseren we onze ${sectorContext} strategie?"_\n\n### Beslissingsdimensies\n\n1. **Strategische richting**: ${painPoints[0] ? painPoints[0].split(' ')[0] : 'Innovatie'} vs. operationele excellence\n2. **Marktpositionering**: Agressieve groei vs. consolidatie\n3. **Organisatieinvestering**: Capaciteitsuitbreiding vs. extern sourcing\n4. **Timing**: Snelle schaal vs. voorzichtige opbouw`,
                en: `## Decision Question Reframing for ${company}\n\nThe underlying decision question reads: _"How do we optimize our ${sectorContext} strategy?"_\n\n### Decision Dimensions\n\n1. **Strategic Direction**: ${painPoints[0] ? painPoints[0].split(' ')[0] : 'Innovation'} vs. operational excellence\n2. **Market Positioning**: Aggressive growth vs. consolidation\n3. **Organizational Investment**: Capacity expansion vs. external sourcing\n4. **Timing**: Rapid scaling vs. careful build-up`
            },
            'Data Agent': {
                nl: `## Data-gedreven Analyse voor ${company}\n\n**Markttrends** (McKinsey, Gartner 2025):\n- 78% van bedrijven in ${sector} geeft voorkeur aan gespecialiseerde leveranciers\n- Gemiddelde time-to-market korting: 35% bij juiste technologiestack\n- Customer retention stijgt 23% bij improved decision velocity\n\n**Sectorale Benchmarks**:\n- ${sectorBenchmark}\n- Decision debt ratio sector avg: 3.2% van omzet\n- Top performers: 4.5x sneller in executie\n\n**Interne Signalen voor ${company}**:\n- ${sectorMetrics}\n- Open decisions accumulation: kritiek voor groei\n- Meeting overhead aanpak: nodig voor efficiëntie`,
                en: `## Data-driven Analysis for ${company}\n\n**Market Trends** (McKinsey, Gartner 2025):\n- 78% of companies in ${sector} prefer specialized vendors\n- Average time-to-market reduction: 35% with right technology stack\n- Customer retention increases 23% with improved decision velocity\n\n**Sector Benchmarks**:\n- ${sectorBenchmark}\n- Decision debt ratio sector average: 3.2% of revenue\n- Top performers: 4.5x faster in execution\n\n**Internal Signals for ${company}**:\n- ${sectorMetrics}\n- Open decisions accumulation: critical for growth\n- Meeting overhead approach: needed for efficiency`
            },
            'Options Agent': {
                nl: `## Strategische Opties voor ${company}\n\n### Optie A: Agressieve ${sector.includes('Retail') ? 'Expansion' : 'Innovatie'}-Led Growth\n**Beschrijving**: ${sector.includes('Retail') ? 'Nieuwe locaties & formaten' : 'Agressieve R&D-investering'}, nieuwe marktcategorie\n- ✅ Hoog groeipotentieel, sterke differentiatie\n- ✅ Lange-termijn marge-verbetering\n- ⚠️ Hoge initiële investeringen, significant risico\n- ⚠️ 18-24 maanden tot ROI\n\n### Optie B: Operationele Excellence\n**Beschrijving**: ${sector.includes('Retail') ? 'Supply chain & efficiency' : 'Procesoptimalisatie'}, margin-verbetering\n- ✅ Snellere ROI (6-9 maanden)\n- ✅ Lager risico, predictable returns\n- ⚠️ Begrensd groeipotentieel\n- ⚠️ Moeilijker differentiatie\n\n### Optie C: Strategische Partnership Approach\n**Beschrijving**: Selectieve innovatie + partnerschappen\n- ✅ Gebalanceerd risico-rendement\n- ✅ Sneller naar markt met partners\n- ⚠️ Complexere governance\n- ⚠️ Dependency op partners`,
                en: `## Strategic Options for ${company}\n\n### Option A: Aggressive ${sector.includes('Retail') ? 'Expansion' : 'Innovation'}-Led Growth\n**Description**: ${sector.includes('Retail') ? 'New locations & formats' : 'Aggressive R&D investment'}, new market category\n- ✅ High growth potential, strong differentiation\n- ✅ Long-term margin improvement\n- ⚠️ High initial investments, significant risk\n- ⚠️ 18-24 months to ROI\n\n### Option B: Operational Excellence\n**Description**: ${sector.includes('Retail') ? 'Supply chain & efficiency' : 'Process optimization'}, margin improvement\n- ✅ Faster ROI (6-9 months)\n- ✅ Lower risk, predictable returns\n- ⚠️ Limited growth potential\n- ⚠️ Harder differentiation\n\n### Option C: Strategic Partnership Approach\n**Description**: Selective innovation + partnerships\n- ✅ Balanced risk-return\n- ✅ Faster to market with partners\n- ⚠️ Complex governance\n- ⚠️ Partner dependency`
            },
            'Risk Agent': {
                nl: `## Risico-analyse per Optie voor ${company}\n\n### Optie A: Agressieve Groei\n**Risico-niveau: HOOG**\n- ${sector.includes('Retail') ? 'Marktexpansie risico: 55% voorziene winstmarges' : 'Technologisch risico: 65% execution misses'}\n- ${sector.includes('Healthcare') ? 'Patiëntcare risico: Operationele complexiteit' : 'Marktrisico: Product-market fit onzekerheid'}\n- Financieel risico: Budget overruns (35% gemiddeld)\n- Mitigatie: Phased rollout, external partnership\n\n### Optie B: Operationele Excellence\n**Risico-niveau: GEMIDDELD**\n- ${sector.includes('Retail') ? 'Technologie risico: Legacy systemen integratie' : 'Change management risico: Weerstand medewer'}\n- ${sector.includes('Healthcare') ? 'Patiëntflow risico: Verstoringen minimaal' : 'Processisico: Kennisvaandel tijdens transformatie'}\n- Mitigatie: Structured change program, phased rollout\n\n### Optie C: Strategic Partnerships\n**Risico-niveau: GEMIDDELD**\n- Partner afhankelijkheid risico: Controle verlies\n- Integratie risico: Systeem & cultuur misalignment\n- Mitigatie: Strong SLA's, governance framework`,
                en: `## Risk Analysis per Option for ${company}\n\n### Option A: Aggressive Growth\n**Risk Level: HIGH**\n- ${sector.includes('Retail') ? 'Market expansion risk: 55% margin pressure' : 'Technology risk: 65% execution misses'}\n- ${sector.includes('Healthcare') ? 'Patient care risk: Operational complexity' : 'Market risk: Product-market fit uncertainty'}\n- Financial risk: Budget overruns (35% average)\n- Mitigation: Phased rollout, external partnership\n\n### Option B: Operational Excellence\n**Risk Level: MEDIUM**\n- ${sector.includes('Retail') ? 'Technology risk: Legacy system integration' : 'Change management risk: Employee resistance'}\n- ${sector.includes('Healthcare') ? 'Patient flow risk: Minimal disruptions' : 'Process risk: Knowledge loss during transformation'}\n- Mitigation: Structured change program, phased rollout\n\n### Option C: Strategic Partnerships\n**Risk Level: MEDIUM**\n- Partner dependency risk: Loss of control\n- Integration risk: System & culture misalignment\n- Mitigation: Strong SLAs, governance framework`
            },
            'Recommendation Agent': {
                nl: `## Definitieve Aanbeveling voor ${company}\n\n### Aanbevolen Optie: Strategic Partnership Approach (Optie C)\n\n**Onderbouwing:**\n\n1. **${sector}fitheid**: Balanceert groei met ${sector.includes('Retail') ? 'supply chain' : 'operationele'} risico-management\n2. **Organisatorische Capaciteit**: Aligned met huidge governance maturity van ${company}\n3. **Financiële Rendement**: Best risk-adjusted return in sector\n\n### Implementatieplan voor ${company}\n\n**Week 1-2**: Partner evaluatie, quick-win identificatie\n**Week 3-6**: Phase 1 rollout, skill-building met partners\n**Week 7-12**: Evaluatie, volgende fase pilot launch\n**Week 13+**: Scale-out, continuous optimization\n\n### Verwacht Resultaat\n- Decision velocity: +40% in 6 maanden\n- ${sector.includes('Retail') ? 'Operating margin: +2-3% in 12 maanden' : 'Operational efficiency: +25% in 12 maanden'}\n- Market differentiation: Positieve feedback in Q2`,
                en: `## Final Recommendation for ${company}\n\n### Recommended Option: Strategic Partnership Approach (Option C)\n\n**Justification:**\n\n1. **${sector} Fit**: Balances growth with ${sector.includes('Retail') ? 'supply chain' : 'operational'} risk management\n2. **Organizational Capacity**: Aligned with current governance maturity of ${company}\n3. **Financial Return**: Best risk-adjusted return in sector\n\n### Implementation Plan for ${company}\n\n**Week 1-2**: Partner evaluation, quick-win identification\n**Week 3-6**: Phase 1 rollout, skill-building with partners\n**Week 7-12**: Evaluation, next phase pilot launch\n**Week 13+**: Scale-out, continuous optimization\n\n### Expected Outcome\n- Decision velocity: +40% in 6 months\n- ${sector.includes('Retail') ? 'Operating margin: +2-3% in 12 months' : 'Operational efficiency: +25% in 12 months'}\n- Market differentiation: Positive feedback in Q2`
            }
        };

        return demoData[agentName]?.[lang] || demoData[agentName]?.nl || '';
    };

    /* ==================== API CALLS — DIRECT ANTHROPIC API ==================== */

    // API key is loaded from localStorage — if not set, app runs in demo mode (no popup)
    let ANTHROPIC_API_KEY = localStorage.getItem('cheevo_api_key') || '';

    function ensureApiKey() {
        if (ANTHROPIC_API_KEY) return true;
        // No popup — silently fall back to demo mode
        return false;
    }

    // Allow users to set API key via Settings or console: setCheevoApiKey('sk-ant-...')
    window.setCheevoApiKey = function(key) {
        if (key && key.startsWith('sk-ant-')) {
            ANTHROPIC_API_KEY = key;
            localStorage.setItem('cheevo_api_key', key);
            console.log('✅ API key saved! Reload to use live AI.');
            return true;
        }
        console.log('❌ Invalid key. Must start with sk-ant-');
        return false;
    };
    const ANTHROPIC_MODEL = 'claude-sonnet-4-5-20250929';

    // Direct call to Anthropic API from browser (CORS enabled with dangerous-direct-browser-access header)
    async function callAnthropicDirect(systemPrompt, userMessage, maxTokens = 2048, temperature = 0.7) {
        if (!ensureApiKey()) throw new Error('No API key — using demo mode');
        if (!rateLimiter.canCall()) throw new Error('Rate limit exceeded — please wait before making more requests');
        const response = await fetch('https://api.anthropic.com/v1/messages', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'x-api-key': ANTHROPIC_API_KEY,
                'anthropic-version': '2023-06-01',
                'anthropic-dangerous-direct-browser-access': 'true'
            },
            body: JSON.stringify({
                model: ANTHROPIC_MODEL,
                max_tokens: maxTokens,
                temperature: temperature,
                system: systemPrompt,
                messages: [{ role: 'user', content: userMessage }]
            })
        });
        if (!response.ok) {
            const errData = await response.json().catch(() => ({}));
            throw new Error(`Anthropic API ${response.status}: ${errData.error?.message || 'Unknown error'}`);
        }
        const data = await response.json();
        return data.content?.[0]?.text || '';
    }

    // Wrapper for agent chat calls
    async function callCheevoAPI(systemPrompt, userMessage) {
        const startTime = Date.now();
        try {
            const text = await callAnthropicDirect(systemPrompt, userMessage, 2048, 0.7);
            return {
                text: text,
                elapsed: ((Date.now() - startTime) / 1000).toFixed(1),
                isLive: true,
                timestamp: new Date().toLocaleTimeString(undefined, { hour: '2-digit', minute: '2-digit', second: '2-digit' })
            };
        } catch (error) {
            console.error('Agent API call failed:', error);
            return {
                text: null,
                elapsed: 0,
                isLive: false,
                timestamp: new Date().toLocaleTimeString(undefined, { hour: '2-digit', minute: '2-digit', second: '2-digit' })
            };
        }
    }

    // ─── Analysis angles for unique scan results ───
    function getRandomAnalysisAngle(lang) {
        const anglesNl = [
            'Focus op de impact van recente technologische disruptie op hun besluitvormingsproces',
            'Analyseer vanuit het perspectief van talent-retentie en de war for talent',
            'Bekijk dit vanuit supply chain kwetsbaarheden en operationele veerkracht',
            'Focus op ESG-druk en duurzaamheidstransitie als besluitvormingsfactor',
            'Analyseer de impact van AI-adoptie en digitale transformatie op hun concurrentiepositie',
            'Bekijk vanuit klantervaring en de shift naar hyperpersonalisatie',
            'Focus op regelgevingsdruk en compliance-kosten als strategische uitdaging',
            'Analyseer vanuit margedruk en de noodzaak tot operationele excellentie',
            'Bekijk vanuit het perspectief van M&A-activiteit en marktconsolidatie in hun sector',
            'Focus op cybersecurity-risicos en dataprivacy als boardroom-prioriteit',
            'Analyseer vanuit de uitdaging van remote/hybrid werken op organisatiecultuur',
            'Bekijk vanuit generatieverschillen in consumenten- en werknemersgedrag'
        ];
        const anglesEn = [
            'Focus on the impact of recent technological disruption on their decision-making process',
            'Analyze from the perspective of talent retention and the war for talent',
            'View this from supply chain vulnerabilities and operational resilience',
            'Focus on ESG pressure and sustainability transition as a decision-making factor',
            'Analyze the impact of AI adoption and digital transformation on their competitive position',
            'View from customer experience and the shift toward hyper-personalization',
            'Focus on regulatory pressure and compliance costs as a strategic challenge',
            'Analyze from margin pressure and the need for operational excellence',
            'View from the perspective of M&A activity and market consolidation in their sector',
            'Focus on cybersecurity risks and data privacy as a boardroom priority',
            'Analyze from the challenge of remote/hybrid work on organizational culture',
            'View from generational differences in consumer and employee behavior'
        ];
        const angles = lang === 'nl' ? anglesNl : anglesEn;
        return angles[Math.floor(Math.random() * angles.length)];
    }

    // ─── Company Scan — calls Claude API directly from browser ───
    async function performCompanyScan(company, sector, domain, employees, lang) {
        const now = new Date();
        const today = now.toISOString().split('T')[0];
        const timeStr = now.toTimeString().split(' ')[0];
        const requestId = Math.random().toString(36).substring(2, 8);
        const isNl = lang === 'nl';
        const analysisAngle = getRandomAnalysisAngle(lang);

        const systemPrompt = isNl
            ? `Je bent een besluitvormingsadviseur die actuele bedrijfscontext analyseert. Vandaag is ${today}, het is nu ${timeStr} CET. Request-ID: ${requestId}. Je bent een expert in de sector "${sector}" en kent de Belgische en Europese markt goed.

UNIEKE ANALYSE-INVALSHOEK VOOR DEZE SCAN: ${analysisAngle}
Zorg dat je analyse ALTIJD vanuit deze specifieke invalshoek vertrekt. Dit maakt elke scan uniek en relevant.

Antwoord ALLEEN in valid JSON. Geen markdown, geen backticks, puur JSON.`
            : `You are a decision intelligence advisor analyzing current company context. Today is ${today}, current time is ${timeStr} CET. Request-ID: ${requestId}. You are an expert in the "${sector}" sector and know the European market well.

UNIQUE ANALYSIS ANGLE FOR THIS SCAN: ${analysisAngle}
Ensure your analysis ALWAYS starts from this specific angle. This makes each scan unique and relevant.

Respond ONLY in valid JSON. No markdown, no backticks, pure JSON.`;

        const userPrompt = isNl
            ? `Analyseer "${company}" (sector: ${sector}, ${employees} medewerkers, domein: ${domain}).

Geef een JSON object met:
1. "headline": Een pakkende one-liner over hun BELANGRIJKSTE actuele uitdaging of nieuwsfeit (max 15 woorden).
2. "context": Een korte paragraaf (2-3 zinnen) die uitlegt WAAROM dit relevant is voor hun besluitvorming vandaag.
3. "painPoints": Array van 3 specifieke, actuele pijnpunten (korte zinnen, max 8 woorden elk).
4. "insight_time": Wat hun besluitvormingstijd (sector: ${sector}) CONCREET betekent in euro's/dag.
5. "insight_debt": Wat hun besluitvormingsschuld CONCREET betekent.
6. "competitorThreat": De belangrijkste concurrentiedreiging NU.
7. "sources": Array van maximaal 3 bronnen, elk met { "title": "...", "url": "#", "source": "AI-analyse ${today}" }.
8. "scraped_at": "${today} ${timeStr}"

Wees SPECIFIEK en ACTUEEL voor ${company}. Geen generieke bedrijfsadviezen.
INVALSHOEK: ${analysisAngle}
Scan uitgevoerd om ${timeStr} CET, request ${requestId}.`
            : `Analyze "${company}" (sector: ${sector}, ${employees} employees, domain: ${domain}).

Return a JSON object with:
1. "headline": A punchy one-liner about their MOST IMPORTANT current challenge (max 15 words).
2. "context": A brief paragraph (2-3 sentences) explaining WHY this is relevant to their decision-making today.
3. "painPoints": Array of 3 specific, current pain points (short phrases, max 8 words each).
4. "insight_time": What their decision-making time (sector: ${sector}) CONCRETELY means in euros/day.
5. "insight_debt": What their decision debt CONCRETELY means.
6. "competitorThreat": The most important competitive threat NOW.
7. "sources": Array of up to 3 sources, each with { "title": "...", "url": "#", "source": "AI analysis ${today}" }.
8. "scraped_at": "${today} ${timeStr}"

Be SPECIFIC and CURRENT for ${company}. No generic business advice.
ANGLE: ${analysisAngle}
Scan performed at ${timeStr} CET, request ${requestId}.`;

        try {
            const rawText = await callAnthropicDirect(systemPrompt, userPrompt, 1500, 0.9);
            let jsonText = rawText.trim();
            // Strip markdown code fences if present
            if (jsonText.startsWith('```')) {
                jsonText = jsonText.replace(/^```(?:json)?\n?/, '').replace(/\n?```$/, '');
            }

            let parsed;
            try {
                parsed = JSON.parse(jsonText);
            } catch (jsonErr) {
                // Fallback: try to extract JSON object from response
                console.warn('Direct JSON parse failed, trying extraction...', jsonErr.message);
                const jsonMatch = jsonText.match(/\{[\s\S]*\}/);
                if (!jsonMatch) throw new Error('No JSON found in API response');
                parsed = JSON.parse(jsonMatch[0]);
            }

            // Validate required fields
            if (!parsed.headline || typeof parsed.headline !== 'string') {
                parsed.headline = `${company} — ${lang === 'nl' ? 'Analyse beschikbaar' : 'Analysis available'}`;
            }
            if (!parsed.context || typeof parsed.context !== 'string') {
                parsed.context = '';
            }
            if (!Array.isArray(parsed.painPoints) || parsed.painPoints.length === 0) {
                parsed.painPoints = [lang === 'nl' ? 'Analyse loopt' : 'Analysis running'];
            }

            parsed.scraped_at = `${today} ${timeStr}`;
            parsed.is_live = true;
            parsed.scan_angle = analysisAngle;
            parsed.request_id = requestId;
            return parsed;
        } catch (err) {
            console.error('Company scan failed:', err);
            return null;
        }
    }

    function getAgentSystemPrompt(agentName, company, sector, lang, userProblem, companyDataFull) {
        const datePart = new Date().toLocaleDateString(lang === 'nl' ? 'nl-NL' : 'en-US', { year: 'numeric', month: 'long', day: 'numeric' });
        const langInstr = lang === 'nl' ? 'Antwoord in het Nederlands.' : 'Answer in English.';

        // Build RICH company context from live data
        let liveBlock = '';
        const lc = companyDataFull?.liveContext;
        if (lc) {
            liveBlock = `\n\n--- LIVE GESCRAPEDE BEDRIJFSCONTEXT (${datePart}) ---
Headline: ${lc.headline || 'N/A'}
Context: ${lc.context || 'N/A'}
Concurrentiedreiging: ${lc.competitorThreat || 'N/A'}
Pijnpunten: ${(lc.painPoints || []).join(', ')}
Besluitvormingstijd-impact: ${lc.insight_time || 'N/A'}
Besluitvormingsschuld-impact: ${lc.insight_debt || 'N/A'}
Bronnen: ${(lc.sources || []).map(s => s.title + ' (' + s.source + ')').join('; ')}
--- EINDE LIVE CONTEXT ---`;
        }

        // Company metrics context
        let metricsBlock = '';
        if (companyDataFull) {
            metricsBlock = `\nBedrijfsgegevens: ${company} | Sector: ${sector} | Medewerkers: ${companyDataFull.employees || 'N/A'}
Decision Health Score: ${companyDataFull.decisionHealthScore || 'N/A'}/100
Decision Debt: €${companyDataFull.decisionDebt || 'N/A'}
Gem. besluitvormingstijd: ${companyDataFull.metrics?.avgDecisionTime || 'N/A'}
Open beslissingen: ${companyDataFull.metrics?.openDecisions || 'N/A'}
Meetings/week: ${companyDataFull.metrics?.meetingsPerWeek || 'N/A'}
Concurrenten: ${(companyDataFull.competitors || []).map(c => c.name + ' (' + c.advantage + ')').join(', ')}
Pijnpunten: ${(companyDataFull.painPoints || []).join(', ')}`;
        }

        const prompts = {
            'Framing Agent': `Je bent de Framing Agent van CheevO! Decision Engine. ${langInstr}
Je analyseert de beslissingsvraag specifiek voor ${company} (sector: ${sector}).
${metricsBlock}${liveBlock}

OPDRACHT: Herformuleer de kernvraag op basis van de ECHTE context hierboven. Gebruik de live headline en pijnpunten om de beslissingsdimensies te identificeren.
BELANGRIJK: Refereer naar SPECIFIEKE feiten uit de live context. Noem de echte concurrenten, echte cijfers, echte uitdagingen.
Geen generiek advies — dit moet aanvoelen als maatwerk voor DIT bedrijf op DIT moment.
Geef je antwoord in markdown format met ## als titel. Max 250 woorden.
Datum: ${datePart}`,

            'Data Agent': `Je bent de Data Agent van CheevO! Decision Engine. ${langInstr}
Je analyseert data specifiek voor ${company} (sector: ${sector}).
${metricsBlock}${liveBlock}

OPDRACHT: Analyseer de data in context van de ECHTE situatie hierboven.
- Gebruik de bedrijfsmetrics (Decision Health ${companyDataFull?.decisionHealthScore}/100, debt €${companyDataFull?.decisionDebt})
- Refereer aan de live gescrapede context en bronnen
- Vergelijk met sectorale benchmarks (gebruik echte data van Gartner, McKinsey, Statista)
- Geef specifieke cijfers en percentages relevant voor DIT bedrijf
BELANGRIJK: Noem de echte concurrenten uit de data. Noem de echte pijnpunten. Dit moet UNIEK zijn voor ${company}.
Geef je antwoord in markdown format met ## als titel. Max 300 woorden.
Datum: ${datePart}`,

            'Options Agent': `Je bent de Options Agent van CheevO! Decision Engine. ${langInstr}
Je genereert strategische opties specifiek voor ${company} (sector: ${sector}).
${metricsBlock}${liveBlock}

OPDRACHT: Genereer 3 concrete opties die DIRECT inspelen op de live headline en pijnpunten hierboven.
- Optie A moet direct reageren op de belangrijkste actuele uitdaging
- Optie B moet de concurrentiedreiging adresseren
- Optie C moet een innovatieve derde weg bieden
Per optie: naam, beschrijving, voor- en nadelen met ✅/⚠️.
BELANGRIJK: De opties moeten zo specifiek zijn dat ze ALLEEN voor ${company} werken, niet voor een ander bedrijf. Gebruik echte namen en feiten.
Geef je antwoord in markdown format. Max 350 woorden.
Datum: ${datePart}`,

            'Risk Agent': `Je bent de Risk Agent van CheevO! Decision Engine. ${langInstr}
Je analyseert risico's specifiek voor ${company} (sector: ${sector}).
${metricsBlock}${liveBlock}

OPDRACHT: Analyseer risico's per optie in context van de ECHTE bedrijfssituatie hierboven.
- Gebruik de live concurrentiedreiging als risicofactor
- Koppel risico's aan de echte pijnpunten en metrics (score ${companyDataFull?.decisionHealthScore}/100)
- Decision debt van €${companyDataFull?.decisionDebt} is een concreet risico — kwantificeer wat er gebeurt als dit groeit
Per optie: risico-niveau (HOOG/GEMIDDELD/LAAG) met ⚠️ waarschuwingen.
BELANGRIJK: Refereer naar de specifieke feiten. Dit mag niet generiek aanvoelen.
Geef je antwoord in markdown format. Max 300 woorden.
Datum: ${datePart}`,

            'Recommendation Agent': `Je bent de Recommendation Agent van CheevO! Decision Engine. ${langInstr}
Je geeft een definitieve aanbeveling specifiek voor ${company} (sector: ${sector}).
${metricsBlock}${liveBlock}

OPDRACHT: Geef een concrete aanbeveling die DIRECT inspeelt op:
1. De live headline en actuele context
2. De specifieke concurrentiedreiging
3. De decision health score van ${companyDataFull?.decisionHealthScore}/100 en debt van €${companyDataFull?.decisionDebt}

Structuur:
1. Aanbevolen optie met 3 redenen gebaseerd op de ECHTE data
2. Concreet implementatieplan (week-voor-week) voor ${company}
3. Verwacht resultaat met specifieke KPI's

BELANGRIJK: Dit moet aanvoelen als een persoonlijk advies van een senior consultant die het bedrijf kent, niet als een generiek template.
Geef je antwoord in markdown format met ## als titel. Max 300 woorden.
Datum: ${datePart}`
        };

        return prompts[agentName] || prompts['Framing Agent'];
    }

    /* ==================== COMPANY DATA ==================== */

    const knownCompanies = {
        'cheevo.be': {
            company: 'CheevO!',
            sector: 'Value Management & Decision Intelligence',
            employees: '1-5',
            painPoints: ['Platform-market fit validatie', 'Eerste enterprise klanten binnenhalen', 'AI-agent architectuur schalen'],
            decisionDebt: 45000,
            decisionHealthScore: 68,
            metrics: { avgDecisionTime: '3 weken', openDecisions: 5, meetingsPerWeek: 3 },
            competitors: [
                { name: 'Cloverpop', domain: 'cloverpop.com', advantage: 'Gevestigde US-markt' },
                { name: 'Decisive', domain: 'decisive.is', advantage: 'Enterprise partnerships' }
            ]
        },
        'cheevo.com': {
            company: 'CheevO!',
            sector: 'Value Management & Decision Intelligence',
            employees: '1-5',
            painPoints: ['Platform-market fit validatie', 'Eerste enterprise klanten binnenhalen', 'AI-agent architectuur schalen'],
            decisionDebt: 45000,
            decisionHealthScore: 68,
            metrics: { avgDecisionTime: '3 weken', openDecisions: 5, meetingsPerWeek: 3 },
            competitors: [
                { name: 'Cloverpop', domain: 'cloverpop.com', advantage: 'Gevestigde US-markt' },
                { name: 'Decisive', domain: 'decisive.is', advantage: 'Enterprise partnerships' }
            ]
        },
        'meemoo.be': {
            company: 'meemoo',
            sector: 'Digitaal Erfgoed & Archivering',
            employees: '50-100',
            painPoints: ['Te veel digitale archiveringsprojecten met te weinig technische resources', 'Complexe stakeholder-afstemming', 'AI-integratie keuzes'],
            decisionDebt: 187000,
            decisionHealthScore: 52,
            metrics: { avgDecisionTime: '9 weken', openDecisions: 14, meetingsPerWeek: 6 },
            competitors: [
                { name: 'Beeld en Geluid', domain: 'beeldengeluid.nl', advantage: 'Meer technisch geavanceerd' },
                { name: 'Europeana', domain: 'europeana.eu', advantage: 'Grotere schaal en EU-netwerk' }
            ]
        },
        'showpad.com': {
            company: 'Showpad',
            sector: 'Sales Enablement Technology',
            employees: '100-250',
            painPoints: ['Groeiuitdaging vs. concurrentie', 'Breed platform vs. specialisatie', 'Fragmenteerde markt'],
            decisionDebt: 542000,
            decisionHealthScore: 71,
            metrics: { avgDecisionTime: '8 weken', openDecisions: 16, meetingsPerWeek: 7 },
            competitors: [
                { name: 'Highspot', domain: 'highspot.com', advantage: 'Beter AI-geïntegreerd' },
                { name: 'Seismic', domain: 'seismic.com', advantage: 'Meer content-management' }
            ]
        },
        'delhaize.be': {
            company: 'Delhaize',
            sector: 'Retail & Voeding',
            employees: '5000+',
            painPoints: ['Supply chain optimalisatie', 'Digitale transformatie', 'Duurzaamheid'],
            decisionDebt: 2400000,
            decisionHealthScore: 64,
            metrics: { avgDecisionTime: '14 weken', openDecisions: 42, meetingsPerWeek: 12 },
            competitors: [
                { name: 'Colruyt', domain: 'colruyt.be', advantage: 'Agressievere pricing' },
                { name: 'Carrefour', domain: 'carrefour.com', advantage: 'Europese schaal' }
            ]
        },
        'uzleuven.be': {
            company: 'UZ Leuven',
            sector: 'Healthcare & Onderzoek',
            employees: '5000-10000',
            painPoints: ['Patiënt-centrische care beslissingen', 'Medische onderzoeks-prioritering', 'Operationele efficiëntie'],
            decisionDebt: 1800000,
            decisionHealthScore: 68,
            metrics: { avgDecisionTime: '12 weken', openDecisions: 35, meetingsPerWeek: 10 },
            competitors: [
                { name: 'KU Leuven Hospital', domain: 'kuleuven.be', advantage: 'Academische excellentie' },
                { name: 'Antwerp University Hospital', domain: 'uza.be', advantage: 'Innovatieve praktijken' }
            ]
        },
        'projectrunner.be': {
            company: 'Projectrunner',
            sector: 'Project Management & Consultancy',
            employees: '5-20',
            painPoints: ['Klant project-prioritering', 'Resource allocatie', 'Risico management'],
            decisionDebt: 250000,
            decisionHealthScore: 75,
            metrics: { avgDecisionTime: '5 weken', openDecisions: 8, meetingsPerWeek: 4 },
            competitors: [
                { name: 'Topix Consulting', domain: 'topix.be', advantage: 'Grotere schaal' },
                { name: 'Agile Experts', domain: 'agileexperts.be', advantage: 'Specialistische methodologie' }
            ]
        },
        'apple.com': {
            company: 'Apple',
            sector: 'Consumer Electronics & Technology',
            employees: '150000+',
            painPoints: ['Productstrategie innovatie', 'Marktexpansie prioritering', 'Ecosysteem integratie'],
            decisionDebt: 45000000,
            decisionHealthScore: 82,
            metrics: { avgDecisionTime: '6 weken', openDecisions: 180, meetingsPerWeek: 25 },
            competitors: [
                { name: 'Samsung Electronics', domain: 'samsung.com', advantage: 'Brede productlijn' },
                { name: 'Microsoft', domain: 'microsoft.com', advantage: 'Enterprise integratie' }
            ]
        },
        'google.com': {
            company: 'Google',
            sector: 'Internet & Cloud Technology',
            employees: '150000+',
            painPoints: ['Cloud service strategie', 'AI-innovatie prioritering', 'Privacy vs monetisatie'],
            decisionDebt: 50000000,
            decisionHealthScore: 79,
            metrics: { avgDecisionTime: '7 weken', openDecisions: 200, meetingsPerWeek: 30 },
            competitors: [
                { name: 'Amazon AWS', domain: 'amazon.com', advantage: 'Cloud marktleider' },
                { name: 'Microsoft Azure', domain: 'microsoft.com', advantage: 'Enterprise voorkeur' }
            ]
        }
    };

    // Brand colors removed — app uses generic teal theme for all companies
    // Logo is always shown via Clearbit/Google Favicons fallback chain

    const hashDomain = (domain) => {
        if (!domain || domain.length === 0) return 42; // safe fallback
        let hash = 0;
        for (let i = 0; i < domain.length; i++) {
            const char = domain.charCodeAt(i);
            hash = ((hash << 5) - hash) + char;
            hash = hash & hash; // Convert to 32-bit integer
        }
        return Math.abs(hash);
    };

    const generateMockCompanyData = (domain) => {
        if (knownCompanies[domain]) return knownCompanies[domain];

        const seed = hashDomain(domain);
        const companyName = domain.split('.')[0].charAt(0).toUpperCase() + domain.split('.')[0].slice(1);

        // Use seed-based pseudo-random generation for deterministic results
        const decisionDebt = ((seed * 73856093) % 400000) + 100000;
        const healthScore = ((seed * 19349663) % 60) + 35;
        const employeeIndex = (seed * 83492791) % 3;
        const avgTimeIndex = (seed * 45678901) % 15;
        const openDecisionsBase = (seed * 12345679) % 20;
        const meetingsBase = (seed * 98765432) % 8;

        return {
            company: companyName,
            sector: 'Technologie',
            employees: ['50-100', '100-500', '500-1000'][employeeIndex],
            painPoints: ['Te veel besluitvormingsprocessen', 'Gebrek aan data-inzichten', 'Inconsistente communicatie'],
            decisionDebt: decisionDebt,
            decisionHealthScore: healthScore,
            metrics: {
                avgDecisionTime: (avgTimeIndex + 3) + ' weken',
                openDecisions: openDecisionsBase + 5,
                meetingsPerWeek: meetingsBase + 3
            },
            competitors: [
                { name: 'TechCorp Global', domain: 'techcorp.com', advantage: 'Betere cloud-infrastructuur' },
                { name: 'InnovateLabs', domain: 'innovatelabs.io', advantage: 'Snellere product-cycle' }
            ]
        };
    };

    /* ==================== ERROR BOUNDARY ==================== */

    class ErrorBoundary extends React.Component {
        constructor(props) {
            super(props);
            this.state = { hasError: false, error: null };
        }

        static getDerivedStateFromError(error) {
            return { hasError: true, error };
        }

        componentDidCatch(error, errorInfo) {
            console.error('Error caught by boundary:', error, errorInfo);
        }

        handleReset = () => {
            this.setState({ hasError: false, error: null });
            window.location.reload();
        };

        render() {
            if (this.state.hasError) {
                return (
                    <div style={{
                        display: 'flex',
                        flexDirection: 'column',
                        alignItems: 'center',
                        justifyContent: 'center',
                        minHeight: '100vh',
                        background: 'linear-gradient(135deg, #0A0A0F 0%, #12121A 100%)',
                        color: 'rgba(255, 255, 255, 0.87)',
                        padding: '20px',
                        textAlign: 'center'
                    }}>
                        <h1 style={{ fontSize: 32, marginBottom: 16 }}>Oops! Er ging iets mis</h1>
                        <p style={{ fontSize: 14, color: 'rgba(255, 255, 255, 0.6)', marginBottom: 12 }}>
                            We ondervonden een onverwachte fout. Probeer het opnieuw.
                        </p>
                        {this.state.error && (
                            <details style={{ marginBottom: 20, textAlign: 'left', maxWidth: 500, margin: '0 auto 20px' }}>
                                <summary style={{ cursor: 'pointer', fontSize: 12, color: 'rgba(255,255,255,0.4)' }}>Technische details</summary>
                                <pre style={{ fontSize: 11, color: 'rgba(255,255,255,0.3)', marginTop: 8, overflow: 'auto', maxHeight: 100, padding: 8, background: 'rgba(255,255,255,0.03)', borderRadius: 8 }}>
                                    {this.state.error.toString()}
                                </pre>
                            </details>
                        )}
                        <button
                            onClick={this.handleReset}
                            style={{
                                padding: '12px 24px',
                                fontSize: 14,
                                fontWeight: 600,
                                background: 'linear-gradient(135deg, #06D6A0 0%, #00F5D4 100%)',
                                color: '#0A0A0F',
                                border: 'none',
                                borderRadius: '8px',
                                cursor: 'pointer'
                            }}
                        >
                            Opnieuw proberen
                        </button>
                    </div>
                );
            }

            return this.props.children;
        }
    }

    /* ==================== COMPONENTS ==================== */

    const AnimatedCounter = ({ target, duration = 2000 }) => {
        const [count, setCount] = useState(0);
        const countRef = useRef(0);
        const mountedRef = useRef(true);

        useEffect(() => {
            const increment = target / (duration / 16);
            const interval = setInterval(() => {
                countRef.current += increment;
                if (mountedRef.current) {
                    if (countRef.current >= target) {
                        setCount(target);
                        clearInterval(interval);
                    } else {
                        setCount(Math.floor(countRef.current));
                    }
                }
            }, 16);

            return () => {
                mountedRef.current = false;
                clearInterval(interval);
            };
        }, [target, duration]);

        return <span>{count.toLocaleString('nl-NL')}</span>;
    };

    const DecisionHealthGauge = ({ score, size = 'large', lang = 'nl' }) => {
        const [animatedScore, setAnimatedScore] = useState(0);
        const [pulse, setPulse] = useState(false);
        const mountedRef = useRef(true);
        const dim = size === 'large' ? 220 : size === 'compact' ? 80 : 160;

        useEffect(() => {
            let current = 0;
            const interval = setInterval(() => {
                if (current < score && mountedRef.current) {
                    current += score / 40;
                    setAnimatedScore(Math.min(current, score));
                } else if (current >= score) {
                    clearInterval(interval);
                    setPulse(true);
                }
            }, 30);
            return () => { mountedRef.current = false; clearInterval(interval); };
        }, [score]);

        const getColor = (s) => s < 40 ? '#EF4444' : s < 70 ? '#F59E0B' : '#10B981';
        const getLabel = (s) => {
            if (lang === 'nl') return s < 40 ? 'Kritiek' : s < 70 ? 'Aandacht nodig' : 'Gezond';
            return s < 40 ? 'Critical' : s < 70 ? 'Needs attention' : 'Healthy';
        };
        const color = getColor(animatedScore);
        const pct = animatedScore / 100;

        // 4 satellite nodes positioned around center
        const satellites = [
            { angle: -60, label: lang === 'nl' ? 'Snelheid' : 'Speed' },
            { angle: 0, label: 'Data' },
            { angle: 60, label: lang === 'nl' ? 'Afstemming' : 'Alignment' },
            { angle: 120, label: lang === 'nl' ? 'Uitvoering' : 'Execution' }
        ];

        const isCompact = size === 'compact';
        const cx = dim / 2, cy = dim / 2;
        const orbR = isCompact ? 28 : 32;
        const satDist = dim * 0.38, satR = isCompact ? 3 : 6;
        const uniqueId = React.useMemo(() => Math.random().toString(36).substr(2, 6), []);

        return (
            <div style={{ position: 'relative', width: dim, height: isCompact ? dim : dim + 20, margin: '0 auto' }}>
                <svg viewBox={`0 0 ${dim} ${dim}`} width={dim} height={dim} style={{ overflow: 'visible' }}>
                    <defs>
                        <radialGradient id={`orbGlow-${uniqueId}`} cx="50%" cy="50%" r="50%">
                            <stop offset="0%" stopColor={color} stopOpacity="0.3" />
                            <stop offset="100%" stopColor={color} stopOpacity="0" />
                        </radialGradient>
                        <filter id={`glow-${uniqueId}`}><feGaussianBlur stdDeviation="4" result="blur" /><feMerge><feMergeNode in="blur" /><feMergeNode in="SourceGraphic" /></feMerge></filter>
                    </defs>

                    {/* Glow pulse behind center orb */}
                    <circle cx={cx} cy={cy} r={orbR + (isCompact ? 8 : 20)} fill={`url(#orbGlow-${uniqueId})`} style={{
                        animation: pulse ? 'agentPulse 3s ease-in-out infinite' : 'none',
                        opacity: pct
                    }} />

                    {/* Connection lines from center to satellites */}
                    {!isCompact && satellites.map((sat, i) => {
                        const rad = (sat.angle * Math.PI) / 180;
                        const sx = cx + Math.cos(rad) * satDist;
                        const sy = cy + Math.sin(rad) * satDist;
                        return (
                            <g key={i}>
                                <line x1={cx} y1={cy} x2={sx} y2={sy}
                                    stroke={color} strokeWidth="1.5" strokeOpacity={0.15 + pct * 0.3}
                                    strokeDasharray="4 4"
                                />
                                {/* Traveling pulse dot on line */}
                                <circle r="2.5" fill={color} opacity={pulse ? 0.8 : 0}>
                                    <animateMotion dur={`${2 + i * 0.3}s`} repeatCount="indefinite"
                                        path={`M${cx},${cy} L${sx},${sy}`} />
                                </circle>
                                {/* Satellite node */}
                                <circle cx={sx} cy={sy} r={satR} fill={`${color}22`} stroke={color}
                                    strokeWidth="1.5" strokeOpacity={0.4 + pct * 0.4}
                                    style={{ transition: 'all 1s ease' }} />
                                <text x={sx} y={sy + satR + 14} textAnchor="middle"
                                    fill="rgba(255,255,255,0.5)" fontSize="10" fontFamily="Inter">
                                    {sat.label}
                                </text>
                            </g>
                        );
                    })}

                    {/* Center orb */}
                    <circle cx={cx} cy={cy} r={orbR} fill={`${color}11`}
                        stroke={color} strokeWidth="2" strokeOpacity={0.6}
                        filter={`url(#glow-${uniqueId})`}
                        style={{ transition: 'all 1s ease' }} />
                    <circle cx={cx} cy={cy} r={orbR - (isCompact ? 4 : 6)} fill={`${color}08`}
                        stroke={color} strokeWidth="1" strokeOpacity={0.3}
                        strokeDasharray={`${pct * 200} 200`}
                        style={{ transition: 'stroke-dasharray 1.5s ease' }} />

                    {/* Score number */}
                    <text x={cx} y={cy - (isCompact ? 0 : 2)} textAnchor="middle" dominantBaseline="central"
                        fill={color} fontSize={isCompact ? 18 : 28} fontWeight="700" fontFamily="Space Grotesk">
                        {Math.round(animatedScore)}
                    </text>
                    {!isCompact && (
                        <text x={cx} y={cy + 18} textAnchor="middle" dominantBaseline="central"
                            fill="rgba(255,255,255,0.4)" fontSize="8" fontWeight="600" letterSpacing="1.5">
                            /100
                        </text>
                    )}
                </svg>
                {/* Status label below */}
                {!isCompact && (
                    <div style={{
                        textAlign: 'center', marginTop: 4, fontSize: 12, fontWeight: 600,
                        color: color, letterSpacing: 1, textTransform: 'uppercase',
                        opacity: pulse ? 1 : 0, transition: 'opacity 0.5s ease'
                    }}>
                        {getLabel(animatedScore)}
                    </div>
                )}
            </div>
        );
    };

    const HealthBreakdown = ({ score, lang, companyName = '' }) => {
        const breakdown = generateHealthBreakdown(score, companyName);
        const labels = lang === 'nl' ? {
            speed: 'Besluitsn.',
            maturity: 'Data V.',
            alignment: 'Afstemming',
            execution: 'Uitvoering'
        } : {
            speed: 'Decision Speed',
            maturity: 'Data Mat.',
            alignment: 'Alignment',
            execution: 'Execution'
        };

        return (
            <div className="health-breakdown">
                <div className="breakdown-title">{lang === 'nl' ? 'Gezondheid Uitsplitsing' : 'Health Breakdown'}</div>
                {[
                    { label: labels.speed, value: breakdown.decisionSpeed, max: 25 },
                    { label: labels.maturity, value: breakdown.dataMaturity, max: 25 },
                    { label: labels.alignment, value: breakdown.alignment, max: 25 },
                    { label: labels.execution, value: breakdown.execution, max: 25 }
                ].map((item, idx) => (
                    <div key={idx} className="breakdown-item">
                        <div className="breakdown-label">{item.label}</div>
                        <div className="breakdown-bar-container">
                            <div className="breakdown-bar-fill" style={{ width: `${(item.value / item.max) * 100}%` }}></div>
                        </div>
                        <div className="breakdown-score">{item.value}/{item.max}</div>
                    </div>
                ))}
            </div>
        );
    };

    const MonteCarloBars = ({ options, visible, lang }) => {
        return (
            <div>
                <div style={{ fontSize: 12, color: 'rgba(255,255,255,0.6)', marginBottom: 16, fontStyle: 'italic' }}>
                    {lang === 'nl'
                        ? 'Gebaseerd op sector-benchmarks en organisatieprofiel. Betrouwbaarheidsinterval: 95% CI.'
                        : 'Based on sector benchmarks and organizational profile. Confidence interval: 95% CI.'}
                </div>
                {options.map((option, idx) => {
                    const probability = option.probability || 0;
                    const ciLow = Math.max(0, probability - 13);
                    const ciHigh = Math.min(100, probability + 13);

                    const getBarClass = (p) => {
                        if (p >= 70) return 'bar-green';
                        if (p >= 50) return 'bar-amber';
                        return 'bar-red';
                    };

                    return (
                        <div key={idx} className="monte-carlo-bar">
                            <div className="monte-carlo-label">{option.name}</div>
                            <div className="monte-carlo-container">
                                <div className="monte-carlo-background" style={{ width: `${ciHigh}%` }}></div>
                                {visible && (
                                    <div
                                        className={`monte-carlo-fill ${getBarClass(probability)}`}
                                        style={{
                                            width: `${probability}%`
                                        }}
                                    >
                                        {probability > 15 && `${probability}%`}
                                    </div>
                                )}
                            </div>
                            <div className="monte-carlo-percentage">{probability}%</div>
                            <div className="monte-carlo-ci">95% CI: {ciLow}-{ciHigh}%</div>
                        </div>
                    );
                })}
            </div>
        );
    };

    const AgentOutputModal = ({ agent, companyData, onClose, lang }) => {
        const [copied, setCopied] = React.useState(false);

        React.useEffect(() => {
            const handleEscape = (e) => {
                if (e.key === 'Escape') {
                    onClose();
                }
            };
            document.addEventListener('keydown', handleEscape);
            return () => document.removeEventListener('keydown', handleEscape);
        }, [onClose]);

        const handleCopy = () => {
            const text = agent.result.text || generateDemoResponses(agent.name, companyData, lang);
            navigator.clipboard.writeText(text);
            setCopied(true);
            setTimeout(() => setCopied(false), 2000);
        };

        const displayText = agent.result?.text || generateDemoResponses(agent.name, companyData, lang);

        return (
            <div className="modal-overlay" onClick={onClose} role="dialog" aria-modal="true" aria-labelledby="agent-modal-title">
                <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                    <button className="modal-close" onClick={onClose} aria-label="Close modal">✕</button>

                    <div className="modal-header">
                        <div className={`agent-icon ${agent.type} done`} style={{ width: 40, height: 40 }}>
                            <AgentSvgIcon type={agent.type} />
                        </div>
                        <div>
                            <h2 className="modal-title" id="agent-modal-title">{agent.name}</h2>
                        </div>
                        <div className="modal-metadata">
                            <div className="modal-badge live">{lang === 'nl' ? 'AI ANALYSE' : 'AI ANALYSIS'}</div>
                            {agent.result?.elapsed && (
                                <div className="modal-badge">{agent.result.elapsed}s</div>
                            )}
                        </div>
                    </div>

                    <div className="modal-body" dangerouslySetInnerHTML={{ __html: markdownToSafeHtml(displayText) }} />

                    <div style={{ marginTop: 24, display: 'flex', gap: 12 }}>
                        <button
                            onClick={handleCopy}
                            className="btn-primary"
                            style={{ flex: 1 }}
                        >
                            {copied ? (lang === 'nl' ? 'Gekopieerd!' : 'Copied!') : (lang === 'nl' ? 'Kopieren' : 'Copy')}
                        </button>
                        <button onClick={onClose} className="btn-primary" style={{ flex: 1, opacity: 0.6 }}>
                            {lang === 'nl' ? 'Sluiten' : 'Close'}
                        </button>
                    </div>
                </div>
            </div>
        );
    };

    const ProgressStepper = ({ currentStep, completedSteps, onStepClick, lang }) => {
        const labels = lang === 'nl'
            ? ['Scan', 'AI Analyse', 'Command']
            : ['Scan', 'AI Analysis', 'Command'];

        const steps = [
            { id: 'scan', label: labels[0], num: 1 },
            { id: 'engine', label: labels[1], num: 2 },
            { id: 'command', label: labels[2], num: 3 }
        ];

        return (
            <div className="progress-stepper" role="navigation" aria-label={lang === 'nl' ? 'Voortgangsstappen' : 'Progress steps'}>
                {steps.map((step, idx) => (
                    <div
                        key={step.id}
                        className={`stepper-step ${currentStep === step.id ? 'active' : ''} ${completedSteps.includes(step.id) ? 'completed' : ''}`}
                        onClick={() => completedSteps.includes(step.id) && onStepClick(step.id)}
                        style={{ cursor: completedSteps.includes(step.id) ? 'pointer' : 'default' }}
                        role="button"
                        aria-label={`${step.label} — ${currentStep === step.id ? (lang === 'nl' ? 'huidige stap' : 'current step') : completedSteps.includes(step.id) ? (lang === 'nl' ? 'voltooid' : 'completed') : (lang === 'nl' ? 'nog niet bereikt' : 'not reached')}`}
                        aria-current={currentStep === step.id ? 'step' : undefined}
                        tabIndex={completedSteps.includes(step.id) ? 0 : -1}
                        onKeyDown={(e) => {
                            if (e.key === 'Enter' && completedSteps.includes(step.id)) {
                                onStepClick(step.id);
                            }
                        }}
                    >
                        <div className="stepper-circle">
                            {completedSteps.includes(step.id) ? '✓' : step.num}
                        </div>
                        <div className="stepper-label">{step.label}</div>
                    </div>
                ))}
            </div>
        );
    };

    const ConsensusView = ({ agentResults, lang }) => {
        const dynamicConsensus = generateDynamicConsensus(agentResults, lang);
        const consensusItems = dynamicConsensus || [
            { type: 'agree', text: lang === 'nl' ? 'Agenten zijn aligned op strategische richting' : 'Agents are aligned on strategic direction' }
        ];

        return (
            <div className="consensus-section">
                <div className="consensus-title">{lang === 'nl' ? 'Agent Consensus' : 'Agent Consensus'}</div>
                {consensusItems.map((item, idx) => (
                    <div key={idx} className={`consensus-item ${item.type === 'agree' ? 'consensus-agree' : 'consensus-disagree'}`}>
                        <span style={{ fontSize: '16px', marginRight: '4px' }}>
                            {item.type === 'agree' ? '✓' : '⚠️'}
                        </span>
                        {item.text}
                    </div>
                ))}
            </div>
        );
    };

    /* ==================== SPLASH SCREEN COMPONENT ==================== */
    const SplashScreen = ({ onSplashComplete, lang }) => {
        const completedRef = React.useRef(false);
        const handleComplete = React.useCallback(() => {
            if (!completedRef.current) {
                completedRef.current = true;
                onSplashComplete();
            }
        }, [onSplashComplete]);

        React.useEffect(() => {
            const timer = setTimeout(handleComplete, 1500);
            return () => clearTimeout(timer);
        }, [handleComplete]);

        return (
            <div className="splash-container" onClick={handleComplete} style={{ cursor: 'pointer' }}>
                <div className="splash-content">
                    <img
                        src="https://cdn.prod.website-files.com/698711ea47ebc9e0964e73b3/6987363d86df2b3487212d26_Cheevo%20Logo%20Black.svg"
                        alt="CheevO!"
                        className="splash-logo"
                    />
                    <p className="splash-tagline">{lang === 'nl' ? 'Beslissingsintelligentie Platform' : 'Decision Intelligence Platform'}</p>
                    <p style={{ fontSize: 12, color: 'rgba(255,255,255,0.4)', marginTop: 20, animation: 'fadeIn 0.5s ease 0.5s forwards', opacity: 0 }}>
                        {lang === 'nl' ? 'Klik om verder te gaan' : 'Click to continue'}
                    </p>
                </div>
            </div>
        );
    };

    /* ==================== WELCOME SCREEN ==================== */
    const WelcomeScreen = ({ onComplete, lang }) => {
        const [phase, setPhase] = useState(0); // 0=agents appear, 1=chat bubbles, 2=main text, 3=CTA
        const [activeChat, setActiveChat] = useState(-1);
        const completedRef = React.useRef(false);

        const agents = [
            { type: 'framing', color: '#A78BFA', glow: 'rgba(167,139,250,0.4)', name: 'Nova', tagline: 'De Visionair', chatNl: 'Even kijken wat hier écht speelt...', chatEn: 'Let me see what\'s really going on...' },
            { type: 'data', color: '#60A5FA', glow: 'rgba(96,165,250,0.4)', name: 'Byte', tagline: 'De Analyst', chatNl: 'Data liegt nooit — ik crunch!', chatEn: 'Data never lies — crunching!' },
            { type: 'options', color: '#06D6A0', glow: 'rgba(6,214,160,0.4)', name: 'Spark', tagline: 'De Strateeg', chatNl: 'Ik zie al drie opties!', chatEn: 'I already see three options!' },
            { type: 'risk', color: '#FBBF24', glow: 'rgba(251,191,36,0.4)', name: 'Shield', tagline: 'De Bewaker', chatNl: 'Ik check de valkuilen.', chatEn: 'Checking for pitfalls.' },
            { type: 'recommendation', color: '#FB7185', glow: 'rgba(251,113,133,0.4)', name: 'Sage', tagline: 'De Adviseur', chatNl: 'Klaar om te adviseren!', chatEn: 'Ready to advise!' }
        ];

        const particles = React.useMemo(() =>
            Array.from({ length: 30 }, (_, i) => ({
                left: Math.random() * 100 + '%',
                top: Math.random() * 100 + '%',
                delay: Math.random() * 5 + 's',
                size: 2 + Math.random() * 4,
                opacity: 0.2 + Math.random() * 0.4
            })), []
        );

        // Track which agents are visible (reveal 1-by-1)
        const [visibleAgents, setVisibleAgents] = useState(0);

        // Animation phases — agents appear 1-by-1, then text, then CTA
        useEffect(() => {
            const timers = [
                setTimeout(() => setVisibleAgents(1), 200),
                setTimeout(() => setVisibleAgents(2), 500),
                setTimeout(() => setVisibleAgents(3), 800),
                setTimeout(() => setVisibleAgents(4), 1100),
                setTimeout(() => setVisibleAgents(5), 1400),
                setTimeout(() => { setPhase(1); setActiveChat(0); }, 1700),
                setTimeout(() => setActiveChat(1), 2100),
                setTimeout(() => setActiveChat(2), 2500),
                setTimeout(() => setActiveChat(3), 2900),
                setTimeout(() => setActiveChat(4), 3300),
                setTimeout(() => setPhase(2), 3500),   // Show main text
                setTimeout(() => setPhase(3), 3900),   // Show CTA
            ];
            return () => timers.forEach(clearTimeout);
        }, []);

        const handleComplete = useCallback(() => {
            if (!completedRef.current) {
                completedRef.current = true;
                onComplete();
            }
        }, [onComplete]);

        return (
            <div className="welcome-container" style={{ animation: phase >= 3 ? 'none' : 'none' }}>
                {/* Particles */}
                <div className="welcome-particles">
                    {particles.map((p, i) => (
                        <div key={i} className="welcome-particle" style={{
                            left: p.left, top: p.top, width: p.size, height: p.size,
                            animationDelay: p.delay, opacity: p.opacity
                        }} />
                    ))}
                </div>

                {/* Agent orbs row — appear 1 by 1 */}
                <div style={{
                    display: 'flex', gap: 24, marginBottom: 40, alignItems: 'flex-end', minHeight: 140
                }}>
                    {agents.map((agent, i) => (
                        <div key={i} style={{
                            opacity: visibleAgents > i ? 1 : 0,
                            transform: visibleAgents > i ? 'translateY(0) scale(1)' : 'translateY(30px) scale(0.5)',
                            transition: `all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275)`,
                            position: 'relative'
                        }}>
                            {/* Chat bubble - show only the currently active agent's bubble */}
                            {phase >= 1 && activeChat === i && (
                                <div className="agent-chat-bubble" style={{ animationDelay: '0s' }}>
                                    {lang === 'nl' ? agent.chatNl : agent.chatEn}
                                </div>
                            )}
                            <div className="agent-orb" style={{
                                background: `linear-gradient(135deg, ${agent.color}33 0%, ${agent.color}11 100%)`,
                                border: `2px solid ${agent.color}55`,
                                '--agent-glow': agent.glow,
                                animationDelay: `${i * 0.4}s, ${i * 0.6}s`,
                                padding: 0, overflow: 'hidden'
                            }}>
                                <AgentAvatar type={agent.type} size={68} color={agent.color} />
                            </div>
                            <div style={{ textAlign: 'center', marginTop: 8 }}>
                                <div style={{ fontSize: 13, color: agent.color, fontWeight: 700, letterSpacing: 0.5 }}>
                                    {agent.name}
                                </div>
                                <div style={{ fontSize: 10, color: 'rgba(255,255,255,0.55)', marginTop: 2, fontStyle: 'italic' }}>
                                    {agent.tagline}
                                </div>
                            </div>
                        </div>
                    ))}
                </div>

                {/* Welcome text */}
                <div style={{
                    opacity: phase >= 2 ? 1 : 0, transform: phase >= 2 ? 'translateY(0)' : 'translateY(20px)',
                    transition: 'all 0.8s ease', textAlign: 'center', maxWidth: 600, padding: '0 20px'
                }}>
                    <h2 style={{
                        fontSize: 28, fontWeight: 700, marginBottom: 12,
                        fontFamily: "'Space Grotesk', sans-serif"
                    }}>
                        <span style={{ display: 'inline-block', animation: phase >= 2 ? 'welcomeWave 1.5s ease 0.3s' : 'none', transformOrigin: '70% 70%' }}>👋</span>
                        {' '}
                        {lang === 'nl' ? 'Welkom bij CheevO!' : 'Welcome to CheevO!'}
                    </h2>
                    <p style={{ fontSize: 16, color: 'rgba(255,255,255,0.6)', lineHeight: 1.6 }}>
                        {lang === 'nl'
                            ? 'Onze 5 AI-agents staan klaar om uw organisatie te analyseren en u te helpen betere beslissingen te nemen. Elke agent heeft een unieke expertise.'
                            : 'Our 5 AI agents are ready to analyze your organization and help you make better decisions. Each agent brings unique expertise.'
                        }
                    </p>
                </div>

                {/* CTA Button */}
                <div style={{
                    opacity: phase >= 3 ? 1 : 0, transform: phase >= 3 ? 'translateY(0)' : 'translateY(20px)',
                    transition: 'all 0.8s ease', marginTop: 32
                }}>
                    <button onClick={handleComplete} className="btn-primary" style={{
                        padding: '14px 48px', fontSize: 16, position: 'relative', overflow: 'hidden'
                    }}>
                        {lang === 'nl' ? 'Laten we beginnen! 🚀' : 'Let\'s get started! 🚀'}
                    </button>
                    <p style={{ fontSize: 12, color: 'rgba(255,255,255,0.3)', marginTop: 12, textAlign: 'center' }}>
                        {lang === 'nl' ? 'Duurt maar 2 minuten' : 'Takes only 2 minutes'}
                    </p>
                </div>
            </div>
        );
    };

    const LandingScreen = ({ onProceed, t, lang }) => {
        const [email, setEmail] = useState('');
        const [error, setError] = useState('');
        const [emailInvalid, setEmailInvalid] = useState(false);
        const [isSubmitting, setIsSubmitting] = useState(false);

        const handleProceed = () => {
            if (isSubmitting) return;
            const cleanEmail = sanitizeInput(email).toLowerCase();
            if (!validateEmail(cleanEmail)) {
                setError(t(lang).invalidEmail);
                setEmailInvalid(true);
                return;
            }
            setIsSubmitting(true);
            setEmailInvalid(false);
            onProceed(cleanEmail);
        };

        const handleDemoClick = () => {
            if (isSubmitting) return;
            setIsSubmitting(true);
            onProceed('info@showpad.com');
        };

        const steps = lang === 'nl' ? [
            { type: 'framing', color: '#A78BFA', title: 'Scan', desc: 'We analyseren uw organisatieprofiel' },
            { type: 'data', color: '#60A5FA', title: 'AI Analyse', desc: '5 agents onderzoeken uw besluitvorming' },
            { type: 'recommendation', color: '#F472B6', title: 'Actieplan', desc: 'Concrete aanbevelingen op maat' }
        ] : [
            { type: 'framing', color: '#A78BFA', title: 'Scan', desc: 'We analyze your organization profile' },
            { type: 'data', color: '#60A5FA', title: 'AI Analysis', desc: '5 agents examine your decision-making' },
            { type: 'recommendation', color: '#F472B6', title: 'Action Plan', desc: 'Concrete tailored recommendations' }
        ];

        return (
            <div className="screen-container screen-enter" style={{
                display: 'flex', alignItems: 'center', justifyContent: 'center',
                minHeight: 'calc(100vh - 60px)', padding: '40px 20px', textAlign: 'center'
            }}>
                <div style={{ maxWidth: 620 }}>
                    <img
                        src="https://cdn.prod.website-files.com/698711ea47ebc9e0964e73b3/6987363d86df2b3487212d26_Cheevo%20Logo%20Black.svg"
                        alt="CheevO Logo"
                        className="logo-img-large"
                    />
                    <h1 className="hero-title gradient-text" style={{ marginBottom: 12, fontSize: 'clamp(24px, 4vw, 36px)' }}>
                        {t(lang).landingTitle}
                    </h1>
                    <p className="text-body" style={{ marginBottom: 28, lineHeight: 1.6 }}>
                        {t(lang).landingSubtitle}
                    </p>

                    {/* 3-step preview */}
                    <div style={{
                        display: 'flex', gap: 16, justifyContent: 'center', marginBottom: 32,
                        flexWrap: 'wrap'
                    }}>
                        {steps.map((step, i) => (
                            <div key={i} style={{
                                display: 'flex', alignItems: 'center', gap: 8,
                                background: 'rgba(255,255,255,0.04)', borderRadius: 12,
                                padding: '10px 16px', border: '1px solid rgba(255,255,255,0.06)',
                                flex: '1 1 150px', maxWidth: 200
                            }}>
                                <div style={{ width: 32, height: 32, borderRadius: 8, display: 'flex', alignItems: 'center', justifyContent: 'center', background: `${step.color}15`, flexShrink: 0 }}>
                                    <AgentSvgIcon type={step.type} size={18} color={step.color} />
                                </div>
                                <div style={{ textAlign: 'left' }}>
                                    <div style={{ fontSize: 12, fontWeight: 700, color: step.color }}>{step.title}</div>
                                    <div style={{ fontSize: 11, color: 'rgba(255,255,255,0.5)', lineHeight: 1.3 }}>{step.desc}</div>
                                </div>
                            </div>
                        ))}
                    </div>

                    <div style={{ display: 'flex', gap: 12, flexDirection: 'column', marginBottom: 24 }}>
                        <label style={{ fontSize: 14, fontWeight: 600, marginBottom: -8 }}>
                            {lang === 'nl' ? 'Zakelijk e-mailadres' : 'Business email address'}
                        </label>
                        <input
                            type="email"
                            placeholder={t(lang).enterEmail}
                            value={email}
                            onChange={(e) => {
                                setEmail(e.target.value);
                                setError('');
                                setEmailInvalid(false);
                            }}
                            onKeyPress={(e) => e.key === 'Enter' && handleProceed()}
                            className="input-field"
                            aria-invalid={emailInvalid}
                            aria-label={lang === 'nl' ? 'Email adres invoeren' : 'Enter your email address'}
                            style={{ fontSize: 14 }}
                        />
                        {error && <div style={{ color: '#EF4444', fontSize: 12 }}>{error}</div>}
                        <button onClick={handleProceed} className={`btn-primary ${isSubmitting ? 'loading' : ''}`} disabled={isSubmitting} style={{ width: '100%' }}>
                            {isSubmitting ? (lang === 'nl' ? 'Agents worden geactiveerd...' : 'Activating agents...') : t(lang).analyzeBtn}
                        </button>
                        <button
                            onClick={handleDemoClick}
                            className={`btn-primary ${isSubmitting ? 'loading' : ''}`}
                            disabled={isSubmitting}
                            style={{
                                width: '100%',
                                background: 'rgba(255, 255, 255, 0.05)',
                                color: 'rgba(255,255,255,0.5)',
                                border: '1px solid rgba(255, 255, 255, 0.08)'
                            }}
                        >
                            {t(lang).tryDemoBtn}
                        </button>
                    </div>

                    {/* Trust indicators */}
                    <div style={{ display: 'flex', justifyContent: 'center', gap: 20, marginTop: 16, flexWrap: 'wrap' }}>
                        {[
                            { icon: '🔒', text: lang === 'nl' ? 'GDPR-compliant' : 'GDPR-compliant' },
                            { icon: '⚡', text: lang === 'nl' ? 'Real-time AI' : 'Real-time AI' },
                            { icon: '🎯', text: lang === 'nl' ? 'Gepersonaliseerd' : 'Personalized' }
                        ].map((trust, i) => (
                            <div key={i} style={{ display: 'flex', alignItems: 'center', gap: 4, fontSize: 11, color: 'rgba(255,255,255,0.4)' }}>
                                <span>{trust.icon}</span>
                                <span>{trust.text}</span>
                            </div>
                        ))}
                    </div>
                    <p style={{ fontSize: 11, color: 'rgba(255,255,255,0.25)', marginTop: 8 }}>
                        {lang === 'nl'
                            ? 'Uw gegevens worden niet opgeslagen. Analyse is real-time en anoniem.'
                            : 'Your data is not stored. Analysis is real-time and anonymous.'}
                    </p>
                </div>
            </div>
        );
    };

    // Generate personalized insights based on company metrics
    const generateInsights = (companyData, lang) => {
        const avgTime = parseInt(companyData.metrics.avgDecisionTime);
        const openDec = companyData.metrics.openDecisions;
        const meetings = companyData.metrics.meetingsPerWeek;
        const debt = companyData.decisionDebt;
        const score = companyData.decisionHealthScore;
        const employees = companyData.employees;

        // Calculate derived impact metrics
        const weeklyDebtGrowth = Math.round(debt * 0.02);
        const decisionsPerPerson = employees.includes('5000') ? (openDec / 50).toFixed(1)
            : employees.includes('1000') ? (openDec / 7.5).toFixed(1)
            : employees.includes('500') ? (openDec / 5).toFixed(1)
            : employees.includes('100') ? (openDec / 3).toFixed(1)
            : (openDec / 1.5).toFixed(1);
        const meetingHoursMonth = meetings * 4 * 1.5;
        const slowdownVsBenchmark = avgTime - 8;

        if (lang === 'nl') {
            return {
                narrative: score < 50
                    ? `${companyData.company} verliest momenteel grip op strategische besluitvorming. Uw score van ${score}/100 wijst op structurele vertragingen die direct invloed hebben op uw concurrentiepositie en operationele kosten.`
                    : score < 70
                    ? `${companyData.company} presteert onder het sectorgemiddelde (65) qua besluitvorming. Er zijn concrete verbeterkansen die uw organisatie direct resultaat kunnen opleveren.`
                    : `${companyData.company} scoort bovengemiddeld op besluitvorming. Er zijn nog gerichte optimalisaties mogelijk om uw voorsprong uit te bouwen.`,
                timeInsight: {
                    severity: avgTime > 12 ? 'critical' : avgTime > 8 ? 'warning' : 'good',
                    text: avgTime > 12
                        ? `Uw besluiten duren ${avgTime} weken — dat is ${slowdownVsBenchmark} weken langer dan het sectorgemiddelde. In die extra weken lopen kosten op, verschuiven deadlines en verliezen teams motivatie.`
                        : avgTime > 8
                        ? `Met ${avgTime} weken per besluit zit u net boven het gemiddelde van 8 weken. Elke week vertraging kost u momentum in een markt die steeds sneller beweegt.`
                        : `${avgTime} weken per besluit is snel voor uw sector. Dit geeft u een concurrentievoordeel ten opzichte van tragere spelers.`,
                    impact: avgTime > 8 ? `↑ €${(weeklyDebtGrowth * slowdownVsBenchmark).toLocaleString('nl-BE')}/besluit aan verborgen kosten` : `✓ ${8 - avgTime} weken sneller dan sector`
                },
                openInsight: {
                    severity: openDec > 30 ? 'critical' : openDec > 15 ? 'warning' : 'good',
                    text: openDec > 30
                        ? `${openDec} openstaande besluiten betekent dat uw management constant brandjes blust in plaats van strategisch te sturen. Dat is ~${decisionsPerPerson} besluiten per leidinggevende die aandacht vragen.`
                        : openDec > 15
                        ? `${openDec} open besluiten: elk daarvan vreet aandacht van uw teams. Hoe langer ze openstaan, hoe meer ze kosten — en hoe moeilijker ze worden.`
                        : `${openDec} openstaande besluiten is beheersbaar. Uw organisatie houdt de besluitvormingspipeline relatief schoon.`,
                    impact: openDec > 15 ? `~${decisionsPerPerson} besluiten per leidinggevende wachten op actie` : `✓ Onder controle`
                },
                meetingInsight: {
                    severity: meetings > 10 ? 'critical' : meetings > 7 ? 'warning' : 'good',
                    text: meetings > 10
                        ? `${meetings} vergaderingen per week = ~${Math.round(meetingHoursMonth)} uur/maand. Dat is bijna een volledige werkweek die opgaat aan overleg. Worden daar ook écht besluiten genomen?`
                        : meetings > 7
                        ? `${meetings} meetings per week. Onderzoek toont aan dat meer vergaderen niet leidt tot betere besluiten — maar vaak tot besluitvormingsmoeheid.`
                        : `${meetings} vergaderingen per week is efficiënt. Uw organisatie vergadert doelgericht.`,
                    impact: meetings > 7 ? `~${Math.round(meetingHoursMonth)}u/maand aan vergadertijd` : `✓ Efficiënt vergaderritme`
                },
                debtInsight: {
                    severity: debt > 1000000 ? 'critical' : debt > 300000 ? 'warning' : 'good',
                    text: debt > 1000000
                        ? `€${(debt/1000000).toFixed(1)}M aan besluitvormingsschuld — dat is kapitaal dat vastzit in uitgestelde keuzes. Elke week dat deze besluiten openstaan, groeit deze schuld met ~€${weeklyDebtGrowth.toLocaleString('nl-BE')}.`
                        : debt > 300000
                        ? `€${(debt/1000).toFixed(0)}K aan waarde zit vast in uitgestelde besluiten. Dit bedrag representeert gemiste kansen, uitgestelde projecten en oplopende kosten.`
                        : `€${(debt/1000).toFixed(0)}K aan besluitvormingsschuld is relatief laag. Uw organisatie neemt tijdig besluiten.`,
                    impact: debt > 300000 ? `+€${weeklyDebtGrowth.toLocaleString('nl-BE')}/week aan groeiende schuld` : `✓ Beheersbare besluitschulden`
                },
                painPointsIntro: 'Dit zijn de kernuitdagingen die uw besluitvorming vertragen:',
                competitorIntro: 'Waar uw concurrenten voorlopen:',
                ctaText: score < 50
                    ? 'Laat onze AI-agents uw grootste pijnpunt analyseren →'
                    : score < 70
                    ? 'Ontdek hoe u uw score naar 80+ brengt →'
                    : 'Optimaliseer uw besluitvormingsvoorsprong →'
            };
        } else {
            return {
                narrative: score < 50
                    ? `${companyData.company} is currently losing control of strategic decision-making. Your score of ${score}/100 points to structural delays directly affecting your competitive position and operational costs.`
                    : score < 70
                    ? `${companyData.company} performs below the sector average (65) in decision-making. There are concrete improvement opportunities that can deliver immediate results.`
                    : `${companyData.company} scores above average on decision-making. Targeted optimizations can help extend your competitive advantage.`,
                timeInsight: {
                    severity: avgTime > 12 ? 'critical' : avgTime > 8 ? 'warning' : 'good',
                    text: avgTime > 12
                        ? `Your decisions take ${avgTime} weeks — ${slowdownVsBenchmark} weeks longer than the sector average. In those extra weeks, costs mount, deadlines shift, and teams lose motivation.`
                        : avgTime > 8
                        ? `At ${avgTime} weeks per decision, you're just above the 8-week average. Every week of delay costs momentum in an ever-faster market.`
                        : `${avgTime} weeks per decision is fast for your sector. This gives you a competitive edge over slower players.`,
                    impact: avgTime > 8 ? `↑ €${(weeklyDebtGrowth * slowdownVsBenchmark).toLocaleString('en')}/decision in hidden costs` : `✓ ${8 - avgTime} weeks faster than sector`
                },
                openInsight: {
                    severity: openDec > 30 ? 'critical' : openDec > 15 ? 'warning' : 'good',
                    text: openDec > 30
                        ? `${openDec} open decisions means your management is constantly firefighting instead of steering strategically. That's ~${decisionsPerPerson} decisions per leader demanding attention.`
                        : openDec > 15
                        ? `${openDec} open decisions: each one consumes team attention. The longer they stay open, the more they cost — and the harder they become.`
                        : `${openDec} open decisions is manageable. Your organization keeps the pipeline relatively clean.`,
                    impact: openDec > 15 ? `~${decisionsPerPerson} decisions per leader awaiting action` : `✓ Under control`
                },
                meetingInsight: {
                    severity: meetings > 10 ? 'critical' : meetings > 7 ? 'warning' : 'good',
                    text: meetings > 10
                        ? `${meetings} meetings/week = ~${Math.round(meetingHoursMonth)} hrs/month. That's nearly a full work week spent in meetings. Are decisions actually being made?`
                        : meetings > 7
                        ? `${meetings} meetings/week. Research shows more meetings don't lead to better decisions — but often to decision fatigue.`
                        : `${meetings} meetings per week is efficient. Your organization meets with purpose.`,
                    impact: meetings > 7 ? `~${Math.round(meetingHoursMonth)}h/month in meeting time` : `✓ Efficient meeting cadence`
                },
                debtInsight: {
                    severity: debt > 1000000 ? 'critical' : debt > 300000 ? 'warning' : 'good',
                    text: debt > 1000000
                        ? `€${(debt/1000000).toFixed(1)}M in decision debt — capital locked up in deferred choices. Every week these decisions stay open, this debt grows by ~€${weeklyDebtGrowth.toLocaleString('en')}.`
                        : debt > 300000
                        ? `€${(debt/1000).toFixed(0)}K in value is tied up in deferred decisions. This represents missed opportunities, delayed projects, and rising costs.`
                        : `€${(debt/1000).toFixed(0)}K in decision debt is relatively low. Your organization makes timely decisions.`,
                    impact: debt > 300000 ? `+€${weeklyDebtGrowth.toLocaleString('en')}/week in growing debt` : `✓ Manageable decision debt`
                },
                painPointsIntro: 'These are the core challenges slowing your decision-making:',
                competitorIntro: 'Where your competitors are ahead:',
                ctaText: score < 50
                    ? 'Let our AI agents analyze your biggest pain point →'
                    : score < 70
                    ? 'Discover how to raise your score to 80+ →'
                    : 'Optimize your decision-making advantage →'
            };
        }
    };

    // ─── INNOVATIVE: LiveContextPanel with AI-Driven Personalization ───
    // Features: Real-time Cost Ticker, AI Perspective Badge, Confidence Score, Live Pulse
    const LiveContextPanel = ({ liveContext, companyData, lang, revealStep }) => {
        const [costTicker, setCostTicker] = React.useState(0);
        const [elapsedSec, setElapsedSec] = React.useState(0);

        // INNOVATIVE: Real-time Decision Cost Ticker — shows cost accumulating per second
        React.useEffect(() => {
            const dailyCost = companyData.decisionDebt ? companyData.decisionDebt / 365 : 500;
            const costPerSecond = dailyCost / 86400;
            const interval = setInterval(() => {
                setElapsedSec(prev => prev + 1);
                setCostTicker(prev => prev + costPerSecond);
            }, 1000);
            return () => clearInterval(interval);
        }, []);

        const isNl = lang === 'nl';
        const scanAngleShort = liveContext.scan_angle
            ? (isNl
                ? liveContext.scan_angle.replace(/^(Analyseer |Bekijk |Focus op )/i, '').substring(0, 50)
                : liveContext.scan_angle.replace(/^(Analyze |View |Focus on )/i, '').substring(0, 50))
            : null;

        return React.createElement('div', {
            style: { opacity: revealStep >= 1 ? 1 : 0, transform: revealStep >= 1 ? 'translateY(0)' : 'translateY(12px)', transition: 'all 0.6s ease' }
        },
            // ── AI Perspective Badge — shows unique analysis angle ──
            scanAngleShort && React.createElement('div', {
                style: {
                    display: 'flex', alignItems: 'center', gap: 8, marginBottom: 12,
                    padding: '8px 14px', borderRadius: 20,
                    background: 'linear-gradient(135deg, rgba(139,92,246,0.1) 0%, rgba(96,165,250,0.08) 100%)',
                    border: '1px solid rgba(139,92,246,0.2)', width: 'fit-content'
                }
            },
                React.createElement('svg', { width: 14, height: 14, viewBox: '0 0 24 24', fill: 'none', stroke: '#A78BFA', strokeWidth: 2 },
                    React.createElement('circle', { cx: 12, cy: 12, r: 10 }),
                    React.createElement('path', { d: 'M12 6v6l4 2' })
                ),
                React.createElement('span', {
                    style: { fontSize: 11, color: 'rgba(167,139,250,0.9)', fontWeight: 500 }
                }, isNl ? 'AI-perspectief: ' : 'AI perspective: '),
                React.createElement('span', {
                    style: { fontSize: 11, color: 'rgba(255,255,255,0.7)', fontStyle: 'italic' }
                }, scanAngleShort)
            ),

            // ── LIVE Headline card ──
            React.createElement('div', {
                className: 'scan-narrative',
                style: { borderColor: 'rgba(251,113,133,0.3)', background: 'linear-gradient(135deg, rgba(251,113,133,0.05) 0%, rgba(96,165,250,0.05) 100%)' }
            },
                React.createElement('div', {
                    className: 'scan-narrative-icon',
                    style: { background: 'linear-gradient(135deg, #FB7185, #F59E0B)', position: 'relative' }
                },
                    React.createElement('svg', { width: 20, height: 20, viewBox: '0 0 24 24', fill: 'none', stroke: '#fff', strokeWidth: 2, strokeLinecap: 'round' },
                        React.createElement('path', { d: 'M4.9 19.1C1 15.2 1 8.8 4.9 4.9' }),
                        React.createElement('path', { d: 'M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.4' }),
                        React.createElement('circle', { cx: 12, cy: 12, r: 2, fill: '#fff' }),
                        React.createElement('path', { d: 'M16.2 7.8c2.3 2.3 2.3 6.1 0 8.4' }),
                        React.createElement('path', { d: 'M19.1 4.9C23 8.8 23 15.1 19.1 19' })
                    )
                ),
                React.createElement('div', null,
                    React.createElement('h3', {
                        style: { fontSize: 16, fontWeight: 700, color: '#FB7185', marginBottom: 6 }
                    }, liveContext.headline),
                    React.createElement('p', {
                        style: { fontSize: 13, lineHeight: 1.6, color: 'rgba(255,255,255,0.75)' }
                    }, liveContext.context),
                    // LIVE timestamp with pulsing dot
                    liveContext.scraped_at && React.createElement('div', {
                        style: { display: 'flex', alignItems: 'center', gap: 6, marginTop: 8 }
                    },
                        React.createElement('span', {
                            style: { width: 6, height: 6, borderRadius: '50%', background: '#EF4444', display: 'inline-block', animation: 'agentPulse 1.5s ease-in-out infinite' }
                        }),
                        React.createElement('span', {
                            style: { fontSize: 10, color: 'rgba(6,214,160,0.7)', fontWeight: 600, textTransform: 'uppercase', letterSpacing: '0.5px' }
                        }, 'LIVE'),
                        React.createElement('span', {
                            style: { fontSize: 10, color: 'rgba(255,255,255,0.3)' }
                        }, `${isNl ? 'Geanalyseerd' : 'Analyzed'} ${liveContext.scraped_at}`)
                    )
                )
            ),

            // ── INNOVATIVE: Real-time Decision Cost Ticker ──
            React.createElement('div', {
                style: {
                    marginTop: 12, padding: '14px 18px', borderRadius: 12,
                    background: 'linear-gradient(135deg, rgba(239,68,68,0.08) 0%, rgba(251,113,133,0.04) 100%)',
                    border: '1px solid rgba(239,68,68,0.15)',
                    display: 'flex', alignItems: 'center', justifyContent: 'space-between'
                }
            },
                React.createElement('div', { style: { display: 'flex', alignItems: 'center', gap: 10 } },
                    React.createElement('svg', { width: 18, height: 18, viewBox: '0 0 24 24', fill: 'none', stroke: '#EF4444', strokeWidth: 2 },
                        React.createElement('circle', { cx: 12, cy: 12, r: 10 }),
                        React.createElement('polyline', { points: '12 6 12 12 16 14' })
                    ),
                    React.createElement('div', null,
                        React.createElement('div', {
                            style: { fontSize: 11, color: 'rgba(239,68,68,0.8)', fontWeight: 600, textTransform: 'uppercase', letterSpacing: '0.5px' }
                        }, isNl ? 'Besluitvormingskosten sinds scan' : 'Decision cost since scan'),
                        React.createElement('div', {
                            style: { fontSize: 10, color: 'rgba(255,255,255,0.3)', marginTop: 2 }
                        }, isNl ? `${elapsedSec}s verstreken — elke seconde telt` : `${elapsedSec}s elapsed — every second counts`)
                    )
                ),
                React.createElement('div', {
                    style: {
                        fontSize: 22, fontWeight: 800, fontFamily: 'monospace',
                        color: '#EF4444', letterSpacing: '-0.5px',
                        textShadow: '0 0 20px rgba(239,68,68,0.3)'
                    }
                }, `€${costTicker.toFixed(2)}`)
            ),

            // ── Pain points with modern tags ──
            liveContext.painPoints && liveContext.painPoints.length > 0 && React.createElement('div', {
                style: { marginTop: 16, marginBottom: 16 }
            },
                React.createElement('div', {
                    style: { fontSize: 12, color: 'rgba(255,255,255,0.4)', marginBottom: 8, fontWeight: 500 }
                }, isNl ? `Wat vandaag speelt bij ${companyData.company}:` : `What's happening at ${companyData.company} today:`),
                React.createElement('div', {
                    style: { display: 'flex', flexWrap: 'wrap', gap: 6 }
                },
                    ...liveContext.painPoints.map((pp, i) => React.createElement('span', {
                        key: i, className: 'pain-point-tag',
                        style: { display: 'inline-flex', alignItems: 'center', gap: 4 }
                    },
                        React.createElement('svg', { width: 10, height: 10, viewBox: '0 0 24 24', fill: '#F59E0B', stroke: 'none' },
                            React.createElement('polygon', { points: '13 2 3 14 12 14 11 22 21 10 12 10 13 2' })
                        ),
                        pp
                    ))
                )
            ),

            // ── Source links ──
            liveContext.sources && liveContext.sources.length > 0 && React.createElement('div', {
                style: {
                    marginTop: 8, padding: '12px 16px', borderRadius: 10,
                    background: 'rgba(6,214,160,0.04)', border: '1px solid rgba(6,214,160,0.1)'
                }
            },
                React.createElement('div', {
                    style: { fontSize: 11, color: 'rgba(6,214,160,0.7)', fontWeight: 600, marginBottom: 8, textTransform: 'uppercase', letterSpacing: '0.5px', display: 'flex', alignItems: 'center', gap: 6 }
                },
                    React.createElement('span', { style: { width: 6, height: 6, borderRadius: '50%', background: '#EF4444', display: 'inline-block', animation: 'agentPulse 1.5s ease-in-out infinite' } }),
                    isNl ? 'AI-bronnen' : 'AI Sources'
                ),
                ...liveContext.sources.map((src, i) => React.createElement('a', {
                    key: i, href: src.url, target: '_blank', rel: 'noopener noreferrer',
                    style: {
                        display: 'flex', alignItems: 'flex-start', gap: 8,
                        padding: '6px 0', textDecoration: 'none',
                        borderTop: i > 0 ? '1px solid rgba(255,255,255,0.04)' : 'none'
                    }
                },
                    React.createElement('svg', { width: 12, height: 12, viewBox: '0 0 24 24', fill: 'none', stroke: 'rgba(255,255,255,0.3)', strokeWidth: 2, style: { flexShrink: 0, marginTop: 2 } },
                        React.createElement('path', { d: 'M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71' }),
                        React.createElement('path', { d: 'M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71' })
                    ),
                    React.createElement('div', null,
                        React.createElement('div', { style: { fontSize: 12, color: 'rgba(96,165,250,0.9)', lineHeight: 1.4 } },
                            src.title ? (src.title.length > 80 ? src.title.substring(0, 80) + '...' : src.title) : src.url
                        ),
                        React.createElement('div', { style: { fontSize: 10, color: 'rgba(255,255,255,0.25)', marginTop: 2 } },
                            src.source || 'AI-analyse'
                        )
                    )
                ))
            )
        );
    };

    const ScanScreen = ({ email, onProceed, t, lang }) => {
        const domain = parseEmailDomain(email);
        const companyData = generateMockCompanyData(domain);
        const [customerLogo, setCustomerLogo] = React.useState(null);
        const [logoLoading, setLogoLoading] = React.useState(false);
        const [revealStep, setRevealStep] = React.useState(0);
        const [liveContext, setLiveContext] = React.useState(null);
        const [contextLoading, setContextLoading] = React.useState(true);
        const fallbackInsights = generateInsights(companyData, lang);

        // Fetch LIVE context from Claude API — DIRECT browser call
        React.useEffect(() => {
            const fetchContext = async () => {
                setContextLoading(true);
                try {
                    const data = await performCompanyScan(
                        companyData.company,
                        companyData.sector,
                        domain,
                        String(companyData.employees),
                        lang
                    );
                    if (data && data.headline) {
                        setLiveContext(data);
                    }
                } catch (err) {
                    console.log('Live context fetch failed, using fallback:', err);
                }
                setContextLoading(false);
            };
            fetchContext();
        }, [email, lang]);

        React.useEffect(() => {
            if (email) {
                const domain = parseEmailDomain(email);
                if (domain) {
                    setLogoLoading(true);
                    const logoUrls = [
                        `https://logo.clearbit.com/${domain}`,
                        `https://logo.clearbit.com/${companyData.company.toLowerCase()}.com`,
                        `https://www.google.com/s2/favicons?domain=${domain}&sz=128`
                    ];
                    let urlIndex = 0;
                    const tryNextUrl = () => {
                        if (urlIndex >= logoUrls.length) { setCustomerLogo(null); setLogoLoading(false); return; }
                        const logoUrl = logoUrls[urlIndex];
                        const img = new Image();
                        img.onload = () => { clearTimeout(timeout); setCustomerLogo(logoUrl); setLogoLoading(false); };
                        img.onerror = () => { clearTimeout(timeout); urlIndex++; tryNextUrl(); };
                        const timeout = setTimeout(() => { urlIndex++; tryNextUrl(); }, 2000);
                        img.src = logoUrl;
                    };
                    tryNextUrl();
                }
            }
        }, [email]);

        // Progressive reveal animation
        React.useEffect(() => {
            const timers = [
                setTimeout(() => setRevealStep(1), 300),
                setTimeout(() => setRevealStep(2), 800),
                setTimeout(() => setRevealStep(3), 1300),
                setTimeout(() => setRevealStep(4), 1800),
                setTimeout(() => setRevealStep(5), 2300),
                setTimeout(() => setRevealStep(6), 2800)
            ];
            return () => timers.forEach(clearTimeout);
        }, []);

        const severityIcon = (s) => React.createElement('svg', { width: 10, height: 10, viewBox: '0 0 24 24', fill: s === 'critical' ? '#EF4444' : s === 'warning' ? '#F59E0B' : '#06D6A0', stroke: 'none' },
            React.createElement('circle', { cx: 12, cy: 12, r: 8 })
        );

        return (
            <div className="screen-container screen-enter" style={{
                padding: 'clamp(20px, 4vw, 40px)', maxWidth: 1100, margin: '0 auto'
            }}>
                {/* Company header - compact */}
                <div style={{
                    display: 'flex', alignItems: 'center', gap: 16, marginBottom: 24,
                    opacity: revealStep >= 0 ? 1 : 0, transition: 'opacity 0.5s ease'
                }}>
                    {customerLogo ? (
                        <div style={{
                            width: 56, height: 56, borderRadius: '50%', background: 'rgba(255,255,255,0.08)',
                            display: 'flex', alignItems: 'center', justifyContent: 'center',
                            border: '2px solid rgba(255,255,255,0.1)', padding: 6, flexShrink: 0
                        }}>
                            <img src={customerLogo} alt="" style={{ maxWidth: '100%', maxHeight: '100%' }} />
                        </div>
                    ) : !logoLoading && email ? (
                        <div style={{
                            width: 56, height: 56, borderRadius: '50%',
                            background: 'linear-gradient(135deg, rgba(6,214,160,0.2), rgba(6,214,160,0.05))',
                            border: '2px solid rgba(6,214,160,0.3)', display: 'flex', alignItems: 'center',
                            justifyContent: 'center', fontSize: 22, fontWeight: 700, color: '#06D6A0', flexShrink: 0
                        }}>
                            {companyData.company.substring(0, 2).toUpperCase()}
                        </div>
                    ) : null}
                    <div>
                        <h2 style={{ fontSize: 22, fontWeight: 700, marginBottom: 2 }}>{companyData.company}</h2>
                        <p style={{ fontSize: 13, color: 'rgba(255,255,255,0.5)' }}>
                            {companyData.sector} · {companyData.employees} {lang === 'nl' ? 'medewerkers' : 'employees'}
                        </p>
                    </div>
                    <div style={{ marginLeft: 'auto' }}>
                        <DecisionHealthGauge score={companyData.decisionHealthScore} size="compact" lang={lang} />
                    </div>
                </div>

                {/* LIVE AI Context — headline from Claude */}
                {contextLoading ? (
                    <div className="scan-narrative" style={{
                        opacity: revealStep >= 1 ? 1 : 0, transition: 'all 0.6s ease',
                        display: 'flex', alignItems: 'center', gap: 12
                    }}>
                        <div className="scan-narrative-icon" style={{ animation: 'agentPulse 1.5s ease-in-out infinite', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                            {React.createElement('svg', { width: 20, height: 20, viewBox: '0 0 24 24', fill: 'none', stroke: '#06D6A0', strokeWidth: 2, strokeLinecap: 'round' },
                                React.createElement('path', { d: 'M12 2a4 4 0 0 1 4 4v2H8V6a4 4 0 0 1 4-4z' }),
                                React.createElement('rect', { x: 3, y: 8, width: 18, height: 12, rx: 3 }),
                                React.createElement('circle', { cx: 9, cy: 14, r: 1.5, fill: '#06D6A0' }),
                                React.createElement('circle', { cx: 15, cy: 14, r: 1.5, fill: '#06D6A0' })
                            )}
                        </div>
                        <div>
                            <p style={{ fontSize: 14, color: 'rgba(255,255,255,0.6)', fontStyle: 'italic' }}>
                                {lang === 'nl'
                                    ? 'AI analyseert actuele context voor ' + companyData.company + '...'
                                    : 'AI analyzing current context for ' + companyData.company + '...'}
                            </p>
                            <div style={{ width: 200, height: 3, background: 'rgba(255,255,255,0.06)', borderRadius: 2, marginTop: 8, overflow: 'hidden' }}>
                                <div style={{ width: '60%', height: '100%', background: 'linear-gradient(90deg, #06D6A0, #60A5FA)', borderRadius: 2, animation: 'welcomeWave 2s ease-in-out infinite' }}></div>
                            </div>
                        </div>
                    </div>
                ) : liveContext ? (
                    /* Live headline + context from Claude — AI-DRIVEN PERSONALIZATION */
                    React.createElement(LiveContextPanel, { liveContext, companyData, lang, revealStep })

                ) : (
                    /* Fallback narrative */
                    <div className="scan-narrative" style={{
                        opacity: revealStep >= 1 ? 1 : 0, transform: revealStep >= 1 ? 'translateY(0)' : 'translateY(12px)',
                        transition: 'all 0.6s ease'
                    }}>
                        <div className="scan-narrative-icon" style={{ display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                            {React.createElement('svg', { width: 20, height: 20, viewBox: '0 0 24 24', fill: 'none', stroke: '#60A5FA', strokeWidth: 2, strokeLinecap: 'round' },
                                React.createElement('circle', { cx: 11, cy: 11, r: 8 }),
                                React.createElement('line', { x1: 21, y1: 21, x2: 16.65, y2: 16.65 })
                            )}
                        </div>
                        <p style={{ fontSize: 14, lineHeight: 1.7, color: 'rgba(255,255,255,0.85)', paddingTop: 4 }}>
                            {fallbackInsights.narrative}
                        </p>
                    </div>
                )}

                {/* Main insight grid — now with LIVE context overlays */}
                <div className="scan-section-title" style={{
                    opacity: revealStep >= 2 ? 1 : 0, transition: 'opacity 0.5s ease'
                }}>
                    {lang === 'nl' ? 'Wat dit betekent voor uw organisatie' : 'What this means for your organization'}
                </div>

                <div style={{
                    display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 12, marginBottom: 24
                }}>
                    {/* Decision Time Insight — enhanced with live context */}
                    <div className={`insight-card ${fallbackInsights.timeInsight.severity}`} style={{
                        animationDelay: '0.2s', opacity: revealStep >= 2 ? undefined : 0,
                        animation: revealStep >= 2 ? 'insightSlideIn 0.5s ease 0.1s forwards' : 'none'
                    }}>
                        <div className="insight-header">
                            <span className="insight-emoji" style={{ display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                                {React.createElement('svg', { width: 18, height: 18, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round' },
                                    React.createElement('circle', { cx: 12, cy: 12, r: 10 }),
                                    React.createElement('polyline', { points: '12 6 12 12 16 14' })
                                )}
                            </span>
                            <div>
                                <div className="insight-label">{t(lang).avgDecisionTime}</div>
                                <div className="insight-metric">{companyData.metrics.avgDecisionTime}</div>
                            </div>
                            <span style={{ marginLeft: 'auto', fontSize: 12 }}>{severityIcon(fallbackInsights.timeInsight.severity)}</span>
                        </div>
                        <p className="insight-text">
                            {liveContext && liveContext.insight_time ? liveContext.insight_time : fallbackInsights.timeInsight.text}
                        </p>
                        <div className={`insight-impact ${fallbackInsights.timeInsight.severity === 'good' ? 'positive' : 'negative'}`}>
                            {fallbackInsights.timeInsight.impact}
                        </div>
                    </div>

                    {/* Open Decisions Insight */}
                    <div className={`insight-card ${fallbackInsights.openInsight.severity}`} style={{
                        opacity: revealStep >= 3 ? undefined : 0,
                        animation: revealStep >= 3 ? 'insightSlideIn 0.5s ease 0.15s forwards' : 'none'
                    }}>
                        <div className="insight-header">
                            <span className="insight-emoji" style={{ display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                                {React.createElement('svg', { width: 18, height: 18, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round' },
                                    React.createElement('path', { d: 'M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z' }),
                                    React.createElement('polyline', { points: '14 2 14 8 20 8' }),
                                    React.createElement('line', { x1: 16, y1: 13, x2: 8, y2: 13 }),
                                    React.createElement('line', { x1: 16, y1: 17, x2: 8, y2: 17 })
                                )}
                            </span>
                            <div>
                                <div className="insight-label">{t(lang).openDecisions}</div>
                                <div className="insight-metric">{companyData.metrics.openDecisions}</div>
                            </div>
                            <span style={{ marginLeft: 'auto', fontSize: 12 }}>{severityIcon(fallbackInsights.openInsight.severity)}</span>
                        </div>
                        <p className="insight-text">{fallbackInsights.openInsight.text}</p>
                        <div className={`insight-impact ${fallbackInsights.openInsight.severity === 'good' ? 'positive' : 'negative'}`}>
                            {fallbackInsights.openInsight.impact}
                        </div>
                    </div>

                    {/* Competitor Threat — live AI insight */}
                    <div className={`insight-card ${liveContext && liveContext.competitorThreat ? 'critical' : fallbackInsights.meetingInsight.severity}`} style={{
                        opacity: revealStep >= 4 ? undefined : 0,
                        animation: revealStep >= 4 ? 'insightSlideIn 0.5s ease 0.1s forwards' : 'none'
                    }}>
                        <div className="insight-header">
                            <span className="insight-emoji" style={{ display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                                {React.createElement('svg', { width: 18, height: 18, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round' },
                                    React.createElement('path', { d: 'M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z' }),
                                    React.createElement('line', { x1: 12, y1: 8, x2: 12, y2: 12 }),
                                    React.createElement('line', { x1: 12, y1: 16, x2: 12.01, y2: 16 })
                                )}
                            </span>
                            <div>
                                <div className="insight-label">{lang === 'nl' ? 'Concurrentiedruk' : 'Competitive Pressure'}</div>
                                <div className="insight-metric" style={{ fontSize: 16 }}>
                                    {liveContext && liveContext.competitorThreat
                                        ? (liveContext.competitorThreat.length > 40 ? liveContext.competitorThreat.substring(0, 40) + '...' : liveContext.competitorThreat)
                                        : (companyData.competitors[0]?.name || 'N/A')}
                                </div>
                            </div>
                            <span style={{ marginLeft: 'auto', fontSize: 12, color: '#EF4444' }}>
                                {React.createElement('svg', { width: 14, height: 14, viewBox: '0 0 24 24', fill: '#EF4444', stroke: 'none' },
                                    React.createElement('circle', { cx: 12, cy: 12, r: 6 })
                                )}
                            </span>
                        </div>
                        <p className="insight-text">
                            {liveContext && liveContext.competitorThreat
                                ? liveContext.competitorThreat
                                : fallbackInsights.meetingInsight.text}
                        </p>
                    </div>

                    {/* Decision Debt Insight — enhanced with live context */}
                    <div className={`insight-card ${fallbackInsights.debtInsight.severity}`} style={{
                        opacity: revealStep >= 5 ? undefined : 0,
                        animation: revealStep >= 5 ? 'insightSlideIn 0.5s ease 0.15s forwards' : 'none'
                    }}>
                        <div className="insight-header">
                            <span className="insight-emoji" style={{ display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                                {React.createElement('svg', { width: 18, height: 18, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round' },
                                    React.createElement('line', { x1: 12, y1: 1, x2: 12, y2: 23 }),
                                    React.createElement('path', { d: 'M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6' })
                                )}
                            </span>
                            <div>
                                <div className="insight-label">{t(lang).decisionDebt}</div>
                                <div className="insight-metric">€{companyData.decisionDebt >= 1000000
                                    ? (companyData.decisionDebt/1000000).toFixed(1) + 'M'
                                    : Math.round(companyData.decisionDebt/1000) + 'K'}</div>
                            </div>
                            <span style={{ marginLeft: 'auto', fontSize: 12 }}>{severityIcon(fallbackInsights.debtInsight.severity)}</span>
                        </div>
                        <p className="insight-text">
                            {liveContext && liveContext.insight_debt ? liveContext.insight_debt : fallbackInsights.debtInsight.text}
                        </p>
                        <div className={`insight-impact ${fallbackInsights.debtInsight.severity === 'good' ? 'positive' : 'negative'}`}>
                            {fallbackInsights.debtInsight.impact}
                        </div>
                    </div>
                </div>

                {/* CTA button */}
                <button onClick={() => onProceed({ ...companyData, liveContext })} className="btn-primary" style={{
                    opacity: revealStep >= 6 ? 1 : 0, transform: revealStep >= 6 ? 'translateY(0)' : 'translateY(8px)',
                    transition: 'all 0.5s ease 0.2s'
                }}>
                    {liveContext
                        ? (lang === 'nl' ? 'Laat onze AI-agents dit analyseren →' : 'Let our AI agents analyze this →')
                        : fallbackInsights.ctaText}
                </button>
            </div>
        );
    };

    // INITIAL_AGENTS constant — "The Decision Squad" with unique personalities
    const INITIAL_AGENTS = [
        { name: 'Framing Agent', nickname: 'Nova', tagline: 'De Visionair', personality: 'Ziet altijd het grote geheel', status: 'waiting', result: null, color: '#8B5CF6', type: 'framing' },
        { name: 'Data Agent', nickname: 'Byte', tagline: 'De Analyst', personality: 'Data liegt nooit', status: 'waiting', result: null, color: '#3B82F6', type: 'data' },
        { name: 'Options Agent', nickname: 'Spark', tagline: 'De Strateeg', personality: 'Er is altijd een betere optie', status: 'waiting', result: null, color: '#06D6A0', type: 'options' },
        { name: 'Risk Agent', nickname: 'Shield', tagline: 'De Bewaker', personality: 'Ik bescherm wat je kunt verliezen', status: 'waiting', result: null, color: '#F59E0B', type: 'risk' },
        { name: 'Recommendation Agent', nickname: 'Sage', tagline: 'De Adviseur', personality: 'Het juiste besluit op het juiste moment', status: 'waiting', result: null, color: '#EC4899', type: 'recommendation' }
    ];

    const DecisionEngineScreen = ({ companyData, onComplete, t, lang }) => {
        const [agents, setAgents] = useState(INITIAL_AGENTS.map(a => ({...a})));
        const [showMonteCarloOptions, setShowMonteCarloOptions] = useState(false);
        const [selectedAgent, setSelectedAgent] = useState(null);
        const [customQuestion, setCustomQuestion] = useState('Wat is onze strategische richting?');
        const [showCustomInput, setShowCustomInput] = useState(false);
        const [isRunning, setIsRunning] = useState(true);
        const abortRef = useRef(null);

        useEffect(() => {
            const defaultQuestion = lang === 'nl' ? 'Wat is onze strategische richting?' : 'What is our strategic direction?';
            setCustomQuestion(defaultQuestion);
        }, [lang]);

        useEffect(() => {
            const controller = new AbortController();
            abortRef.current = controller;
            let isMounted = true;

            const runAgentsParallel = async () => {
                setAgents(prev => prev.map(a => ({ ...a, status: 'thinking' })));

                // Sanitize inputs for prompt injection prevention
                const sanitize = (str) => String(str || '').replace(/[`]/g, '');
                const safeCompany = sanitize(companyData.company);
                const safeSector = sanitize(companyData.sector);
                const safeQuestion = sanitize(customQuestion);

                const systemPrompts = INITIAL_AGENTS.map(agent =>
                    getAgentSystemPrompt(agent.name, safeCompany, safeSector, lang, safeQuestion, companyData)
                );

                // Build a rich user message with the actual question + company context
                const userMsg = lang === 'nl'
                    ? `Beslissingsvraag: "${safeQuestion}"\n\nAnalyseer dit voor ${safeCompany} (${safeSector}, ${companyData.employees} medewerkers). Decision Health Score: ${companyData.decisionHealthScore}/100. Geef een concreet, specifiek antwoord.`
                    : `Decision question: "${safeQuestion}"\n\nAnalyze this for ${safeCompany} (${safeSector}, ${companyData.employees} employees). Decision Health Score: ${companyData.decisionHealthScore}/100. Give a concrete, specific answer.`;

                try {
                    const results = await Promise.all(
                        INITIAL_AGENTS.map((agent, idx) =>
                            callCheevoAPI(systemPrompts[idx], userMsg)
                        )
                    );

                    if (!isMounted) return; // Don't update state if unmounted

                    setAgents(prev =>
                        prev.map((agent, idx) => ({
                            ...agent,
                            status: 'done',
                            result: (results[idx] && results[idx].text)
                                ? results[idx]
                                : { text: generateDemoResponses(agent.name, companyData, lang), isLive: false, elapsed: '0' }
                        }))
                    );

                    setTimeout(() => { if (isMounted) setShowMonteCarloOptions(true); }, 400);
                    if (isMounted) setIsRunning(false);
                } catch (err) {
                    console.error('Agent execution failed:', err);
                    if (!isMounted) return;
                    // Fallback: use demo responses for all agents
                    setAgents(prev =>
                        prev.map(agent => ({
                            ...agent,
                            status: 'done',
                            result: { text: generateDemoResponses(agent.name, companyData, lang), isLive: false, elapsed: '0' }
                        }))
                    );
                    setShowMonteCarloOptions(true);
                    setIsRunning(false);
                }
            };

            runAgentsParallel();

            return () => {
                isMounted = false;
                controller.abort();
            };
        }, []);

        const allDone = agents.every(a => a.status === 'done');

        // Generate dynamic probabilities based on agent results and company health
        const healthFactor = companyData.decisionHealthScore / 100;
        const liveAgentCount = agents.filter(a => a.result?.isLive).length;

        let optAProb = Math.round(45 + healthFactor * 35 + liveAgentCount * 3);
        let optBProb = Math.round(40 + healthFactor * 25 + (companyData.metrics.openDecisions % 5));
        let optCProb = Math.round(15 + (1 - healthFactor) * 20);

        // Cap values between 5 and 95
        optAProb = Math.max(5, Math.min(95, optAProb));
        optBProb = Math.max(5, Math.min(95, optBProb));
        optCProb = Math.max(5, Math.min(95, optCProb));

        const monteCarloOptions = [
            { name: lang === 'nl' ? 'Optie A: Snelle transitie' : 'Option A: Quick transition', probability: optAProb },
            { name: lang === 'nl' ? 'Optie B: Gefaseerde aanpak' : 'Option B: Phased approach', probability: optBProb },
            { name: lang === 'nl' ? 'Optie C: Status quo' : 'Option C: Status quo', probability: optCProb }
        ];

        return (
            <div className="screen-container screen-enter" style={{
                padding: 'clamp(20px, 4vw, 40px)', maxWidth: 1200, margin: '0 auto'
            }}>
                <h2 className="section-title" style={{ marginBottom: 8 }}>{t(lang).engineTitle}</h2>
                <p className="text-muted" style={{ marginBottom: 24 }}>{t(lang).engineSubtitle}</p>

                {/* Agent progress counter */}
                {isRunning && (() => {
                    const doneCount = agents.filter(a => a.status === 'done').length;
                    return (
                        <div style={{ marginBottom: 16, padding: '12px 20px', borderRadius: 12, background: 'rgba(6,214,160,0.08)', border: '1px solid rgba(6,214,160,0.2)', display: 'flex', alignItems: 'center', gap: 12 }}>
                            <span className="spinner" style={{ width: 16, height: 16 }}></span>
                            <span style={{ fontSize: 14, color: 'rgba(255,255,255,0.9)' }}>
                                {lang === 'nl' ? `Agent ${doneCount + 1}/5 analyseert...` : `Agent ${doneCount + 1}/5 analyzing...`}
                            </span>
                            <div style={{ flex: 1, height: 4, borderRadius: 2, background: 'rgba(255,255,255,0.1)', overflow: 'hidden' }}>
                                <div style={{ width: `${(doneCount / 5) * 100}%`, height: '100%', borderRadius: 2, background: 'linear-gradient(90deg, #06D6A0, #00F5D4)', transition: 'width 0.5s ease' }}></div>
                            </div>
                        </div>
                    );
                })()}

                <div className="glass-card" style={{ marginBottom: 24, opacity: isRunning ? 0.5 : 1, transition: 'opacity 0.3s ease' }}>
                    <div className="label" style={{ marginBottom: 8, display: 'flex', alignItems: 'center', gap: 8 }}>
                        {t(lang).customDecisionLabel}
                        {isRunning && <span className="spinner" style={{ width: 12, height: 12 }}></span>}
                    </div>
                    <div style={{ display: 'flex', gap: 12 }}>
                        <input
                            type="text"
                            value={customQuestion}
                            onChange={(e) => setCustomQuestion(e.target.value)}
                            placeholder={t(lang).enterDecisionQuestion}
                            className="input-field"
                            style={{ flex: 1 }}
                            disabled={isRunning}
                        />
                    </div>
                    {/* Decision templates — personalized to sector */}
                    {!isRunning && (
                        <div style={{ marginTop: 12, display: 'flex', flexWrap: 'wrap', gap: 8 }}>
                            <span style={{ fontSize: 11, color: 'rgba(255,255,255,0.5)', alignSelf: 'center' }}>{lang === 'nl' ? 'Of kies:' : 'Or pick:'}</span>
                            {(() => {
                                const sector = (companyData.sector || '').toLowerCase();
                                const baseNl = [
                                    'Wat is onze optimale AI-adoptie strategie?',
                                    'Hoe versnellen we onze besluitvorming met 40%?',
                                    'Welke investering levert de hoogste ROI dit jaar?',
                                    'Moeten we uitbreiden of consolideren?'
                                ];
                                const baseEn = [
                                    'What is our optimal AI adoption strategy?',
                                    'How do we speed up decision-making by 40%?',
                                    'Which investment delivers highest ROI this year?',
                                    'Should we expand or consolidate?'
                                ];
                                // Add sector-specific templates
                                if (sector.includes('tech') || sector.includes('software') || sector.includes('saas')) {
                                    baseNl.push('Build vs. buy: welke aanpak past bij ons?');
                                    baseEn.push('Build vs. buy: which approach fits us?');
                                } else if (sector.includes('health') || sector.includes('pharma') || sector.includes('zorg')) {
                                    baseNl.push('Hoe balanceren we innovatie met compliance?');
                                    baseEn.push('How do we balance innovation with compliance?');
                                } else if (sector.includes('retail') || sector.includes('e-commerce')) {
                                    baseNl.push('Hoe optimaliseren we onze omnichannel strategie?');
                                    baseEn.push('How do we optimize our omnichannel strategy?');
                                } else if (sector.includes('financ') || sector.includes('bank') || sector.includes('verzeker')) {
                                    baseNl.push('Hoe navigeren we de regelgevingsdruk?');
                                    baseEn.push('How do we navigate regulatory pressure?');
                                } else {
                                    baseNl.push('Hoe verbeteren we onze concurrentiepositie?');
                                    baseEn.push('How do we improve our competitive position?');
                                }
                                return (lang === 'nl' ? baseNl : baseEn);
                            })().map((q, i) => (
                                <button key={i} onClick={() => setCustomQuestion(q)} style={{
                                    fontSize: 11, padding: '6px 12px', borderRadius: 20, border: '1px solid rgba(255,255,255,0.12)',
                                    background: 'rgba(255,255,255,0.04)', color: 'rgba(255,255,255,0.7)', cursor: 'pointer',
                                    transition: 'all 0.2s ease'
                                }} onMouseEnter={(e) => { e.target.style.background = 'rgba(6,214,160,0.15)'; e.target.style.borderColor = 'rgba(6,214,160,0.3)'; }}
                                   onMouseLeave={(e) => { e.target.style.background = 'rgba(255,255,255,0.04)'; e.target.style.borderColor = 'rgba(255,255,255,0.12)'; }}
                                >{q}</button>
                            ))}
                        </div>
                    )}
                </div>

                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))', gap: 16, marginBottom: 24 }}>
                    {agents.map((agent, idx) => (
                        <div
                            key={idx}
                            className={`glass-card agent-card agent-${agent.type} ${agent.status === 'thinking' ? 'active' : ''} ${agent.status === 'done' ? 'completed' : ''}`}
                            style={{
                                animation: agent.status === 'thinking' ? 'none' : agent.status === 'done' ? 'scaleIn 0.3s ease' : 'none',
                                cursor: agent.status === 'done' ? 'pointer' : 'default'
                            }}
                            onClick={() => agent.status === 'done' && setSelectedAgent(agent)}
                            role={agent.status === 'done' ? 'button' : undefined}
                            tabIndex={agent.status === 'done' ? 0 : -1}
                            onKeyDown={(e) => {
                                if ((e.key === 'Enter' || e.key === ' ') && agent.status === 'done') {
                                    setSelectedAgent(agent);
                                }
                            }}
                        >
                            <div style={{ display: 'flex', alignItems: 'flex-start', gap: 12, marginBottom: 12 }}>
                                <div className={`agent-icon ${agent.type}${agent.status === 'done' ? ' done' : ''}`} style={{ width: 40, height: 40, padding: 0, display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                                    <AgentAvatar type={agent.type} size={38} />
                                </div>
                                <div style={{ flex: 1 }}>
                                    <div style={{ display: 'flex', alignItems: 'baseline', gap: 8 }}>
                                        <h3 style={{ fontSize: 14, fontWeight: 600, marginBottom: 2 }}>{agent.nickname || agent.name}</h3>
                                        {agent.tagline && <span style={{ fontSize: 10, color: 'rgba(255,255,255,0.3)', fontStyle: 'italic' }}>{agent.tagline}</span>}
                                    </div>
                                    <div className={`agent-status-badge status-${agent.status}`} aria-live="polite">
                                        {agent.status === 'waiting' && (lang === 'nl' ? 'Wacht...' : 'Waiting...')}
                                        {agent.status === 'thinking' && (
                                            <><span className="spinner"></span> {agent.personality ? `"${agent.personality}"` : (lang === 'nl' ? 'Denkt...' : 'Thinking...')}</>
                                        )}
                                        {agent.status === 'done' && (
                                            <span style={{ display: 'flex', alignItems: 'center', gap: 4 }}>
                                                {React.createElement('svg', { width: 10, height: 10, viewBox: '0 0 24 24', fill: 'none', stroke: '#06D6A0', strokeWidth: 3 },
                                                    React.createElement('polyline', { points: '20 6 9 17 4 12' })
                                                )}
                                                {lang === 'nl' ? 'Analyse klaar' : 'Analysis done'}
                                            </span>
                                        )}
                                    </div>
                                </div>
                            </div>
                            {agent.result && agent.result.isLive && (
                                <div style={{ fontSize: 11, color: 'rgba(255,255,255,0.5)', marginTop: 8, paddingTop: 8, borderTop: '1px solid rgba(255,255,255,0.06)' }}>
                                    <span style={{ color: '#06D6A0', fontWeight: 600 }}>AI</span> • {agent.result.elapsed}s
                                </div>
                            )}
                            {agent.result && !agent.result.isLive && (
                                <div style={{ fontSize: 11, color: 'rgba(255,255,255,0.5)', marginTop: 8, paddingTop: 8, borderTop: '1px solid rgba(255,255,255,0.06)' }}>
                                    <span style={{ color: '#06D6A0', fontWeight: 600 }}>AI</span> • {lang === 'nl' ? 'analyse klaar' : 'analysis ready'}
                                </div>
                            )}
                            {agent.status === 'done' && (
                                <div style={{ fontSize: 11, color: 'rgba(6, 214, 160, 0.7)', marginTop: 8, fontStyle: 'italic' }}>
                                    {lang === 'nl' ? 'Klik voor volledige output →' : 'Click for full output →'}
                                </div>
                            )}
                        </div>
                    ))}
                </div>

                {selectedAgent && (
                    <AgentOutputModal agent={selectedAgent} companyData={companyData} onClose={() => setSelectedAgent(null)} lang={lang} />
                )}

                {allDone && (
                    <>
                        <ConsensusView agentResults={agents} lang={lang} />

                        <div style={{ marginBottom: 24 }}>
                            <h3 className="subsection-title" style={{ marginBottom: 16 }}>
                                {lang === 'nl' ? 'Waarschijnlijkheidsanalyse' : 'Probability Analysis'}
                            </h3>
                            <MonteCarloBars options={monteCarloOptions} visible={showMonteCarloOptions} lang={lang} />
                        </div>

                        <button onClick={() => onComplete(companyData, agents)} className="btn-primary" disabled={isRunning || !allDone}>
                            {t(lang).nextBtn}
                        </button>
                    </>
                )}
            </div>
        );
    };

    const CommandCenterScreen = ({ companyData, agentResults, onNewDecision, t, lang }) => {
        const [copyFeedback, setCopyFeedback] = useState(false);
        const [showConfirmDialog, setShowConfirmDialog] = useState(false);

        useEffect(() => {
            const handleEsc = (e) => { if (e.key === 'Escape' && showConfirmDialog) setShowConfirmDialog(false); };
            document.addEventListener('keydown', handleEsc);
            return () => document.removeEventListener('keydown', handleEsc);
        }, [showConfirmDialog]);

        const formatDate = (date) => {
            return date.toISOString().split('T')[0];
        };

        const decisions = useMemo(() => {
            const today = new Date();
            const fiveDaysAgo = new Date(today.getTime() - 5 * 24 * 60 * 60 * 1000);
            const tenDaysAgo = new Date(today.getTime() - 10 * 24 * 60 * 60 * 1000);

            return [
                { date: formatDate(today), title: lang === 'nl' ? 'Digitaliseringsroute bepaald' : 'Digitalization roadmap finalized' },
                { date: formatDate(fiveDaysAgo), title: lang === 'nl' ? 'Budget gealloceerd naar AI-tooling' : 'Budget allocated to AI tooling' },
                { date: formatDate(tenDaysAgo), title: lang === 'nl' ? 'Vendor-selectie voltooid' : 'Vendor selection completed' }
            ];
        }, [lang]);

        const generateExportReport = () => {
            const timestamp = new Date().toLocaleString(lang === 'nl' ? 'nl-NL' : 'en-US');
            let report = `# CheevO! Decision Report\n\n`;
            report += `**${lang === 'nl' ? 'Gegenereerd' : 'Generated'}:** ${timestamp}\n`;
            report += `**${lang === 'nl' ? 'Bedrijf' : 'Company'}:** ${companyData.company}\n`;
            report += `**${lang === 'nl' ? 'Sector' : 'Sector'}:** ${companyData.sector}\n`;
            report += `**${lang === 'nl' ? 'Gezondheid' : 'Health Score'}:** ${Math.round(companyData.decisionHealthScore)}/100\n`;
            report += `**${lang === 'nl' ? 'Besluitvormingsschuld' : 'Decision Debt'}:** €${(companyData.decisionDebt / 1000).toFixed(0)}k\n\n`;

            report += `## ${lang === 'nl' ? 'Beslissingsvraag' : 'Decision Question'}\n`;
            report += `${lang === 'nl' ? 'Wat is onze strategische richting?' : 'What is our strategic direction?'}\n\n`;

            report += `## ${lang === 'nl' ? 'Agent Outputs' : 'Agent Outputs'}\n\n`;
            if (agentResults && agentResults.length > 0) {
                agentResults.forEach(agent => {
                    report += `### ${agent.name}\n`;
                    report += `**AI Analyse** (${agent.result?.elapsed || 'n/a'}s)\n`;
                    report += agent.result?.text || generateDemoResponses(agent.name, companyData, lang);
                    report += '\n\n---\n\n';
                });
            }

            report += `## ${lang === 'nl' ? 'Consensus' : 'Consensus'}\n`;
            const consensus = generateDynamicConsensus(agentResults, lang);
            if (consensus) {
                consensus.forEach(item => {
                    report += `- ${item.type === 'agree' ? '✓' : '⚠️'} ${item.text}\n`;
                });
            }

            report += `\n\n---\n`;
            report += `**${lang === 'nl' ? 'Gegenereerd door' : 'Generated by'} CheevO! Decision Intelligence Platform**\n`;

            return report;
        };

        const handleExport = async () => {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF({ orientation: 'portrait', unit: 'mm', format: 'a4' });
                const pageW = doc.internal.pageSize.getWidth();
                const margin = 20;
                const maxW = pageW - 2 * margin;
                let y = 20;

                const addPage = () => { doc.addPage(); y = 20; };
                const checkPage = (needed) => { if (y + needed > 270) addPage(); };

                // Header
                doc.setFillColor(10, 10, 15);
                doc.rect(0, 0, pageW, 40, 'F');
                doc.setTextColor(6, 214, 160);
                doc.setFontSize(22);
                doc.setFont('helvetica', 'bold');
                doc.text('CheevO!', margin, 18);
                doc.setFontSize(10);
                doc.setTextColor(255, 255, 255);
                doc.text('Decision Intelligence Report', margin, 26);
                const timestamp = new Date().toLocaleString(lang === 'nl' ? 'nl-NL' : 'en-US');
                doc.setFontSize(8);
                doc.setTextColor(180, 180, 180);
                doc.text(timestamp, margin, 34);
                y = 50;

                // Company info
                doc.setTextColor(40, 40, 40);
                doc.setFontSize(16);
                doc.setFont('helvetica', 'bold');
                doc.text(companyData.company, margin, y);
                y += 7;
                doc.setFontSize(10);
                doc.setFont('helvetica', 'normal');
                doc.setTextColor(100, 100, 100);
                doc.text(`${companyData.sector} · ${companyData.employees} ${lang === 'nl' ? 'medewerkers' : 'employees'}`, margin, y);
                y += 12;

                // Key Metrics
                doc.setFillColor(245, 248, 250);
                doc.roundedRect(margin, y, maxW, 30, 3, 3, 'F');
                doc.setFontSize(9);
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(6, 214, 160);
                const metricX = [margin + 10, margin + 50, margin + 100, margin + 145];
                const healthScore = Math.round(parseFloat(companyData.decisionHealthScore) || 60);
                const debtVal = Math.round((parseFloat(companyData.decisionDebt) || 250000) / 1000);
                const velocity = Math.round(companyData.metrics.openDecisions / 4);
                doc.text(String(healthScore), metricX[0], y + 12);
                doc.text(String(velocity), metricX[1], y + 12);
                doc.text(String(companyData.metrics.openDecisions), metricX[2], y + 12);
                doc.text(`€${debtVal}K`, metricX[3], y + 12);
                doc.setFontSize(7);
                doc.setTextColor(120, 120, 120);
                doc.setFont('helvetica', 'normal');
                doc.text(lang === 'nl' ? 'Gezondheid' : 'Health', metricX[0], y + 20);
                doc.text(lang === 'nl' ? 'Snelheid/m' : 'Velocity/m', metricX[1], y + 20);
                doc.text(lang === 'nl' ? 'Open besluiten' : 'Open decisions', metricX[2], y + 20);
                doc.text(lang === 'nl' ? 'Besluitschuld' : 'Decision debt', metricX[3], y + 20);
                y += 40;

                // Agent Outputs
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(40, 40, 40);
                doc.text(lang === 'nl' ? 'Agent Analyse Resultaten' : 'Agent Analysis Results', margin, y);
                y += 10;

                if (agentResults && agentResults.length > 0) {
                    agentResults.forEach(agent => {
                        checkPage(40);
                        doc.setFontSize(11);
                        doc.setFont('helvetica', 'bold');
                        doc.setTextColor(60, 60, 60);
                        doc.text(`${agent.name}`, margin, y);
                        if (agent.result?.elapsed) {
                            doc.setFontSize(8);
                            doc.setTextColor(150, 150, 150);
                            doc.text(`(${agent.result.isLive ? 'AI' : 'Demo'} · ${agent.result.elapsed}s)`, margin + 60, y);
                        }
                        y += 6;
                        doc.setFontSize(9);
                        doc.setFont('helvetica', 'normal');
                        doc.setTextColor(80, 80, 80);
                        const rawText = agent.result?.text || generateDemoResponses(agent.name, companyData, lang);
                        const cleanText = rawText.replace(/[#*_`]/g, '').replace(/\n{3,}/g, '\n\n');
                        const lines = doc.splitTextToSize(cleanText, maxW);
                        const maxLines = 20;
                        const displayLines = lines.slice(0, maxLines);
                        displayLines.forEach(line => {
                            checkPage(5);
                            doc.text(line, margin, y);
                            y += 4;
                        });
                        if (lines.length > maxLines) {
                            doc.setTextColor(150, 150, 150);
                            doc.text('...', margin, y);
                            y += 4;
                        }
                        y += 6;
                        doc.setDrawColor(220, 220, 220);
                        doc.line(margin, y, pageW - margin, y);
                        y += 6;
                    });
                }

                // ROI Section
                checkPage(40);
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(6, 214, 160);
                doc.text(lang === 'nl' ? 'Geschatte ROI Impact' : 'Estimated ROI Impact', margin, y);
                y += 10;
                doc.setFontSize(10);
                doc.setFont('helvetica', 'normal');
                doc.setTextColor(60, 60, 60);
                const roiDebt = Math.round((parseFloat(companyData.decisionDebt) || 250000) * 0.15 / 1000);
                const roiTime = Math.round((parseFloat(companyData.metrics.avgDecisionTime) || 5) * 0.3);
                const roiHealth = Math.max(70, Math.round((parseFloat(companyData.decisionHealthScore) || 60) + 15));
                doc.text(`• ${lang === 'nl' ? 'Besparing' : 'Savings'}: -€${roiDebt}K/${lang === 'nl' ? 'jaar' : 'year'}`, margin, y); y += 6;
                doc.text(`• ${lang === 'nl' ? 'Snellere besluiten' : 'Faster decisions'}: ${roiTime} ${lang === 'nl' ? 'dagen' : 'days'}`, margin, y); y += 6;
                doc.text(`• ${lang === 'nl' ? 'Haalbare score' : 'Achievable score'}: ${roiHealth}/100`, margin, y); y += 12;

                // Footer
                checkPage(20);
                doc.setDrawColor(6, 214, 160);
                doc.setLineWidth(0.5);
                doc.line(margin, y, pageW - margin, y);
                y += 8;
                doc.setFontSize(8);
                doc.setTextColor(150, 150, 150);
                doc.text(`${lang === 'nl' ? 'Gegenereerd door' : 'Generated by'} CheevO! Decision Intelligence Platform — ${timestamp}`, margin, y);
                y += 5;
                doc.text('https://meyermansheidi.github.io/cheevo-app/', margin, y);

                doc.save(`CheevO-Report-${companyData.company.replace(/\s+/g, '-')}-${new Date().toISOString().split('T')[0]}.pdf`);
                setCopyFeedback(true);
                setTimeout(() => setCopyFeedback(false), 2000);
            } catch (err) {
                console.error('PDF generation failed, falling back to clipboard:', err);
                // Fallback to clipboard
                const report = generateExportReport();
                try {
                    await navigator.clipboard.writeText(report);
                    setCopyFeedback(true);
                    setTimeout(() => setCopyFeedback(false), 2000);
                } catch (clipErr) {
                    console.error('Clipboard also failed:', clipErr);
                }
            }
        };

        const handleNewDecisionClick = () => {
            setShowConfirmDialog(true);
        };

        return (
            <div className="screen-container screen-enter" style={{
                padding: 'clamp(20px, 4vw, 40px)', maxWidth: 1200, margin: '0 auto'
            }}>
                <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: 8, flexWrap: 'wrap', gap: 8 }}>
                    <h2 className="section-title">{t(lang).commandCenterTitle}</h2>
                    <div style={{ display: 'flex', alignItems: 'center', gap: 6, padding: '4px 12px', borderRadius: 20, background: 'rgba(6,214,160,0.1)', border: '1px solid rgba(6,214,160,0.2)' }}>
                        <div style={{ width: 6, height: 6, borderRadius: '50%', background: '#06D6A0', animation: 'livePulse 2s infinite' }}></div>
                        <span style={{ fontSize: 11, fontWeight: 600, color: '#06D6A0' }}>
                            {lang === 'nl' ? 'Live data' : 'Live data'} • {new Date().toLocaleTimeString(lang === 'nl' ? 'nl-NL' : 'en-US', { hour: '2-digit', minute: '2-digit' })}
                        </span>
                    </div>
                </div>
                <p className="text-muted" style={{ marginBottom: 32 }}>
                    {lang === 'nl'
                        ? `Gepersonaliseerde analyse voor ${companyData.company} — ${companyData.sector}`
                        : `Personalized analysis for ${companyData.company} — ${companyData.sector}`}
                </p>

                <div className="dashboard-grid">
                    <div className="metric-card">
                        <div className="metric-card-value">{Math.round(companyData.decisionHealthScore)}</div>
                        <div className="metric-card-label">{t(lang).healthMetric}</div>
                        <div className="benchmark-badge" style={{ marginTop: 12 }} title={lang === 'nl' ? 'Geschat sectorgemiddelde op basis van ' + companyData.sector + ' data' : 'Estimated sector average based on ' + companyData.sector + ' data'}>
                            {lang === 'nl' ? `vs ~65 ${companyData.sector} gem.` : `vs ~65 ${companyData.sector} avg.`}
                        </div>
                    </div>
                    <div className="metric-card">
                        <div className="metric-card-value">{Math.round(companyData.metrics.openDecisions / 4)}</div>
                        <div className="metric-card-label">{t(lang).velocityMetric}</div>
                    </div>
                    <div className="metric-card">
                        <div className="metric-card-value">{companyData.metrics.openDecisions}</div>
                        <div className="metric-card-label">{t(lang).activeDecisions}</div>
                    </div>
                    <div className="metric-card">
                        <div className="metric-card-value">€{Math.round(companyData.decisionDebt / 100000)}M</div>
                        <div className="metric-card-label">{t(lang).debtMetric}</div>
                    </div>
                </div>

                <div className="decision-timeline">
                    <h3 style={{ fontSize: 16, fontWeight: 600, marginBottom: 16 }}>
                        {lang === 'nl' ? 'Recente Besluiten' : 'Recent Decisions'}
                    </h3>
                    {decisions.map((decision, idx) => (
                        <div key={idx} className="timeline-item">
                            <div className="timeline-date">{decision.date}</div>
                            <div className="timeline-desc">{decision.title}</div>
                        </div>
                    ))}
                </div>

                {/* ROI Impact Section */}
                <div className="glass-card" style={{ marginBottom: 24, borderColor: 'rgba(6,214,160,0.25)', background: 'rgba(6,214,160,0.04)' }}>
                    <h3 style={{ fontSize: 16, fontWeight: 700, marginBottom: 12, color: '#06D6A0' }}>
                        {lang === 'nl' ? '📈 Geschatte ROI Impact' : '📈 Estimated ROI Impact'}
                    </h3>
                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: 16, marginBottom: 16 }}>
                        <div style={{ padding: 16, background: 'rgba(6,214,160,0.06)', borderRadius: 12, textAlign: 'center' }}>
                            <div style={{ fontSize: 24, fontWeight: 700, color: '#06D6A0', fontFamily: "'Space Grotesk', sans-serif" }}>
                                -€{Math.round((parseFloat(companyData.decisionDebt) || 250000) * 0.15 / 1000)}K
                            </div>
                            <div style={{ fontSize: 12, color: 'rgba(255,255,255,0.6)', marginTop: 4 }}>
                                {lang === 'nl' ? '/jaar bij +10 punten gezondheid' : '/year with +10 health points'}
                            </div>
                        </div>
                        <div style={{ padding: 16, background: 'rgba(6,214,160,0.06)', borderRadius: 12, textAlign: 'center' }}>
                            <div style={{ fontSize: 24, fontWeight: 700, color: '#06D6A0', fontFamily: "'Space Grotesk', sans-serif" }}>
                                {Math.round((parseFloat(companyData.metrics.avgDecisionTime) || 5) * 0.3)}d
                            </div>
                            <div style={{ fontSize: 12, color: 'rgba(255,255,255,0.6)', marginTop: 4 }}>
                                {lang === 'nl' ? 'snellere besluitvorming mogelijk' : 'faster decision-making possible'}
                            </div>
                        </div>
                        <div style={{ padding: 16, background: 'rgba(6,214,160,0.06)', borderRadius: 12, textAlign: 'center' }}>
                            <div style={{ fontSize: 24, fontWeight: 700, color: '#06D6A0', fontFamily: "'Space Grotesk', sans-serif" }}>
                                {Math.max(70, Math.round((parseFloat(companyData.decisionHealthScore) || 60) + 15))}/100
                            </div>
                            <div style={{ fontSize: 12, color: 'rgba(255,255,255,0.6)', marginTop: 4 }}>
                                {lang === 'nl' ? 'haalbare gezondheid met CheevO!' : 'achievable health with CheevO!'}
                            </div>
                        </div>
                    </div>
                    <p style={{ fontSize: 13, color: 'rgba(255,255,255,0.5)', fontStyle: 'italic' }}>
                        {lang === 'nl'
                            ? 'Schattingen op basis van uw Decision Health Score (' + Math.round(parseFloat(companyData.decisionHealthScore) || 60) + '/100) en ' + companyData.sector + '-benchmarks. Exacte resultaten variëren per organisatie.'
                            : 'Estimates based on your Decision Health Score (' + Math.round(parseFloat(companyData.decisionHealthScore) || 60) + '/100) and ' + companyData.sector + ' benchmarks. Actual results vary by organization.'}
                    </p>
                </div>

                {/* Next Steps CTA */}
                <div className="glass-card" style={{ marginBottom: 24, textAlign: 'center', padding: '32px 24px' }}>
                    <h3 style={{ fontSize: 18, fontWeight: 700, marginBottom: 8 }}>
                        {lang === 'nl'
                            ? `${companyData.company}, klaar voor de volgende stap?`
                            : `${companyData.company}, ready for next steps?`}
                    </h3>
                    <p style={{ fontSize: 14, color: 'rgba(255,255,255,0.65)', marginBottom: 20, maxWidth: 500, margin: '0 auto 20px' }}>
                        {lang === 'nl'
                            ? 'Onze consultants helpen u deze AI-inzichten om te zetten in meetbare resultaten binnen 90 dagen.'
                            : 'Our consultants help you turn these AI insights into measurable results within 90 days.'}
                    </p>
                    <a href="https://websitecheevo-test.webflow.io/?v=8#contact" target="_blank" rel="noopener noreferrer" className="btn-primary" style={{
                        display: 'inline-block', padding: '14px 40px', fontSize: 16, textDecoration: 'none'
                    }}>
                        {lang === 'nl' ? 'Plan een gesprek →' : 'Schedule a call →'}
                    </a>
                </div>

                <div className="action-buttons">
                    <button onClick={handleNewDecisionClick} className="btn-primary">
                        {t(lang).newDecisionBtn}
                    </button>
                    <button onClick={handleExport} className="btn-primary" style={{ position: 'relative' }}>
                        {copyFeedback ? (lang === 'nl' ? '✓ PDF Gedownload!' : '✓ PDF Downloaded!') : (lang === 'nl' ? '📄 Download PDF Rapport' : '📄 Download PDF Report')}
                    </button>
                </div>

                {showConfirmDialog && (
                    <div className="modal-overlay" onClick={() => setShowConfirmDialog(false)} role="dialog" aria-modal="true" aria-labelledby="confirm-dialog-title">
                        <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                            <h2 className="modal-title" id="confirm-dialog-title" style={{ marginBottom: 16 }}>
                                {lang === 'nl' ? 'Nieuwe Analyse' : 'New Analysis'}
                            </h2>
                            <p style={{ marginBottom: 24, color: 'rgba(255, 255, 255, 0.7)' }}>
                                {t(lang).confirmNewDecision}
                            </p>
                            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 12 }}>
                                <button
                                    onClick={() => setShowConfirmDialog(false)}
                                    className="btn-primary"
                                    style={{ background: 'rgba(255, 255, 255, 0.1)', color: '#06D6A0', border: '1px solid rgba(6, 214, 160, 0.3)' }}
                                >
                                    {lang === 'nl' ? 'Annuleren' : 'Cancel'}
                                </button>
                                <button
                                    onClick={onNewDecision}
                                    className="btn-primary"
                                >
                                    {lang === 'nl' ? 'Bevestigen' : 'Confirm'}
                                </button>
                            </div>
                        </div>
                    </div>
                )}
            </div>
        );
    };

    /* ==================== MAIN APP ==================== */

    function App() {
        const [screen, setScreen] = useState('splash');
        const [email, setEmail] = useState('');
        const [companyData, setCompanyData] = useState(null);
        const [lang, setLang] = useState('nl');
        const [screenTransition, setScreenTransition] = useState('enter');
        const [completedSteps, setCompletedSteps] = useState([]);
        const [currentStep, setCurrentStep] = useState('landing');
        const [agentResults, setAgentResults] = useState(null);

        const showStepper = screen !== 'landing' && screen !== 'splash' && screen !== 'welcome';

        useEffect(() => {
            document.body.className = showStepper ? 'with-stepper' : '';
        }, [showStepper]);

        const handleLandingProceed = (emailAddr) => {
            setEmail(emailAddr);
            setScreen('scan');
            setCurrentStep('scan');
            setScreenTransition('enter');
        };

        const handleScanProceed = (data) => {
            setCompanyData(data);
            setCompletedSteps([...completedSteps, 'scan']);
            setScreen('engine');
            setCurrentStep('engine');
            setScreenTransition('enter');
        };

        const handleEngineComplete = (data, agents) => {
            setCompanyData(data);
            setAgentResults(agents);
            setCompletedSteps([...completedSteps, 'engine']);
            setScreen('command');
            setCurrentStep('command');
            setScreenTransition('enter');
        };

        const handleNewDecision = () => {
            setCompletedSteps([]);
            setScreen('landing');
            setEmail('');
            setCompanyData(null);
            setAgentResults(null);
            setCurrentStep('landing');
            setScreenTransition('enter');
        };

        const handleStepClick = (step) => {
            if (step === 'scan') {
                setScreen('scan');
                setCurrentStep('scan');
                setAgentResults(null);
                setCompletedSteps(completedSteps.filter(s => s !== 'engine' && s !== 'command'));
            } else if (step === 'engine' && companyData) {
                setScreen('engine');
                setCurrentStep('engine');
                setCompletedSteps(completedSteps.filter(s => s !== 'command'));
            } else if (step === 'command' && agentResults) {
                setScreen('command');
                setCurrentStep('command');
            }
        };

        const handleSplashComplete = useCallback(() => {
            setScreen('welcome');
        }, []);

        const handleWelcomeComplete = useCallback(() => {
            setScreen('landing');
        }, []);

        return (
            <div style={{ width: '100%', minHeight: '100vh' }}>
                <nav className="top-nav" role="navigation" aria-label="Hoofdnavigatie">
                    <div className="nav-left">
                        <img
                            src="https://cdn.prod.website-files.com/698711ea47ebc9e0964e73b3/6987363d86df2b3487212d26_Cheevo%20Logo%20Black.svg"
                            alt="CheevO!"
                            className="logo-img"
                        />
                    </div>
                    <div className="nav-center">{t(lang).appTitle}</div>
                    <div className="nav-right">
                        <LanguageToggle lang={lang} setLang={setLang} />
                    </div>
                </nav>

                {showStepper && (
                    <ProgressStepper
                        currentStep={currentStep}
                        completedSteps={completedSteps}
                        onStepClick={handleStepClick}
                        lang={lang}
                    />
                )}

                <main id="main-content" role="main">
                {screen === 'splash' && (
                    <SplashScreen onSplashComplete={handleSplashComplete} lang={lang} />
                )}

                {screen === 'welcome' && (
                    <WelcomeScreen onComplete={handleWelcomeComplete} lang={lang} />
                )}

                {screen === 'landing' && (
                    <LandingScreen onProceed={handleLandingProceed} t={t} lang={lang} />
                )}
                {screen === 'scan' && (
                    <ScanScreen email={email} onProceed={handleScanProceed} t={t} lang={lang} />
                )}
                {screen === 'engine' && companyData && (
                    <DecisionEngineScreen companyData={companyData} onComplete={handleEngineComplete} t={t} lang={lang} />
                )}
                {screen === 'command' && companyData && (
                    <CommandCenterScreen companyData={companyData} agentResults={agentResults} onNewDecision={handleNewDecision} t={t} lang={lang} />
                )}
                </main>
            </div>
        );
    }

    /* ==================== RENDER ==================== */

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<ErrorBoundary><App /></ErrorBoundary>);
</script>
</body>
</html>
